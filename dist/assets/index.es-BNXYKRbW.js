const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CvuUVRbN.js","assets/wagmi-B8DRgBvI.js","assets/vendor-3YRhkkVa.js"])))=>i.map(i=>d[i]);
import{h as k0}from"./wagmi-B8DRgBvI.js";import{g as sn,b as hf,c as Mr}from"./vendor-3YRhkkVa.js";import{r as nn,c as re,b as K0,w as lf,a as ff,f as qc,t as To,d as B0,e as Ii,V as F0,M as V0,N as G,k as G0,g as Sc,h as W0,K as J0,A as Q0,q as Jh,x as Y0,H as Z0,F as X0,i as Qh,$ as ew,p as tw,J as rw,u as en,j as Yh,X as iw,n as sw,_ as pf,l as qr,I as nw,m as Zh,o as vs,y as Ct,U as Vt,s as Ei,v as cr,z as ow,B as ms,C as df,D as aw,E as cw,G as uw,L as gf,O as hw,P as yf,Q as vf,R as bs,S as Rc,T as Io,W as Es,Y as lw,Z as xo,a0 as fw,a1 as pw,a2 as dw,a3 as gw,a4 as yo,a5 as yw,a6 as vw,a7 as hc,a8 as Xh,a9 as mw,aa as ww,ab as bw,ac as el,ad as _w,ae as Ew,af as Iw,ag as xw,ah as Pw,ai as Sw,aj as Rw,ak as Qs,al as mf,am as lc,an as Ow,ao as Aw}from"./index-CuaZNmGk.js";var Mc={exports:{}},_s=typeof Reflect=="object"?Reflect:null,tl=_s&&typeof _s.apply=="function"?_s.apply:function(t,r,s){return Function.prototype.apply.call(t,r,s)},Po;_s&&typeof _s.ownKeys=="function"?Po=_s.ownKeys:Object.getOwnPropertySymbols?Po=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:Po=function(t){return Object.getOwnPropertyNames(t)};function Cw(a){console&&console.warn&&console.warn(a)}var wf=Number.isNaN||function(t){return t!==t};function qe(){qe.init.call(this)}Mc.exports=qe;Mc.exports.once=Dw;qe.EventEmitter=qe;qe.prototype._events=void 0;qe.prototype._eventsCount=0;qe.prototype._maxListeners=void 0;var rl=10;function No(a){if(typeof a!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof a)}Object.defineProperty(qe,"defaultMaxListeners",{enumerable:!0,get:function(){return rl},set:function(a){if(typeof a!="number"||a<0||wf(a))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+a+".");rl=a}});qe.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};qe.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||wf(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function bf(a){return a._maxListeners===void 0?qe.defaultMaxListeners:a._maxListeners}qe.prototype.getMaxListeners=function(){return bf(this)};qe.prototype.emit=function(t){for(var r=[],s=1;s<arguments.length;s++)r.push(arguments[s]);var o=t==="error",h=this._events;if(h!==void 0)o=o&&h.error===void 0;else if(!o)return!1;if(o){var f;if(r.length>0&&(f=r[0]),f instanceof Error)throw f;var y=new Error("Unhandled error."+(f?" ("+f.message+")":""));throw y.context=f,y}var m=h[t];if(m===void 0)return!1;if(typeof m=="function")tl(m,this,r);else for(var g=m.length,_=Pf(m,g),s=0;s<g;++s)tl(_[s],this,r);return!0};function _f(a,t,r,s){var o,h,f;if(No(r),h=a._events,h===void 0?(h=a._events=Object.create(null),a._eventsCount=0):(h.newListener!==void 0&&(a.emit("newListener",t,r.listener?r.listener:r),h=a._events),f=h[t]),f===void 0)f=h[t]=r,++a._eventsCount;else if(typeof f=="function"?f=h[t]=s?[r,f]:[f,r]:s?f.unshift(r):f.push(r),o=bf(a),o>0&&f.length>o&&!f.warned){f.warned=!0;var y=new Error("Possible EventEmitter memory leak detected. "+f.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");y.name="MaxListenersExceededWarning",y.emitter=a,y.type=t,y.count=f.length,Cw(y)}return a}qe.prototype.addListener=function(t,r){return _f(this,t,r,!1)};qe.prototype.on=qe.prototype.addListener;qe.prototype.prependListener=function(t,r){return _f(this,t,r,!0)};function Tw(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Ef(a,t,r){var s={fired:!1,wrapFn:void 0,target:a,type:t,listener:r},o=Tw.bind(s);return o.listener=r,s.wrapFn=o,o}qe.prototype.once=function(t,r){return No(r),this.on(t,Ef(this,t,r)),this};qe.prototype.prependOnceListener=function(t,r){return No(r),this.prependListener(t,Ef(this,t,r)),this};qe.prototype.removeListener=function(t,r){var s,o,h,f,y;if(No(r),o=this._events,o===void 0)return this;if(s=o[t],s===void 0)return this;if(s===r||s.listener===r)--this._eventsCount===0?this._events=Object.create(null):(delete o[t],o.removeListener&&this.emit("removeListener",t,s.listener||r));else if(typeof s!="function"){for(h=-1,f=s.length-1;f>=0;f--)if(s[f]===r||s[f].listener===r){y=s[f].listener,h=f;break}if(h<0)return this;h===0?s.shift():Nw(s,h),s.length===1&&(o[t]=s[0]),o.removeListener!==void 0&&this.emit("removeListener",t,y||r)}return this};qe.prototype.off=qe.prototype.removeListener;qe.prototype.removeAllListeners=function(t){var r,s,o;if(s=this._events,s===void 0)return this;if(s.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):s[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete s[t]),this;if(arguments.length===0){var h=Object.keys(s),f;for(o=0;o<h.length;++o)f=h[o],f!=="removeListener"&&this.removeAllListeners(f);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(r=s[t],typeof r=="function")this.removeListener(t,r);else if(r!==void 0)for(o=r.length-1;o>=0;o--)this.removeListener(t,r[o]);return this};function If(a,t,r){var s=a._events;if(s===void 0)return[];var o=s[t];return o===void 0?[]:typeof o=="function"?r?[o.listener||o]:[o]:r?$w(o):Pf(o,o.length)}qe.prototype.listeners=function(t){return If(this,t,!0)};qe.prototype.rawListeners=function(t){return If(this,t,!1)};qe.listenerCount=function(a,t){return typeof a.listenerCount=="function"?a.listenerCount(t):xf.call(a,t)};qe.prototype.listenerCount=xf;function xf(a){var t=this._events;if(t!==void 0){var r=t[a];if(typeof r=="function")return 1;if(r!==void 0)return r.length}return 0}qe.prototype.eventNames=function(){return this._eventsCount>0?Po(this._events):[]};function Pf(a,t){for(var r=new Array(t),s=0;s<t;++s)r[s]=a[s];return r}function Nw(a,t){for(;t+1<a.length;t++)a[t]=a[t+1];a.pop()}function $w(a){for(var t=new Array(a.length),r=0;r<t.length;++r)t[r]=a[r].listener||a[r];return t}function Dw(a,t){return new Promise(function(r,s){function o(f){a.removeListener(t,h),s(f)}function h(){typeof a.removeListener=="function"&&a.removeListener("error",o),r([].slice.call(arguments))}Sf(a,t,h,{once:!0}),t!=="error"&&Lw(a,o,{once:!0})})}function Lw(a,t,r){typeof a.on=="function"&&Sf(a,"error",t,r)}function Sf(a,t,r,s){if(typeof a.on=="function")s.once?a.once(t,r):a.on(t,r);else if(typeof a.addEventListener=="function")a.addEventListener(t,function o(h){s.once&&a.removeEventListener(t,o),r(h)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof a)}var ur=Mc.exports;const zc=sn(ur),jw=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,qw=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,Mw=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function zw(a,t){if(a==="__proto__"||a==="constructor"&&t&&typeof t=="object"&&"prototype"in t){Uw(a);return}return t}function Uw(a){console.warn(`[destr] Dropping "${a}" key to prevent prototype pollution.`)}function vo(a,t={}){if(typeof a!="string")return a;const r=a.trim();if(a[0]==='"'&&a.endsWith('"')&&!a.includes("\\"))return r.slice(1,-1);if(r.length<=9){const s=r.toLowerCase();if(s==="true")return!0;if(s==="false")return!1;if(s==="undefined")return;if(s==="null")return null;if(s==="nan")return Number.NaN;if(s==="infinity")return Number.POSITIVE_INFINITY;if(s==="-infinity")return Number.NEGATIVE_INFINITY}if(!Mw.test(a)){if(t.strict)throw new SyntaxError("[destr] Invalid JSON");return a}try{if(jw.test(a)||qw.test(a)){if(t.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(a,zw)}return JSON.parse(a)}catch(s){if(t.strict)throw s;return a}}function Hw(a){return!a||typeof a.then!="function"?Promise.resolve(a):a}function qt(a,...t){try{return Hw(a(...t))}catch(r){return Promise.reject(r)}}function kw(a){const t=typeof a;return a===null||t!=="object"&&t!=="function"}function Kw(a){const t=Object.getPrototypeOf(a);return!t||t.isPrototypeOf(Object)}function So(a){if(kw(a))return String(a);if(Kw(a)||Array.isArray(a))return JSON.stringify(a);if(typeof a.toJSON=="function")return So(a.toJSON());throw new Error("[unstorage] Cannot stringify value!")}function Rf(){if(typeof Buffer>"u")throw new TypeError("[unstorage] Buffer is not supported!")}const Oc="base64:";function Bw(a){if(typeof a=="string")return a;Rf();const t=Buffer.from(a).toString("base64");return Oc+t}function Fw(a){return typeof a!="string"||!a.startsWith(Oc)?a:(Rf(),Buffer.from(a.slice(Oc.length),"base64"))}function ar(a){return a?a.split("?")[0].replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,""):""}function Vw(...a){return ar(a.join(":"))}function mo(a){return a=ar(a),a?a+":":""}const Gw="memory",Ww=()=>{const a=new Map;return{name:Gw,getInstance:()=>a,hasItem(t){return a.has(t)},getItem(t){return a.get(t)??null},getItemRaw(t){return a.get(t)??null},setItem(t,r){a.set(t,r)},setItemRaw(t,r){a.set(t,r)},removeItem(t){a.delete(t)},getKeys(){return[...a.keys()]},clear(){a.clear()},dispose(){a.clear()}}};function Jw(a={}){const t={mounts:{"":a.driver||Ww()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},r=g=>{for(const _ of t.mountpoints)if(g.startsWith(_))return{base:_,relativeKey:g.slice(_.length),driver:t.mounts[_]};return{base:"",relativeKey:g,driver:t.mounts[""]}},s=(g,_)=>t.mountpoints.filter(O=>O.startsWith(g)||_&&g.startsWith(O)).map(O=>({relativeBase:g.length>O.length?g.slice(O.length):void 0,mountpoint:O,driver:t.mounts[O]})),o=(g,_)=>{if(t.watching){_=ar(_);for(const O of t.watchListeners)O(g,_)}},h=async()=>{if(!t.watching){t.watching=!0;for(const g in t.mounts)t.unwatch[g]=await il(t.mounts[g],o,g)}},f=async()=>{if(t.watching){for(const g in t.unwatch)await t.unwatch[g]();t.unwatch={},t.watching=!1}},y=(g,_,O)=>{const $=new Map,j=A=>{let Q=$.get(A.base);return Q||(Q={driver:A.driver,base:A.base,items:[]},$.set(A.base,Q)),Q};for(const A of g){const Q=typeof A=="string",ee=ar(Q?A:A.key),ce=Q?void 0:A.value,ae=Q||!A.options?_:{..._,...A.options},oe=r(ee);j(oe).items.push({key:ee,value:ce,relativeKey:oe.relativeKey,options:ae})}return Promise.all([...$.values()].map(A=>O(A))).then(A=>A.flat())},m={hasItem(g,_={}){g=ar(g);const{relativeKey:O,driver:$}=r(g);return qt($.hasItem,O,_)},getItem(g,_={}){g=ar(g);const{relativeKey:O,driver:$}=r(g);return qt($.getItem,O,_).then(j=>vo(j))},getItems(g,_){return y(g,_,O=>O.driver.getItems?qt(O.driver.getItems,O.items.map($=>({key:$.relativeKey,options:$.options})),_).then($=>$.map(j=>({key:Vw(O.base,j.key),value:vo(j.value)}))):Promise.all(O.items.map($=>qt(O.driver.getItem,$.relativeKey,$.options).then(j=>({key:$.key,value:vo(j)})))))},getItemRaw(g,_={}){g=ar(g);const{relativeKey:O,driver:$}=r(g);return $.getItemRaw?qt($.getItemRaw,O,_):qt($.getItem,O,_).then(j=>Fw(j))},async setItem(g,_,O={}){if(_===void 0)return m.removeItem(g);g=ar(g);const{relativeKey:$,driver:j}=r(g);j.setItem&&(await qt(j.setItem,$,So(_),O),j.watch||o("update",g))},async setItems(g,_){await y(g,_,async O=>{if(O.driver.setItems)return qt(O.driver.setItems,O.items.map($=>({key:$.relativeKey,value:So($.value),options:$.options})),_);O.driver.setItem&&await Promise.all(O.items.map($=>qt(O.driver.setItem,$.relativeKey,So($.value),$.options)))})},async setItemRaw(g,_,O={}){if(_===void 0)return m.removeItem(g,O);g=ar(g);const{relativeKey:$,driver:j}=r(g);if(j.setItemRaw)await qt(j.setItemRaw,$,_,O);else if(j.setItem)await qt(j.setItem,$,Bw(_),O);else return;j.watch||o("update",g)},async removeItem(g,_={}){typeof _=="boolean"&&(_={removeMeta:_}),g=ar(g);const{relativeKey:O,driver:$}=r(g);$.removeItem&&(await qt($.removeItem,O,_),(_.removeMeta||_.removeMata)&&await qt($.removeItem,O+"$",_),$.watch||o("remove",g))},async getMeta(g,_={}){typeof _=="boolean"&&(_={nativeOnly:_}),g=ar(g);const{relativeKey:O,driver:$}=r(g),j=Object.create(null);if($.getMeta&&Object.assign(j,await qt($.getMeta,O,_)),!_.nativeOnly){const A=await qt($.getItem,O+"$",_).then(Q=>vo(Q));A&&typeof A=="object"&&(typeof A.atime=="string"&&(A.atime=new Date(A.atime)),typeof A.mtime=="string"&&(A.mtime=new Date(A.mtime)),Object.assign(j,A))}return j},setMeta(g,_,O={}){return this.setItem(g+"$",_,O)},removeMeta(g,_={}){return this.removeItem(g+"$",_)},async getKeys(g,_={}){g=mo(g);const O=s(g,!0);let $=[];const j=[];for(const A of O){const Q=await qt(A.driver.getKeys,A.relativeBase,_);for(const ee of Q){const ce=A.mountpoint+ar(ee);$.some(ae=>ce.startsWith(ae))||j.push(ce)}$=[A.mountpoint,...$.filter(ee=>!ee.startsWith(A.mountpoint))]}return g?j.filter(A=>A.startsWith(g)&&A[A.length-1]!=="$"):j.filter(A=>A[A.length-1]!=="$")},async clear(g,_={}){g=mo(g),await Promise.all(s(g,!1).map(async O=>{if(O.driver.clear)return qt(O.driver.clear,O.relativeBase,_);if(O.driver.removeItem){const $=await O.driver.getKeys(O.relativeBase||"",_);return Promise.all($.map(j=>O.driver.removeItem(j,_)))}}))},async dispose(){await Promise.all(Object.values(t.mounts).map(g=>sl(g)))},async watch(g){return await h(),t.watchListeners.push(g),async()=>{t.watchListeners=t.watchListeners.filter(_=>_!==g),t.watchListeners.length===0&&await f()}},async unwatch(){t.watchListeners=[],await f()},mount(g,_){if(g=mo(g),g&&t.mounts[g])throw new Error(`already mounted at ${g}`);return g&&(t.mountpoints.push(g),t.mountpoints.sort((O,$)=>$.length-O.length)),t.mounts[g]=_,t.watching&&Promise.resolve(il(_,o,g)).then(O=>{t.unwatch[g]=O}).catch(console.error),m},async unmount(g,_=!0){g=mo(g),!(!g||!t.mounts[g])&&(t.watching&&g in t.unwatch&&(t.unwatch[g](),delete t.unwatch[g]),_&&await sl(t.mounts[g]),t.mountpoints=t.mountpoints.filter(O=>O!==g),delete t.mounts[g])},getMount(g=""){g=ar(g)+":";const _=r(g);return{driver:_.driver,base:_.base}},getMounts(g="",_={}){return g=ar(g),s(g,_.parents).map($=>({driver:$.driver,base:$.mountpoint}))},keys:(g,_={})=>m.getKeys(g,_),get:(g,_={})=>m.getItem(g,_),set:(g,_,O={})=>m.setItem(g,_,O),has:(g,_={})=>m.hasItem(g,_),del:(g,_={})=>m.removeItem(g,_),remove:(g,_={})=>m.removeItem(g,_)};return m}function il(a,t,r){return a.watch?a.watch((s,o)=>t(s,r+o)):()=>{}}async function sl(a){typeof a.dispose=="function"&&await qt(a.dispose)}function Vi(a){return new Promise((t,r)=>{a.oncomplete=a.onsuccess=()=>t(a.result),a.onabort=a.onerror=()=>r(a.error)})}function Of(a,t){const r=indexedDB.open(a);r.onupgradeneeded=()=>r.result.createObjectStore(t);const s=Vi(r);return(o,h)=>s.then(f=>h(f.transaction(t,o).objectStore(t)))}let fc;function on(){return fc||(fc=Of("keyval-store","keyval")),fc}function nl(a,t=on()){return t("readonly",r=>Vi(r.get(a)))}function Qw(a,t,r=on()){return r("readwrite",s=>(s.put(t,a),Vi(s.transaction)))}function Yw(a,t=on()){return t("readwrite",r=>(r.delete(a),Vi(r.transaction)))}function Zw(a=on()){return a("readwrite",t=>(t.clear(),Vi(t.transaction)))}function Xw(a,t){return a.openCursor().onsuccess=function(){this.result&&(t(this.result),this.result.continue())},Vi(a.transaction)}function eb(a=on()){return a("readonly",t=>{if(t.getAllKeys)return Vi(t.getAllKeys());const r=[];return Xw(t,s=>r.push(s.key)).then(()=>r)})}const tb=a=>JSON.stringify(a,(t,r)=>typeof r=="bigint"?r.toString()+"n":r),rb=a=>{const t=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,r=a.replace(t,'$1"$2n"$3');return JSON.parse(r,(s,o)=>typeof o=="string"&&o.match(/^\d+n$/)?BigInt(o.substring(0,o.length-1)):o)};function an(a){if(typeof a!="string")throw new Error(`Cannot safe json parse value of type ${typeof a}`);try{return rb(a)}catch{return a}}function Fi(a){return typeof a=="string"?a:tb(a)||""}const ib="idb-keyval";var sb=(a={})=>{const t=a.base&&a.base.length>0?`${a.base}:`:"",r=o=>t+o;let s;return a.dbName&&a.storeName&&(s=Of(a.dbName,a.storeName)),{name:ib,options:a,async hasItem(o){return!(typeof await nl(r(o),s)>"u")},async getItem(o){return await nl(r(o),s)??null},setItem(o,h){return Qw(r(o),h,s)},removeItem(o){return Yw(r(o),s)},getKeys(){return eb(s)},clear(){return Zw(s)}}};const nb="WALLET_CONNECT_V2_INDEXED_DB",ob="keyvaluestorage";let ab=class{constructor(){this.indexedDb=Jw({driver:sb({dbName:nb,storeName:ob})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(t=>[t.key,t.value])}async getItem(t){const r=await this.indexedDb.getItem(t);if(r!==null)return r}async setItem(t,r){await this.indexedDb.setItem(t,Fi(r))}async removeItem(t){await this.indexedDb.removeItem(t)}};var pc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ro={exports:{}};(function(){let a;function t(){}a=t,a.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},a.prototype.setItem=function(r,s){this[r]=String(s)},a.prototype.removeItem=function(r){delete this[r]},a.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(s){r[s]=void 0,delete r[s]})},a.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},a.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof pc<"u"&&pc.localStorage?Ro.exports=pc.localStorage:typeof window<"u"&&window.localStorage?Ro.exports=window.localStorage:Ro.exports=new t})();function cb(a){var t;return[a[0],an((t=a[1])!=null?t:"")]}class ub{constructor(){this.localStorage=Ro.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(cb)}async getItem(t){const r=this.localStorage.getItem(t);if(r!==null)return an(r)}async setItem(t,r){this.localStorage.setItem(t,Fi(r))}async removeItem(t){this.localStorage.removeItem(t)}}const hb="wc_storage_version",ol=1,lb=async(a,t,r)=>{const s=hb,o=await t.getItem(s);if(o&&o>=ol){r(t);return}const h=await a.getKeys();if(!h.length){r(t);return}const f=[];for(;h.length;){const y=h.shift();if(!y)continue;const m=y.toLowerCase();if(m.includes("wc@")||m.includes("walletconnect")||m.includes("wc_")||m.includes("wallet_connect")){const g=await a.getItem(y);await t.setItem(y,g),f.push(y)}}await t.setItem(s,ol),r(t),fb(a,f)},fb=async(a,t)=>{t.length&&t.forEach(async r=>{await a.removeItem(r)})};let pb=class{constructor(){this.initialized=!1,this.setInitialized=r=>{this.storage=r,this.initialized=!0};const t=new ub;this.storage=t;try{const r=new ab;lb(t,r,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(t){return await this.initialize(),this.storage.getItem(t)}async setItem(t,r){return await this.initialize(),this.storage.setItem(t,r)}async removeItem(t){return await this.initialize(),this.storage.removeItem(t)}async initialize(){this.initialized||await new Promise(t=>{const r=setInterval(()=>{this.initialized&&(clearInterval(r),t())},20)})}};var Is={},Ks={},dc={},Bs={};class Gi{}const db=Object.freeze(Object.defineProperty({__proto__:null,IEvents:Gi},Symbol.toStringTag,{value:"Module"})),gb=hf(db);var al;function yb(){if(al)return Bs;al=1,Object.defineProperty(Bs,"__esModule",{value:!0}),Bs.IHeartBeat=void 0;const a=gb;class t extends a.IEvents{constructor(s){super()}}return Bs.IHeartBeat=t,Bs}var cl;function Af(){return cl||(cl=1,function(a){Object.defineProperty(a,"__esModule",{value:!0}),nn.__exportStar(yb(),a)}(dc)),dc}var gc={},Ki={},ul;function vb(){if(ul)return Ki;ul=1,Object.defineProperty(Ki,"__esModule",{value:!0}),Ki.HEARTBEAT_EVENTS=Ki.HEARTBEAT_INTERVAL=void 0;const a=re;return Ki.HEARTBEAT_INTERVAL=a.FIVE_SECONDS,Ki.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},Ki}var hl;function Cf(){return hl||(hl=1,function(a){Object.defineProperty(a,"__esModule",{value:!0}),nn.__exportStar(vb(),a)}(gc)),gc}var ll;function mb(){if(ll)return Ks;ll=1,Object.defineProperty(Ks,"__esModule",{value:!0}),Ks.HeartBeat=void 0;const a=nn,t=ur,r=re,s=Af(),o=Cf();class h extends s.IHeartBeat{constructor(y){super(y),this.events=new t.EventEmitter,this.interval=o.HEARTBEAT_INTERVAL,this.interval=(y==null?void 0:y.interval)||o.HEARTBEAT_INTERVAL}static init(y){return a.__awaiter(this,void 0,void 0,function*(){const m=new h(y);return yield m.init(),m})}init(){return a.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(y,m){this.events.on(y,m)}once(y,m){this.events.once(y,m)}off(y,m){this.events.off(y,m)}removeListener(y,m){this.events.removeListener(y,m)}initialize(){return a.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),r.toMiliseconds(this.interval))})}pulse(){this.events.emit(o.HEARTBEAT_EVENTS.pulse)}}return Ks.HeartBeat=h,Ks}(function(a){Object.defineProperty(a,"__esModule",{value:!0});const t=nn;t.__exportStar(mb(),a),t.__exportStar(Af(),a),t.__exportStar(Cf(),a)})(Is);function wb(a){try{return JSON.stringify(a)}catch{return'"[Circular]"'}}var bb=_b;function _b(a,t,r){var s=r&&r.stringify||wb,o=1;if(typeof a=="object"&&a!==null){var h=t.length+o;if(h===1)return a;var f=new Array(h);f[0]=s(a);for(var y=1;y<h;y++)f[y]=s(t[y]);return f.join(" ")}if(typeof a!="string")return a;var m=t.length;if(m===0)return a;for(var g="",_=1-o,O=-1,$=a&&a.length||0,j=0;j<$;){if(a.charCodeAt(j)===37&&j+1<$){switch(O=O>-1?O:0,a.charCodeAt(j+1)){case 100:case 102:if(_>=m||t[_]==null)break;O<j&&(g+=a.slice(O,j)),g+=Number(t[_]),O=j+2,j++;break;case 105:if(_>=m||t[_]==null)break;O<j&&(g+=a.slice(O,j)),g+=Math.floor(Number(t[_])),O=j+2,j++;break;case 79:case 111:case 106:if(_>=m||t[_]===void 0)break;O<j&&(g+=a.slice(O,j));var A=typeof t[_];if(A==="string"){g+="'"+t[_]+"'",O=j+2,j++;break}if(A==="function"){g+=t[_].name||"<anonymous>",O=j+2,j++;break}g+=s(t[_]),O=j+2,j++;break;case 115:if(_>=m)break;O<j&&(g+=a.slice(O,j)),g+=String(t[_]),O=j+2,j++;break;case 37:O<j&&(g+=a.slice(O,j)),g+="%",O=j+2,j++,_--;break}++_}++j}return O===-1?a:(O<$&&(g+=a.slice(O)),g)}const fl=bb;var Eb=Vr;const tn=Nb().console||{},Ib={mapHttpRequest:wo,mapHttpResponse:wo,wrapRequestSerializer:yc,wrapResponseSerializer:yc,wrapErrorSerializer:yc,req:wo,res:wo,err:Ob};function xb(a,t){return Array.isArray(a)?a.filter(function(s){return s!=="!stdSerializers.err"}):a===!0?Object.keys(t):!1}function Vr(a){a=a||{},a.browser=a.browser||{};const t=a.browser.transmit;if(t&&typeof t.send!="function")throw Error("pino: transmit option must have a send function");const r=a.browser.write||tn;a.browser.write&&(a.browser.asObject=!0);const s=a.serializers||{},o=xb(a.browser.serialize,s);let h=a.browser.serialize;Array.isArray(a.browser.serialize)&&a.browser.serialize.indexOf("!stdSerializers.err")>-1&&(h=!1);const f=["error","fatal","warn","info","debug","trace"];typeof r=="function"&&(r.error=r.fatal=r.warn=r.info=r.debug=r.trace=r),a.enabled===!1&&(a.level="silent");const y=a.level||"info",m=Object.create(r);m.log||(m.log=rn),Object.defineProperty(m,"levelVal",{get:_}),Object.defineProperty(m,"level",{get:O,set:$});const g={transmit:t,serialize:o,asObject:a.browser.asObject,levels:f,timestamp:Ab(a)};m.levels=Vr.levels,m.level=y,m.setMaxListeners=m.getMaxListeners=m.emit=m.addListener=m.on=m.prependListener=m.once=m.prependOnceListener=m.removeListener=m.removeAllListeners=m.listeners=m.listenerCount=m.eventNames=m.write=m.flush=rn,m.serializers=s,m._serialize=o,m._stdErrSerialize=h,m.child=j,t&&(m._logEvent=Ac());function _(){return this.level==="silent"?1/0:this.levels.values[this.level]}function O(){return this._level}function $(A){if(A!=="silent"&&!this.levels.values[A])throw Error("unknown level "+A);this._level=A,gs(g,m,"error","log"),gs(g,m,"fatal","error"),gs(g,m,"warn","error"),gs(g,m,"info","log"),gs(g,m,"debug","log"),gs(g,m,"trace","log")}function j(A,Q){if(!A)throw new Error("missing bindings for child Pino");Q=Q||{},o&&A.serializers&&(Q.serializers=A.serializers);const ee=Q.serializers;if(o&&ee){var ce=Object.assign({},s,ee),ae=a.browser.serialize===!0?Object.keys(ce):o;delete A.serializers,$o([A],ae,ce,this._stdErrSerialize)}function oe(te){this._childLevel=(te._childLevel|0)+1,this.error=ys(te,A,"error"),this.fatal=ys(te,A,"fatal"),this.warn=ys(te,A,"warn"),this.info=ys(te,A,"info"),this.debug=ys(te,A,"debug"),this.trace=ys(te,A,"trace"),ce&&(this.serializers=ce,this._serialize=ae),t&&(this._logEvent=Ac([].concat(te._logEvent.bindings,A)))}return oe.prototype=this,new oe(this)}return m}Vr.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}};Vr.stdSerializers=Ib;Vr.stdTimeFunctions=Object.assign({},{nullTime:Tf,epochTime:Nf,unixTime:Cb,isoTime:Tb});function gs(a,t,r,s){const o=Object.getPrototypeOf(t);t[r]=t.levelVal>t.levels.values[r]?rn:o[r]?o[r]:tn[r]||tn[s]||rn,Pb(a,t,r)}function Pb(a,t,r){!a.transmit&&t[r]===rn||(t[r]=function(s){return function(){const h=a.timestamp(),f=new Array(arguments.length),y=Object.getPrototypeOf&&Object.getPrototypeOf(this)===tn?tn:this;for(var m=0;m<f.length;m++)f[m]=arguments[m];if(a.serialize&&!a.asObject&&$o(f,this._serialize,this.serializers,this._stdErrSerialize),a.asObject?s.call(y,Sb(this,r,f,h)):s.apply(y,f),a.transmit){const g=a.transmit.level||t.level,_=Vr.levels.values[g],O=Vr.levels.values[r];if(O<_)return;Rb(this,{ts:h,methodLevel:r,methodValue:O,transmitLevel:g,transmitValue:Vr.levels.values[a.transmit.level||t.level],send:a.transmit.send,val:t.levelVal},f)}}}(t[r]))}function Sb(a,t,r,s){a._serialize&&$o(r,a._serialize,a.serializers,a._stdErrSerialize);const o=r.slice();let h=o[0];const f={};s&&(f.time=s),f.level=Vr.levels.values[t];let y=(a._childLevel|0)+1;if(y<1&&(y=1),h!==null&&typeof h=="object"){for(;y--&&typeof o[0]=="object";)Object.assign(f,o.shift());h=o.length?fl(o.shift(),o):void 0}else typeof h=="string"&&(h=fl(o.shift(),o));return h!==void 0&&(f.msg=h),f}function $o(a,t,r,s){for(const o in a)if(s&&a[o]instanceof Error)a[o]=Vr.stdSerializers.err(a[o]);else if(typeof a[o]=="object"&&!Array.isArray(a[o]))for(const h in a[o])t&&t.indexOf(h)>-1&&h in r&&(a[o][h]=r[h](a[o][h]))}function ys(a,t,r){return function(){const s=new Array(1+arguments.length);s[0]=t;for(var o=1;o<s.length;o++)s[o]=arguments[o-1];return a[r].apply(this,s)}}function Rb(a,t,r){const s=t.send,o=t.ts,h=t.methodLevel,f=t.methodValue,y=t.val,m=a._logEvent.bindings;$o(r,a._serialize||Object.keys(a.serializers),a.serializers,a._stdErrSerialize===void 0?!0:a._stdErrSerialize),a._logEvent.ts=o,a._logEvent.messages=r.filter(function(g){return m.indexOf(g)===-1}),a._logEvent.level.label=h,a._logEvent.level.value=f,s(h,a._logEvent,y),a._logEvent=Ac(m)}function Ac(a){return{ts:0,messages:[],bindings:a||[],level:{label:"",value:0}}}function Ob(a){const t={type:a.constructor.name,msg:a.message,stack:a.stack};for(const r in a)t[r]===void 0&&(t[r]=a[r]);return t}function Ab(a){return typeof a.timestamp=="function"?a.timestamp:a.timestamp===!1?Tf:Nf}function wo(){return{}}function yc(a){return a}function rn(){}function Tf(){return!1}function Nf(){return Date.now()}function Cb(){return Math.round(Date.now()/1e3)}function Tb(){return new Date(Date.now()).toISOString()}function Nb(){function a(t){return typeof t<"u"&&t}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return a(self)||a(window)||a(this)||{}}}const Do=sn(Eb),$b={level:"info"},cn="custom_context";var Db=Object.defineProperty,Lb=Object.defineProperties,jb=Object.getOwnPropertyDescriptors,pl=Object.getOwnPropertySymbols,qb=Object.prototype.hasOwnProperty,Mb=Object.prototype.propertyIsEnumerable,dl=(a,t,r)=>t in a?Db(a,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[t]=r,zb=(a,t)=>{for(var r in t||(t={}))qb.call(t,r)&&dl(a,r,t[r]);if(pl)for(var r of pl(t))Mb.call(t,r)&&dl(a,r,t[r]);return a},Ub=(a,t)=>Lb(a,jb(t));function Lo(a){return Ub(zb({},a),{level:(a==null?void 0:a.level)||$b.level})}function Hb(a,t=cn){return a[t]||""}function kb(a,t,r=cn){return a[r]=t,a}function hr(a,t=cn){let r="";return typeof a.bindings>"u"?r=Hb(a,t):r=a.bindings().context||"",r}function Kb(a,t,r=cn){const s=hr(a,r);return s.trim()?`${s}/${t}`:t}function lr(a,t,r=cn){const s=Kb(a,t,r),o=a.child({context:s});return kb(o,s,r)}let Bb=class extends Gi{constructor(t){super(),this.opts=t,this.protocol="wc",this.version=2}},Fb=class extends Gi{constructor(t,r){super(),this.core=t,this.logger=r,this.records=new Map}},Vb=class{constructor(t,r){this.logger=t,this.core=r}},Gb=class extends Gi{constructor(t,r){super(),this.relayer=t,this.logger=r}},Wb=class extends Gi{constructor(t){super()}},Jb=class{constructor(t,r,s,o){this.core=t,this.logger=r,this.name=s}},Qb=class extends Gi{constructor(t,r){super(),this.relayer=t,this.logger=r}},Yb=class extends Gi{constructor(t,r){super(),this.core=t,this.logger=r}},Zb=class{constructor(t,r){this.projectId=t,this.logger=r}},Xb=class{constructor(t,r){this.projectId=t,this.logger=r}},e_=class{constructor(t){this.opts=t,this.protocol="wc",this.version=2}},t_=class{constructor(t){this.client=t}};var Uc={},$f={};(function(a){Object.defineProperty(a,"__esModule",{value:!0});var t=K0,r=lf;a.DIGEST_LENGTH=64,a.BLOCK_SIZE=128;var s=function(){function y(){this.digestLength=a.DIGEST_LENGTH,this.blockSize=a.BLOCK_SIZE,this._stateHi=new Int32Array(8),this._stateLo=new Int32Array(8),this._tempHi=new Int32Array(16),this._tempLo=new Int32Array(16),this._buffer=new Uint8Array(256),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return y.prototype._initState=function(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209},y.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},y.prototype.clean=function(){r.wipe(this._buffer),r.wipe(this._tempHi),r.wipe(this._tempLo),this.reset()},y.prototype.update=function(m,g){if(g===void 0&&(g=m.length),this._finished)throw new Error("SHA512: can't update because hash was finished.");var _=0;if(this._bytesHashed+=g,this._bufferLength>0){for(;this._bufferLength<a.BLOCK_SIZE&&g>0;)this._buffer[this._bufferLength++]=m[_++],g--;this._bufferLength===this.blockSize&&(h(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(g>=this.blockSize&&(_=h(this._tempHi,this._tempLo,this._stateHi,this._stateLo,m,_,g),g%=this.blockSize);g>0;)this._buffer[this._bufferLength++]=m[_++],g--;return this},y.prototype.finish=function(m){if(!this._finished){var g=this._bytesHashed,_=this._bufferLength,O=g/536870912|0,$=g<<3,j=g%128<112?128:256;this._buffer[_]=128;for(var A=_+1;A<j-8;A++)this._buffer[A]=0;t.writeUint32BE(O,this._buffer,j-8),t.writeUint32BE($,this._buffer,j-4),h(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,j),this._finished=!0}for(var A=0;A<this.digestLength/8;A++)t.writeUint32BE(this._stateHi[A],m,A*8),t.writeUint32BE(this._stateLo[A],m,A*8+4);return this},y.prototype.digest=function(){var m=new Uint8Array(this.digestLength);return this.finish(m),m},y.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},y.prototype.restoreState=function(m){return this._stateHi.set(m.stateHi),this._stateLo.set(m.stateLo),this._bufferLength=m.bufferLength,m.buffer&&this._buffer.set(m.buffer),this._bytesHashed=m.bytesHashed,this._finished=!1,this},y.prototype.cleanSavedState=function(m){r.wipe(m.stateHi),r.wipe(m.stateLo),m.buffer&&r.wipe(m.buffer),m.bufferLength=0,m.bytesHashed=0},y}();a.SHA512=s;var o=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function h(y,m,g,_,O,$,j){for(var A=g[0],Q=g[1],ee=g[2],ce=g[3],ae=g[4],oe=g[5],te=g[6],he=g[7],pe=_[0],Y=_[1],ve=_[2],bt=_[3],nt=_[4],Be=_[5],Mt=_[6],zt=_[7],b,S,J,le,k,H,K,B;j>=128;){for(var et=0;et<16;et++){var ot=8*et+$;y[et]=t.readUint32BE(O,ot),m[et]=t.readUint32BE(O,ot+4)}for(var et=0;et<80;et++){var Oi=A,Ee=Q,Ar=ee,D=ce,N=ae,C=oe,u=te,I=he,Z=pe,ue=Y,me=ve,Re=bt,Ae=nt,Ie=Be,_t=Mt,gt=zt;if(b=he,S=zt,k=S&65535,H=S>>>16,K=b&65535,B=b>>>16,b=(ae>>>14|nt<<18)^(ae>>>18|nt<<14)^(nt>>>9|ae<<23),S=(nt>>>14|ae<<18)^(nt>>>18|ae<<14)^(ae>>>9|nt<<23),k+=S&65535,H+=S>>>16,K+=b&65535,B+=b>>>16,b=ae&oe^~ae&te,S=nt&Be^~nt&Mt,k+=S&65535,H+=S>>>16,K+=b&65535,B+=b>>>16,b=o[et*2],S=o[et*2+1],k+=S&65535,H+=S>>>16,K+=b&65535,B+=b>>>16,b=y[et%16],S=m[et%16],k+=S&65535,H+=S>>>16,K+=b&65535,B+=b>>>16,H+=k>>>16,K+=H>>>16,B+=K>>>16,J=K&65535|B<<16,le=k&65535|H<<16,b=J,S=le,k=S&65535,H=S>>>16,K=b&65535,B=b>>>16,b=(A>>>28|pe<<4)^(pe>>>2|A<<30)^(pe>>>7|A<<25),S=(pe>>>28|A<<4)^(A>>>2|pe<<30)^(A>>>7|pe<<25),k+=S&65535,H+=S>>>16,K+=b&65535,B+=b>>>16,b=A&Q^A&ee^Q&ee,S=pe&Y^pe&ve^Y&ve,k+=S&65535,H+=S>>>16,K+=b&65535,B+=b>>>16,H+=k>>>16,K+=H>>>16,B+=K>>>16,I=K&65535|B<<16,gt=k&65535|H<<16,b=D,S=Re,k=S&65535,H=S>>>16,K=b&65535,B=b>>>16,b=J,S=le,k+=S&65535,H+=S>>>16,K+=b&65535,B+=b>>>16,H+=k>>>16,K+=H>>>16,B+=K>>>16,D=K&65535|B<<16,Re=k&65535|H<<16,Q=Oi,ee=Ee,ce=Ar,ae=D,oe=N,te=C,he=u,A=I,Y=Z,ve=ue,bt=me,nt=Re,Be=Ae,Mt=Ie,zt=_t,pe=gt,et%16===15)for(var ot=0;ot<16;ot++)b=y[ot],S=m[ot],k=S&65535,H=S>>>16,K=b&65535,B=b>>>16,b=y[(ot+9)%16],S=m[(ot+9)%16],k+=S&65535,H+=S>>>16,K+=b&65535,B+=b>>>16,J=y[(ot+1)%16],le=m[(ot+1)%16],b=(J>>>1|le<<31)^(J>>>8|le<<24)^J>>>7,S=(le>>>1|J<<31)^(le>>>8|J<<24)^(le>>>7|J<<25),k+=S&65535,H+=S>>>16,K+=b&65535,B+=b>>>16,J=y[(ot+14)%16],le=m[(ot+14)%16],b=(J>>>19|le<<13)^(le>>>29|J<<3)^J>>>6,S=(le>>>19|J<<13)^(J>>>29|le<<3)^(le>>>6|J<<26),k+=S&65535,H+=S>>>16,K+=b&65535,B+=b>>>16,H+=k>>>16,K+=H>>>16,B+=K>>>16,y[ot]=K&65535|B<<16,m[ot]=k&65535|H<<16}b=A,S=pe,k=S&65535,H=S>>>16,K=b&65535,B=b>>>16,b=g[0],S=_[0],k+=S&65535,H+=S>>>16,K+=b&65535,B+=b>>>16,H+=k>>>16,K+=H>>>16,B+=K>>>16,g[0]=A=K&65535|B<<16,_[0]=pe=k&65535|H<<16,b=Q,S=Y,k=S&65535,H=S>>>16,K=b&65535,B=b>>>16,b=g[1],S=_[1],k+=S&65535,H+=S>>>16,K+=b&65535,B+=b>>>16,H+=k>>>16,K+=H>>>16,B+=K>>>16,g[1]=Q=K&65535|B<<16,_[1]=Y=k&65535|H<<16,b=ee,S=ve,k=S&65535,H=S>>>16,K=b&65535,B=b>>>16,b=g[2],S=_[2],k+=S&65535,H+=S>>>16,K+=b&65535,B+=b>>>16,H+=k>>>16,K+=H>>>16,B+=K>>>16,g[2]=ee=K&65535|B<<16,_[2]=ve=k&65535|H<<16,b=ce,S=bt,k=S&65535,H=S>>>16,K=b&65535,B=b>>>16,b=g[3],S=_[3],k+=S&65535,H+=S>>>16,K+=b&65535,B+=b>>>16,H+=k>>>16,K+=H>>>16,B+=K>>>16,g[3]=ce=K&65535|B<<16,_[3]=bt=k&65535|H<<16,b=ae,S=nt,k=S&65535,H=S>>>16,K=b&65535,B=b>>>16,b=g[4],S=_[4],k+=S&65535,H+=S>>>16,K+=b&65535,B+=b>>>16,H+=k>>>16,K+=H>>>16,B+=K>>>16,g[4]=ae=K&65535|B<<16,_[4]=nt=k&65535|H<<16,b=oe,S=Be,k=S&65535,H=S>>>16,K=b&65535,B=b>>>16,b=g[5],S=_[5],k+=S&65535,H+=S>>>16,K+=b&65535,B+=b>>>16,H+=k>>>16,K+=H>>>16,B+=K>>>16,g[5]=oe=K&65535|B<<16,_[5]=Be=k&65535|H<<16,b=te,S=Mt,k=S&65535,H=S>>>16,K=b&65535,B=b>>>16,b=g[6],S=_[6],k+=S&65535,H+=S>>>16,K+=b&65535,B+=b>>>16,H+=k>>>16,K+=H>>>16,B+=K>>>16,g[6]=te=K&65535|B<<16,_[6]=Mt=k&65535|H<<16,b=he,S=zt,k=S&65535,H=S>>>16,K=b&65535,B=b>>>16,b=g[7],S=_[7],k+=S&65535,H+=S>>>16,K+=b&65535,B+=b>>>16,H+=k>>>16,K+=H>>>16,B+=K>>>16,g[7]=he=K&65535|B<<16,_[7]=zt=k&65535|H<<16,$+=128,j-=128}return $}function f(y){var m=new s;m.update(y);var g=m.digest();return m.clean(),g}a.hash=f})($f);(function(a){Object.defineProperty(a,"__esModule",{value:!0}),a.convertSecretKeyToX25519=a.convertPublicKeyToX25519=a.verify=a.sign=a.extractPublicKeyFromSecretKey=a.generateKeyPair=a.generateKeyPairFromSeed=a.SEED_LENGTH=a.SECRET_KEY_LENGTH=a.PUBLIC_KEY_LENGTH=a.SIGNATURE_LENGTH=void 0;const t=ff,r=$f,s=lf;a.SIGNATURE_LENGTH=64,a.PUBLIC_KEY_LENGTH=32,a.SECRET_KEY_LENGTH=64,a.SEED_LENGTH=32;function o(D){const N=new Float64Array(16);if(D)for(let C=0;C<D.length;C++)N[C]=D[C];return N}const h=new Uint8Array(32);h[0]=9;const f=o(),y=o([1]),m=o([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),g=o([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),_=o([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),O=o([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),$=o([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function j(D,N){for(let C=0;C<16;C++)D[C]=N[C]|0}function A(D){let N=1;for(let C=0;C<16;C++){let u=D[C]+N+65535;N=Math.floor(u/65536),D[C]=u-N*65536}D[0]+=N-1+37*(N-1)}function Q(D,N,C){const u=~(C-1);for(let I=0;I<16;I++){const Z=u&(D[I]^N[I]);D[I]^=Z,N[I]^=Z}}function ee(D,N){const C=o(),u=o();for(let I=0;I<16;I++)u[I]=N[I];A(u),A(u),A(u);for(let I=0;I<2;I++){C[0]=u[0]-65517;for(let ue=1;ue<15;ue++)C[ue]=u[ue]-65535-(C[ue-1]>>16&1),C[ue-1]&=65535;C[15]=u[15]-32767-(C[14]>>16&1);const Z=C[15]>>16&1;C[14]&=65535,Q(u,C,1-Z)}for(let I=0;I<16;I++)D[2*I]=u[I]&255,D[2*I+1]=u[I]>>8}function ce(D,N){let C=0;for(let u=0;u<32;u++)C|=D[u]^N[u];return(1&C-1>>>8)-1}function ae(D,N){const C=new Uint8Array(32),u=new Uint8Array(32);return ee(C,D),ee(u,N),ce(C,u)}function oe(D){const N=new Uint8Array(32);return ee(N,D),N[0]&1}function te(D,N){for(let C=0;C<16;C++)D[C]=N[2*C]+(N[2*C+1]<<8);D[15]&=32767}function he(D,N,C){for(let u=0;u<16;u++)D[u]=N[u]+C[u]}function pe(D,N,C){for(let u=0;u<16;u++)D[u]=N[u]-C[u]}function Y(D,N,C){let u,I,Z=0,ue=0,me=0,Re=0,Ae=0,Ie=0,_t=0,gt=0,tt=0,Te=0,Fe=0,Ve=0,rt=0,Le=0,Ge=0,Oe=0,Me=0,at=0,$e=0,Et=0,Tt=0,Ut=0,Ht=0,Dt=0,Wt=0,er=0,zr=0,Jt=0,Gr=0,li=0,Ai=0,ct=C[0],Qe=C[1],ut=C[2],ht=C[3],it=C[4],Ye=C[5],It=C[6],xt=C[7],lt=C[8],Pt=C[9],ft=C[10],yt=C[11],pt=C[12],Ke=C[13],St=C[14],Rt=C[15];u=N[0],Z+=u*ct,ue+=u*Qe,me+=u*ut,Re+=u*ht,Ae+=u*it,Ie+=u*Ye,_t+=u*It,gt+=u*xt,tt+=u*lt,Te+=u*Pt,Fe+=u*ft,Ve+=u*yt,rt+=u*pt,Le+=u*Ke,Ge+=u*St,Oe+=u*Rt,u=N[1],ue+=u*ct,me+=u*Qe,Re+=u*ut,Ae+=u*ht,Ie+=u*it,_t+=u*Ye,gt+=u*It,tt+=u*xt,Te+=u*lt,Fe+=u*Pt,Ve+=u*ft,rt+=u*yt,Le+=u*pt,Ge+=u*Ke,Oe+=u*St,Me+=u*Rt,u=N[2],me+=u*ct,Re+=u*Qe,Ae+=u*ut,Ie+=u*ht,_t+=u*it,gt+=u*Ye,tt+=u*It,Te+=u*xt,Fe+=u*lt,Ve+=u*Pt,rt+=u*ft,Le+=u*yt,Ge+=u*pt,Oe+=u*Ke,Me+=u*St,at+=u*Rt,u=N[3],Re+=u*ct,Ae+=u*Qe,Ie+=u*ut,_t+=u*ht,gt+=u*it,tt+=u*Ye,Te+=u*It,Fe+=u*xt,Ve+=u*lt,rt+=u*Pt,Le+=u*ft,Ge+=u*yt,Oe+=u*pt,Me+=u*Ke,at+=u*St,$e+=u*Rt,u=N[4],Ae+=u*ct,Ie+=u*Qe,_t+=u*ut,gt+=u*ht,tt+=u*it,Te+=u*Ye,Fe+=u*It,Ve+=u*xt,rt+=u*lt,Le+=u*Pt,Ge+=u*ft,Oe+=u*yt,Me+=u*pt,at+=u*Ke,$e+=u*St,Et+=u*Rt,u=N[5],Ie+=u*ct,_t+=u*Qe,gt+=u*ut,tt+=u*ht,Te+=u*it,Fe+=u*Ye,Ve+=u*It,rt+=u*xt,Le+=u*lt,Ge+=u*Pt,Oe+=u*ft,Me+=u*yt,at+=u*pt,$e+=u*Ke,Et+=u*St,Tt+=u*Rt,u=N[6],_t+=u*ct,gt+=u*Qe,tt+=u*ut,Te+=u*ht,Fe+=u*it,Ve+=u*Ye,rt+=u*It,Le+=u*xt,Ge+=u*lt,Oe+=u*Pt,Me+=u*ft,at+=u*yt,$e+=u*pt,Et+=u*Ke,Tt+=u*St,Ut+=u*Rt,u=N[7],gt+=u*ct,tt+=u*Qe,Te+=u*ut,Fe+=u*ht,Ve+=u*it,rt+=u*Ye,Le+=u*It,Ge+=u*xt,Oe+=u*lt,Me+=u*Pt,at+=u*ft,$e+=u*yt,Et+=u*pt,Tt+=u*Ke,Ut+=u*St,Ht+=u*Rt,u=N[8],tt+=u*ct,Te+=u*Qe,Fe+=u*ut,Ve+=u*ht,rt+=u*it,Le+=u*Ye,Ge+=u*It,Oe+=u*xt,Me+=u*lt,at+=u*Pt,$e+=u*ft,Et+=u*yt,Tt+=u*pt,Ut+=u*Ke,Ht+=u*St,Dt+=u*Rt,u=N[9],Te+=u*ct,Fe+=u*Qe,Ve+=u*ut,rt+=u*ht,Le+=u*it,Ge+=u*Ye,Oe+=u*It,Me+=u*xt,at+=u*lt,$e+=u*Pt,Et+=u*ft,Tt+=u*yt,Ut+=u*pt,Ht+=u*Ke,Dt+=u*St,Wt+=u*Rt,u=N[10],Fe+=u*ct,Ve+=u*Qe,rt+=u*ut,Le+=u*ht,Ge+=u*it,Oe+=u*Ye,Me+=u*It,at+=u*xt,$e+=u*lt,Et+=u*Pt,Tt+=u*ft,Ut+=u*yt,Ht+=u*pt,Dt+=u*Ke,Wt+=u*St,er+=u*Rt,u=N[11],Ve+=u*ct,rt+=u*Qe,Le+=u*ut,Ge+=u*ht,Oe+=u*it,Me+=u*Ye,at+=u*It,$e+=u*xt,Et+=u*lt,Tt+=u*Pt,Ut+=u*ft,Ht+=u*yt,Dt+=u*pt,Wt+=u*Ke,er+=u*St,zr+=u*Rt,u=N[12],rt+=u*ct,Le+=u*Qe,Ge+=u*ut,Oe+=u*ht,Me+=u*it,at+=u*Ye,$e+=u*It,Et+=u*xt,Tt+=u*lt,Ut+=u*Pt,Ht+=u*ft,Dt+=u*yt,Wt+=u*pt,er+=u*Ke,zr+=u*St,Jt+=u*Rt,u=N[13],Le+=u*ct,Ge+=u*Qe,Oe+=u*ut,Me+=u*ht,at+=u*it,$e+=u*Ye,Et+=u*It,Tt+=u*xt,Ut+=u*lt,Ht+=u*Pt,Dt+=u*ft,Wt+=u*yt,er+=u*pt,zr+=u*Ke,Jt+=u*St,Gr+=u*Rt,u=N[14],Ge+=u*ct,Oe+=u*Qe,Me+=u*ut,at+=u*ht,$e+=u*it,Et+=u*Ye,Tt+=u*It,Ut+=u*xt,Ht+=u*lt,Dt+=u*Pt,Wt+=u*ft,er+=u*yt,zr+=u*pt,Jt+=u*Ke,Gr+=u*St,li+=u*Rt,u=N[15],Oe+=u*ct,Me+=u*Qe,at+=u*ut,$e+=u*ht,Et+=u*it,Tt+=u*Ye,Ut+=u*It,Ht+=u*xt,Dt+=u*lt,Wt+=u*Pt,er+=u*ft,zr+=u*yt,Jt+=u*pt,Gr+=u*Ke,li+=u*St,Ai+=u*Rt,Z+=38*Me,ue+=38*at,me+=38*$e,Re+=38*Et,Ae+=38*Tt,Ie+=38*Ut,_t+=38*Ht,gt+=38*Dt,tt+=38*Wt,Te+=38*er,Fe+=38*zr,Ve+=38*Jt,rt+=38*Gr,Le+=38*li,Ge+=38*Ai,I=1,u=Z+I+65535,I=Math.floor(u/65536),Z=u-I*65536,u=ue+I+65535,I=Math.floor(u/65536),ue=u-I*65536,u=me+I+65535,I=Math.floor(u/65536),me=u-I*65536,u=Re+I+65535,I=Math.floor(u/65536),Re=u-I*65536,u=Ae+I+65535,I=Math.floor(u/65536),Ae=u-I*65536,u=Ie+I+65535,I=Math.floor(u/65536),Ie=u-I*65536,u=_t+I+65535,I=Math.floor(u/65536),_t=u-I*65536,u=gt+I+65535,I=Math.floor(u/65536),gt=u-I*65536,u=tt+I+65535,I=Math.floor(u/65536),tt=u-I*65536,u=Te+I+65535,I=Math.floor(u/65536),Te=u-I*65536,u=Fe+I+65535,I=Math.floor(u/65536),Fe=u-I*65536,u=Ve+I+65535,I=Math.floor(u/65536),Ve=u-I*65536,u=rt+I+65535,I=Math.floor(u/65536),rt=u-I*65536,u=Le+I+65535,I=Math.floor(u/65536),Le=u-I*65536,u=Ge+I+65535,I=Math.floor(u/65536),Ge=u-I*65536,u=Oe+I+65535,I=Math.floor(u/65536),Oe=u-I*65536,Z+=I-1+37*(I-1),I=1,u=Z+I+65535,I=Math.floor(u/65536),Z=u-I*65536,u=ue+I+65535,I=Math.floor(u/65536),ue=u-I*65536,u=me+I+65535,I=Math.floor(u/65536),me=u-I*65536,u=Re+I+65535,I=Math.floor(u/65536),Re=u-I*65536,u=Ae+I+65535,I=Math.floor(u/65536),Ae=u-I*65536,u=Ie+I+65535,I=Math.floor(u/65536),Ie=u-I*65536,u=_t+I+65535,I=Math.floor(u/65536),_t=u-I*65536,u=gt+I+65535,I=Math.floor(u/65536),gt=u-I*65536,u=tt+I+65535,I=Math.floor(u/65536),tt=u-I*65536,u=Te+I+65535,I=Math.floor(u/65536),Te=u-I*65536,u=Fe+I+65535,I=Math.floor(u/65536),Fe=u-I*65536,u=Ve+I+65535,I=Math.floor(u/65536),Ve=u-I*65536,u=rt+I+65535,I=Math.floor(u/65536),rt=u-I*65536,u=Le+I+65535,I=Math.floor(u/65536),Le=u-I*65536,u=Ge+I+65535,I=Math.floor(u/65536),Ge=u-I*65536,u=Oe+I+65535,I=Math.floor(u/65536),Oe=u-I*65536,Z+=I-1+37*(I-1),D[0]=Z,D[1]=ue,D[2]=me,D[3]=Re,D[4]=Ae,D[5]=Ie,D[6]=_t,D[7]=gt,D[8]=tt,D[9]=Te,D[10]=Fe,D[11]=Ve,D[12]=rt,D[13]=Le,D[14]=Ge,D[15]=Oe}function ve(D,N){Y(D,N,N)}function bt(D,N){const C=o();let u;for(u=0;u<16;u++)C[u]=N[u];for(u=253;u>=0;u--)ve(C,C),u!==2&&u!==4&&Y(C,C,N);for(u=0;u<16;u++)D[u]=C[u]}function nt(D,N){const C=o();let u;for(u=0;u<16;u++)C[u]=N[u];for(u=250;u>=0;u--)ve(C,C),u!==1&&Y(C,C,N);for(u=0;u<16;u++)D[u]=C[u]}function Be(D,N){const C=o(),u=o(),I=o(),Z=o(),ue=o(),me=o(),Re=o(),Ae=o(),Ie=o();pe(C,D[1],D[0]),pe(Ie,N[1],N[0]),Y(C,C,Ie),he(u,D[0],D[1]),he(Ie,N[0],N[1]),Y(u,u,Ie),Y(I,D[3],N[3]),Y(I,I,g),Y(Z,D[2],N[2]),he(Z,Z,Z),pe(ue,u,C),pe(me,Z,I),he(Re,Z,I),he(Ae,u,C),Y(D[0],ue,me),Y(D[1],Ae,Re),Y(D[2],Re,me),Y(D[3],ue,Ae)}function Mt(D,N,C){for(let u=0;u<4;u++)Q(D[u],N[u],C)}function zt(D,N){const C=o(),u=o(),I=o();bt(I,N[2]),Y(C,N[0],I),Y(u,N[1],I),ee(D,u),D[31]^=oe(C)<<7}function b(D,N,C){j(D[0],f),j(D[1],y),j(D[2],y),j(D[3],f);for(let u=255;u>=0;--u){const I=C[u/8|0]>>(u&7)&1;Mt(D,N,I),Be(N,D),Be(D,D),Mt(D,N,I)}}function S(D,N){const C=[o(),o(),o(),o()];j(C[0],_),j(C[1],O),j(C[2],y),Y(C[3],_,O),b(D,C,N)}function J(D){if(D.length!==a.SEED_LENGTH)throw new Error(`ed25519: seed must be ${a.SEED_LENGTH} bytes`);const N=(0,r.hash)(D);N[0]&=248,N[31]&=127,N[31]|=64;const C=new Uint8Array(32),u=[o(),o(),o(),o()];S(u,N),zt(C,u);const I=new Uint8Array(64);return I.set(D),I.set(C,32),{publicKey:C,secretKey:I}}a.generateKeyPairFromSeed=J;function le(D){const N=(0,t.randomBytes)(32,D),C=J(N);return(0,s.wipe)(N),C}a.generateKeyPair=le;function k(D){if(D.length!==a.SECRET_KEY_LENGTH)throw new Error(`ed25519: secret key must be ${a.SECRET_KEY_LENGTH} bytes`);return new Uint8Array(D.subarray(32))}a.extractPublicKeyFromSecretKey=k;const H=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function K(D,N){let C,u,I,Z;for(u=63;u>=32;--u){for(C=0,I=u-32,Z=u-12;I<Z;++I)N[I]+=C-16*N[u]*H[I-(u-32)],C=Math.floor((N[I]+128)/256),N[I]-=C*256;N[I]+=C,N[u]=0}for(C=0,I=0;I<32;I++)N[I]+=C-(N[31]>>4)*H[I],C=N[I]>>8,N[I]&=255;for(I=0;I<32;I++)N[I]-=C*H[I];for(u=0;u<32;u++)N[u+1]+=N[u]>>8,D[u]=N[u]&255}function B(D){const N=new Float64Array(64);for(let C=0;C<64;C++)N[C]=D[C];for(let C=0;C<64;C++)D[C]=0;K(D,N)}function et(D,N){const C=new Float64Array(64),u=[o(),o(),o(),o()],I=(0,r.hash)(D.subarray(0,32));I[0]&=248,I[31]&=127,I[31]|=64;const Z=new Uint8Array(64);Z.set(I.subarray(32),32);const ue=new r.SHA512;ue.update(Z.subarray(32)),ue.update(N);const me=ue.digest();ue.clean(),B(me),S(u,me),zt(Z,u),ue.reset(),ue.update(Z.subarray(0,32)),ue.update(D.subarray(32)),ue.update(N);const Re=ue.digest();B(Re);for(let Ae=0;Ae<32;Ae++)C[Ae]=me[Ae];for(let Ae=0;Ae<32;Ae++)for(let Ie=0;Ie<32;Ie++)C[Ae+Ie]+=Re[Ae]*I[Ie];return K(Z.subarray(32),C),Z}a.sign=et;function ot(D,N){const C=o(),u=o(),I=o(),Z=o(),ue=o(),me=o(),Re=o();return j(D[2],y),te(D[1],N),ve(I,D[1]),Y(Z,I,m),pe(I,I,D[2]),he(Z,D[2],Z),ve(ue,Z),ve(me,ue),Y(Re,me,ue),Y(C,Re,I),Y(C,C,Z),nt(C,C),Y(C,C,I),Y(C,C,Z),Y(C,C,Z),Y(D[0],C,Z),ve(u,D[0]),Y(u,u,Z),ae(u,I)&&Y(D[0],D[0],$),ve(u,D[0]),Y(u,u,Z),ae(u,I)?-1:(oe(D[0])===N[31]>>7&&pe(D[0],f,D[0]),Y(D[3],D[0],D[1]),0)}function Oi(D,N,C){const u=new Uint8Array(32),I=[o(),o(),o(),o()],Z=[o(),o(),o(),o()];if(C.length!==a.SIGNATURE_LENGTH)throw new Error(`ed25519: signature must be ${a.SIGNATURE_LENGTH} bytes`);if(ot(Z,D))return!1;const ue=new r.SHA512;ue.update(C.subarray(0,32)),ue.update(D),ue.update(N);const me=ue.digest();return B(me),b(I,Z,me),S(Z,C.subarray(32)),Be(I,Z),zt(u,I),!ce(C,u)}a.verify=Oi;function Ee(D){let N=[o(),o(),o(),o()];if(ot(N,D))throw new Error("Ed25519: invalid public key");let C=o(),u=o(),I=N[1];he(C,y,I),pe(u,y,I),bt(u,u),Y(C,C,u);let Z=new Uint8Array(32);return ee(Z,C),Z}a.convertPublicKeyToX25519=Ee;function Ar(D){const N=(0,r.hash)(D.subarray(0,32));N[0]&=248,N[31]&=127,N[31]|=64;const C=new Uint8Array(N.subarray(0,32));return(0,s.wipe)(N),C}a.convertSecretKeyToX25519=Ar})(Uc);const r_="EdDSA",i_="JWT",Df=".",Lf="base64url",s_="utf8",n_="utf8",o_=":",a_="did",c_="key",gl="base58btc",u_="z",h_="K36",l_=32;function Oo(a){return To(qc(Fi(a),s_),Lf)}function jf(a){const t=qc(h_,gl),r=u_+To(B0([t,a]),gl);return[a_,c_,r].join(o_)}function f_(a){return To(a,Lf)}function p_(a){return qc([Oo(a.header),Oo(a.payload)].join(Df),n_)}function d_(a){return[Oo(a.header),Oo(a.payload),f_(a.signature)].join(Df)}function yl(a=ff.randomBytes(l_)){return Uc.generateKeyPairFromSeed(a)}async function g_(a,t,r,s,o=re.fromMiliseconds(Date.now())){const h={alg:r_,typ:i_},f=jf(s.publicKey),y=o+r,m={iss:f,sub:a,aud:t,iat:o,exp:y},g=p_({header:h,payload:m}),_=Uc.sign(s.secretKey,g);return d_({header:h,payload:m,signature:_})}const y_="PARSE_ERROR",v_="INVALID_REQUEST",m_="METHOD_NOT_FOUND",w_="INVALID_PARAMS",qf="INTERNAL_ERROR",Hc="SERVER_ERROR",b_=[-32700,-32600,-32601,-32602,-32603],Xs={[y_]:{code:-32700,message:"Parse error"},[v_]:{code:-32600,message:"Invalid Request"},[m_]:{code:-32601,message:"Method not found"},[w_]:{code:-32602,message:"Invalid params"},[qf]:{code:-32603,message:"Internal error"},[Hc]:{code:-32e3,message:"Server error"}},Mf=Hc;function __(a){return b_.includes(a)}function vl(a){return Object.keys(Xs).includes(a)?Xs[a]:Xs[Mf]}function E_(a){const t=Object.values(Xs).find(r=>r.code===a);return t||Xs[Mf]}function zf(a,t,r){return a.message.includes("getaddrinfo ENOTFOUND")||a.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${r} RPC url at ${t}`):a}var Uf={},ni={},ml;function I_(){if(ml)return ni;ml=1,Object.defineProperty(ni,"__esModule",{value:!0}),ni.isBrowserCryptoAvailable=ni.getSubtleCrypto=ni.getBrowerCrypto=void 0;function a(){return(Mr===null||Mr===void 0?void 0:Mr.crypto)||(Mr===null||Mr===void 0?void 0:Mr.msCrypto)||{}}ni.getBrowerCrypto=a;function t(){const s=a();return s.subtle||s.webkitSubtle}ni.getSubtleCrypto=t;function r(){return!!a()&&!!t()}return ni.isBrowserCryptoAvailable=r,ni}var oi={},wl;function x_(){if(wl)return oi;wl=1,Object.defineProperty(oi,"__esModule",{value:!0}),oi.isBrowser=oi.isNode=oi.isReactNative=void 0;function a(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}oi.isReactNative=a;function t(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}oi.isNode=t;function r(){return!a()&&!t()}return oi.isBrowser=r,oi}(function(a){Object.defineProperty(a,"__esModule",{value:!0});const t=nn;t.__exportStar(I_(),a),t.__exportStar(x_(),a)})(Uf);function kc(a=3){const t=Date.now()*Math.pow(10,a),r=Math.floor(Math.random()*Math.pow(10,a));return t+r}function Kc(a=6){return BigInt(kc(a))}function Bi(a,t,r){return{id:r||kc(),jsonrpc:"2.0",method:a,params:t}}function jo(a,t){return{id:a,jsonrpc:"2.0",result:t}}function qo(a,t,r){return{id:a,jsonrpc:"2.0",error:P_(t)}}function P_(a,t){return typeof a>"u"?vl(qf):(typeof a=="string"&&(a=Object.assign(Object.assign({},vl(Hc)),{message:a})),__(a.code)&&(a=E_(a.code)),a)}class S_{}class R_ extends S_{constructor(){super()}}class Hf extends R_{constructor(t){super()}}const O_="^https?:",A_="^wss?:";function C_(a){const t=a.match(new RegExp(/^\w+:/,"gi"));if(!(!t||!t.length))return t[0]}function kf(a,t){const r=C_(a);return typeof r>"u"?!1:new RegExp(t).test(r)}function bl(a){return kf(a,O_)}function _l(a){return kf(a,A_)}function T_(a){return new RegExp("wss?://localhost(:d{2,5})?").test(a)}function Kf(a){return typeof a=="object"&&"id"in a&&"jsonrpc"in a&&a.jsonrpc==="2.0"}function Bc(a){return Kf(a)&&"method"in a}function un(a){return Kf(a)&&(ui(a)||Or(a))}function ui(a){return"result"in a}function Or(a){return"error"in a}let N_=class extends Hf{constructor(t){super(t),this.events=new ur.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(t),this.connection.connected&&this.registerEventListeners()}async connect(t=this.connection){await this.open(t)}async disconnect(){await this.close()}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async request(t,r){return this.requestStrict(Bi(t.method,t.params||[],t.id||Kc().toString()),r)}async requestStrict(t,r){return new Promise(async(s,o)=>{if(!this.connection.connected)try{await this.open()}catch(h){o(h)}this.events.on(`${t.id}`,h=>{Or(h)?o(h.error):s(h.result)});try{await this.connection.send(t,r)}catch(h){o(h)}})}setConnection(t=this.connection){return t}onPayload(t){this.events.emit("payload",t),un(t)?this.events.emit(`${t.id}`,t):this.events.emit("message",{type:t.method,data:t.params})}onClose(t){t&&t.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${t.code} ${t.reason?`(${t.reason})`:""}`)),this.events.emit("disconnect")}async open(t=this.connection){this.connection===t&&this.connection.connected||(this.connection.connected&&this.close(),typeof t=="string"&&(await this.connection.open(t),t=this.connection),this.connection=this.setConnection(t),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",t=>this.onPayload(t)),this.connection.on("close",t=>this.onClose(t)),this.connection.on("error",t=>this.events.emit("error",t)),this.connection.on("register_error",t=>this.onClose()),this.hasRegisteredEventListeners=!0)}};const $_=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),D_=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",El=a=>a.split("?")[0],Il=10,L_=$_();let j_=class{constructor(t){if(this.url=t,this.events=new ur.EventEmitter,this.registering=!1,!_l(t))throw new Error(`Provided URL is not compatible with WebSocket connection: ${t}`);this.url=t}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async open(t=this.url){await this.register(t)}async close(){return new Promise((t,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=s=>{this.onClose(s),t()},this.socket.close()})}async send(t){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(Fi(t))}catch(r){this.onError(t.id,r)}}register(t=this.url){if(!_l(t))throw new Error(`Provided URL is not compatible with WebSocket connection: ${t}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((s,o)=>{this.events.once("register_error",h=>{this.resetMaxListeners(),o(h)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return o(new Error("WebSocket connection is missing or invalid"));s(this.socket)})})}return this.url=t,this.registering=!0,new Promise((r,s)=>{const o=new URLSearchParams(t).get("origin"),h=Uf.isReactNative()?{headers:{origin:o}}:{rejectUnauthorized:!T_(t)},f=new L_(t,[],h);D_()?f.onerror=y=>{const m=y;s(this.emitError(m.error))}:f.on("error",y=>{s(this.emitError(y))}),f.onopen=()=>{this.onOpen(f),r(f)}})}onOpen(t){t.onmessage=r=>this.onPayload(r),t.onclose=r=>this.onClose(r),this.socket=t,this.registering=!1,this.events.emit("open")}onClose(t){this.socket=void 0,this.registering=!1,this.events.emit("close",t)}onPayload(t){if(typeof t.data>"u")return;const r=typeof t.data=="string"?an(t.data):t.data;this.events.emit("payload",r)}onError(t,r){const s=this.parseError(r),o=s.message||s.toString(),h=qo(t,o);this.events.emit("payload",h)}parseError(t,r=this.url){return zf(t,El(r),"WS")}resetMaxListeners(){this.events.getMaxListeners()>Il&&this.events.setMaxListeners(Il)}emitError(t){const r=this.parseError(new Error((t==null?void 0:t.message)||`WebSocket connection failed for host: ${El(this.url)}`));return this.events.emit("register_error",r),r}};var Ao={exports:{}};Ao.exports;(function(a,t){var r=200,s="__lodash_hash_undefined__",o=1,h=2,f=9007199254740991,y="[object Arguments]",m="[object Array]",g="[object AsyncFunction]",_="[object Boolean]",O="[object Date]",$="[object Error]",j="[object Function]",A="[object GeneratorFunction]",Q="[object Map]",ee="[object Number]",ce="[object Null]",ae="[object Object]",oe="[object Promise]",te="[object Proxy]",he="[object RegExp]",pe="[object Set]",Y="[object String]",ve="[object Symbol]",bt="[object Undefined]",nt="[object WeakMap]",Be="[object ArrayBuffer]",Mt="[object DataView]",zt="[object Float32Array]",b="[object Float64Array]",S="[object Int8Array]",J="[object Int16Array]",le="[object Int32Array]",k="[object Uint8Array]",H="[object Uint8ClampedArray]",K="[object Uint16Array]",B="[object Uint32Array]",et=/[\\^$.*+?()[\]{}|]/g,ot=/^\[object .+?Constructor\]$/,Oi=/^(?:0|[1-9]\d*)$/,Ee={};Ee[zt]=Ee[b]=Ee[S]=Ee[J]=Ee[le]=Ee[k]=Ee[H]=Ee[K]=Ee[B]=!0,Ee[y]=Ee[m]=Ee[Be]=Ee[_]=Ee[Mt]=Ee[O]=Ee[$]=Ee[j]=Ee[Q]=Ee[ee]=Ee[ae]=Ee[he]=Ee[pe]=Ee[Y]=Ee[nt]=!1;var Ar=typeof Mr=="object"&&Mr&&Mr.Object===Object&&Mr,D=typeof self=="object"&&self&&self.Object===Object&&self,N=Ar||D||Function("return this")(),C=t&&!t.nodeType&&t,u=C&&!0&&a&&!a.nodeType&&a,I=u&&u.exports===C,Z=I&&Ar.process,ue=function(){try{return Z&&Z.binding&&Z.binding("util")}catch{}}(),me=ue&&ue.isTypedArray;function Re(v,x){for(var z=-1,V=v==null?0:v.length,Ue=0,de=[];++z<V;){var We=v[z];x(We,z,v)&&(de[Ue++]=We)}return de}function Ae(v,x){for(var z=-1,V=x.length,Ue=v.length;++z<V;)v[Ue+z]=x[z];return v}function Ie(v,x){for(var z=-1,V=v==null?0:v.length;++z<V;)if(x(v[z],z,v))return!0;return!1}function _t(v,x){for(var z=-1,V=Array(v);++z<v;)V[z]=x(z);return V}function gt(v){return function(x){return v(x)}}function tt(v,x){return v.has(x)}function Te(v,x){return v==null?void 0:v[x]}function Fe(v){var x=-1,z=Array(v.size);return v.forEach(function(V,Ue){z[++x]=[Ue,V]}),z}function Ve(v,x){return function(z){return v(x(z))}}function rt(v){var x=-1,z=Array(v.size);return v.forEach(function(V){z[++x]=V}),z}var Le=Array.prototype,Ge=Function.prototype,Oe=Object.prototype,Me=N["__core-js_shared__"],at=Ge.toString,$e=Oe.hasOwnProperty,Et=function(){var v=/[^.]+$/.exec(Me&&Me.keys&&Me.keys.IE_PROTO||"");return v?"Symbol(src)_1."+v:""}(),Tt=Oe.toString,Ut=RegExp("^"+at.call($e).replace(et,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ht=I?N.Buffer:void 0,Dt=N.Symbol,Wt=N.Uint8Array,er=Oe.propertyIsEnumerable,zr=Le.splice,Jt=Dt?Dt.toStringTag:void 0,Gr=Object.getOwnPropertySymbols,li=Ht?Ht.isBuffer:void 0,Ai=Ve(Object.keys,Object),ct=fr(N,"DataView"),Qe=fr(N,"Map"),ut=fr(N,"Promise"),ht=fr(N,"Set"),it=fr(N,"WeakMap"),Ye=fr(Object,"create"),It=Jr(ct),xt=Jr(Qe),lt=Jr(ut),Pt=Jr(ht),ft=Jr(it),yt=Dt?Dt.prototype:void 0,pt=yt?yt.valueOf:void 0;function Ke(v){var x=-1,z=v==null?0:v.length;for(this.clear();++x<z;){var V=v[x];this.set(V[0],V[1])}}function St(){this.__data__=Ye?Ye(null):{},this.size=0}function Rt(v){var x=this.has(v)&&delete this.__data__[v];return this.size-=x?1:0,x}function Uo(v){var x=this.__data__;if(Ye){var z=x[v];return z===s?void 0:z}return $e.call(x,v)?x[v]:void 0}function Ho(v){var x=this.__data__;return Ye?x[v]!==void 0:$e.call(x,v)}function ko(v,x){var z=this.__data__;return this.size+=this.has(v)?0:1,z[v]=Ye&&x===void 0?s:x,this}Ke.prototype.clear=St,Ke.prototype.delete=Rt,Ke.prototype.get=Uo,Ke.prototype.has=Ho,Ke.prototype.set=ko;function mr(v){var x=-1,z=v==null?0:v.length;for(this.clear();++x<z;){var V=v[x];this.set(V[0],V[1])}}function Ko(){this.__data__=[],this.size=0}function Bo(v){var x=this.__data__,z=Ci(x,v);if(z<0)return!1;var V=x.length-1;return z==V?x.pop():zr.call(x,z,1),--this.size,!0}function Fo(v){var x=this.__data__,z=Ci(x,v);return z<0?void 0:x[z][1]}function Vo(v){return Ci(this.__data__,v)>-1}function Go(v,x){var z=this.__data__,V=Ci(z,v);return V<0?(++this.size,z.push([v,x])):z[V][1]=x,this}mr.prototype.clear=Ko,mr.prototype.delete=Bo,mr.prototype.get=Fo,mr.prototype.has=Vo,mr.prototype.set=Go;function Wr(v){var x=-1,z=v==null?0:v.length;for(this.clear();++x<z;){var V=v[x];this.set(V[0],V[1])}}function Ji(){this.size=0,this.__data__={hash:new Ke,map:new(Qe||mr),string:new Ke}}function Wo(v){var x=fi(this,v).delete(v);return this.size-=x?1:0,x}function Qi(v){return fi(this,v).get(v)}function Jo(v){return fi(this,v).has(v)}function Qo(v,x){var z=fi(this,v),V=z.size;return z.set(v,x),this.size+=z.size==V?0:1,this}Wr.prototype.clear=Ji,Wr.prototype.delete=Wo,Wr.prototype.get=Qi,Wr.prototype.has=Jo,Wr.prototype.set=Qo;function Yi(v){var x=-1,z=v==null?0:v.length;for(this.__data__=new Wr;++x<z;)this.add(v[x])}function ln(v){return this.__data__.set(v,s),this}function fn(v){return this.__data__.has(v)}Yi.prototype.add=Yi.prototype.push=ln,Yi.prototype.has=fn;function Cr(v){var x=this.__data__=new mr(v);this.size=x.size}function Yo(){this.__data__=new mr,this.size=0}function Zo(v){var x=this.__data__,z=x.delete(v);return this.size=x.size,z}function Xo(v){return this.__data__.get(v)}function ea(v){return this.__data__.has(v)}function pn(v,x){var z=this.__data__;if(z instanceof mr){var V=z.__data__;if(!Qe||V.length<r-1)return V.push([v,x]),this.size=++z.size,this;z=this.__data__=new Wr(V)}return z.set(v,x),this.size=z.size,this}Cr.prototype.clear=Yo,Cr.prototype.delete=Zo,Cr.prototype.get=Xo,Cr.prototype.has=ea,Cr.prototype.set=pn;function dn(v,x){var z=es(v),V=!z&&Sn(v),Ue=!z&&!V&&Ss(v),de=!z&&!V&&!Ue&&An(v),We=z||V||Ue||de,Ot=We?_t(v.length,String):[],Pe=Ot.length;for(var He in v)$e.call(v,He)&&!(We&&(He=="length"||Ue&&(He=="offset"||He=="parent")||de&&(He=="buffer"||He=="byteLength"||He=="byteOffset")||_n(He,Pe)))&&Ot.push(He);return Ot}function Ci(v,x){for(var z=v.length;z--;)if(Pn(v[z][0],x))return z;return-1}function xs(v,x,z){var V=x(v);return es(v)?V:Ae(V,z(v))}function Ti(v){return v==null?v===void 0?bt:ce:Jt&&Jt in Object(v)?wn(v):ia(v)}function Ps(v){return $i(v)&&Ti(v)==y}function Ni(v,x,z,V,Ue){return v===x?!0:v==null||x==null||!$i(v)&&!$i(x)?v!==v&&x!==x:gn(v,x,z,V,Ni,Ue)}function gn(v,x,z,V,Ue,de){var We=es(v),Ot=es(x),Pe=We?m:Ur(v),He=Ot?m:Ur(x);Pe=Pe==y?ae:Pe,He=He==y?ae:He;var vt=Pe==ae,tr=He==ae,At=Pe==He;if(At&&Ss(v)){if(!Ss(x))return!1;We=!0,vt=!1}if(At&&!vt)return de||(de=new Cr),We||An(v)?Zi(v,x,z,V,Ue,de):ra(v,x,Pe,z,V,Ue,de);if(!(z&o)){var Je=vt&&$e.call(v,"__wrapped__"),Qt=tr&&$e.call(x,"__wrapped__");if(Je||Qt){var Tr=Je?v.value():v,wr=Qt?x.value():x;return de||(de=new Cr),Ue(Tr,wr,z,V,de)}}return At?(de||(de=new Cr),mn(v,x,z,V,Ue,de)):!1}function ta(v){if(!On(v)||In(v))return!1;var x=ts(v)?Ut:ot;return x.test(Jr(v))}function yn(v){return $i(v)&&Rn(v.length)&&!!Ee[Ti(v)]}function vn(v){if(!xn(v))return Ai(v);var x=[];for(var z in Object(v))$e.call(v,z)&&z!="constructor"&&x.push(z);return x}function Zi(v,x,z,V,Ue,de){var We=z&o,Ot=v.length,Pe=x.length;if(Ot!=Pe&&!(We&&Pe>Ot))return!1;var He=de.get(v);if(He&&de.get(x))return He==x;var vt=-1,tr=!0,At=z&h?new Yi:void 0;for(de.set(v,x),de.set(x,v);++vt<Ot;){var Je=v[vt],Qt=x[vt];if(V)var Tr=We?V(Qt,Je,vt,x,v,de):V(Je,Qt,vt,v,x,de);if(Tr!==void 0){if(Tr)continue;tr=!1;break}if(At){if(!Ie(x,function(wr,Hr){if(!tt(At,Hr)&&(Je===wr||Ue(Je,wr,z,V,de)))return At.push(Hr)})){tr=!1;break}}else if(!(Je===Qt||Ue(Je,Qt,z,V,de))){tr=!1;break}}return de.delete(v),de.delete(x),tr}function ra(v,x,z,V,Ue,de,We){switch(z){case Mt:if(v.byteLength!=x.byteLength||v.byteOffset!=x.byteOffset)return!1;v=v.buffer,x=x.buffer;case Be:return!(v.byteLength!=x.byteLength||!de(new Wt(v),new Wt(x)));case _:case O:case ee:return Pn(+v,+x);case $:return v.name==x.name&&v.message==x.message;case he:case Y:return v==x+"";case Q:var Ot=Fe;case pe:var Pe=V&o;if(Ot||(Ot=rt),v.size!=x.size&&!Pe)return!1;var He=We.get(v);if(He)return He==x;V|=h,We.set(v,x);var vt=Zi(Ot(v),Ot(x),V,Ue,de,We);return We.delete(v),vt;case ve:if(pt)return pt.call(v)==pt.call(x)}return!1}function mn(v,x,z,V,Ue,de){var We=z&o,Ot=Xi(v),Pe=Ot.length,He=Xi(x),vt=He.length;if(Pe!=vt&&!We)return!1;for(var tr=Pe;tr--;){var At=Ot[tr];if(!(We?At in x:$e.call(x,At)))return!1}var Je=de.get(v);if(Je&&de.get(x))return Je==x;var Qt=!0;de.set(v,x),de.set(x,v);for(var Tr=We;++tr<Pe;){At=Ot[tr];var wr=v[At],Hr=x[At];if(V)var Rs=We?V(Hr,wr,At,x,v,de):V(wr,Hr,At,v,x,de);if(!(Rs===void 0?wr===Hr||Ue(wr,Hr,z,V,de):Rs)){Qt=!1;break}Tr||(Tr=At=="constructor")}if(Qt&&!Tr){var Di=v.constructor,Lt=x.constructor;Di!=Lt&&"constructor"in v&&"constructor"in x&&!(typeof Di=="function"&&Di instanceof Di&&typeof Lt=="function"&&Lt instanceof Lt)&&(Qt=!1)}return de.delete(v),de.delete(x),Qt}function Xi(v){return xs(v,oa,bn)}function fi(v,x){var z=v.__data__;return En(x)?z[typeof x=="string"?"string":"hash"]:z.map}function fr(v,x){var z=Te(v,x);return ta(z)?z:void 0}function wn(v){var x=$e.call(v,Jt),z=v[Jt];try{v[Jt]=void 0;var V=!0}catch{}var Ue=Tt.call(v);return V&&(x?v[Jt]=z:delete v[Jt]),Ue}var bn=Gr?function(v){return v==null?[]:(v=Object(v),Re(Gr(v),function(x){return er.call(v,x)}))}:ze,Ur=Ti;(ct&&Ur(new ct(new ArrayBuffer(1)))!=Mt||Qe&&Ur(new Qe)!=Q||ut&&Ur(ut.resolve())!=oe||ht&&Ur(new ht)!=pe||it&&Ur(new it)!=nt)&&(Ur=function(v){var x=Ti(v),z=x==ae?v.constructor:void 0,V=z?Jr(z):"";if(V)switch(V){case It:return Mt;case xt:return Q;case lt:return oe;case Pt:return pe;case ft:return nt}return x});function _n(v,x){return x=x??f,!!x&&(typeof v=="number"||Oi.test(v))&&v>-1&&v%1==0&&v<x}function En(v){var x=typeof v;return x=="string"||x=="number"||x=="symbol"||x=="boolean"?v!=="__proto__":v===null}function In(v){return!!Et&&Et in v}function xn(v){var x=v&&v.constructor,z=typeof x=="function"&&x.prototype||Oe;return v===z}function ia(v){return Tt.call(v)}function Jr(v){if(v!=null){try{return at.call(v)}catch{}try{return v+""}catch{}}return""}function Pn(v,x){return v===x||v!==v&&x!==x}var Sn=Ps(function(){return arguments}())?Ps:function(v){return $i(v)&&$e.call(v,"callee")&&!er.call(v,"callee")},es=Array.isArray;function sa(v){return v!=null&&Rn(v.length)&&!ts(v)}var Ss=li||je;function na(v,x){return Ni(v,x)}function ts(v){if(!On(v))return!1;var x=Ti(v);return x==j||x==A||x==g||x==te}function Rn(v){return typeof v=="number"&&v>-1&&v%1==0&&v<=f}function On(v){var x=typeof v;return v!=null&&(x=="object"||x=="function")}function $i(v){return v!=null&&typeof v=="object"}var An=me?gt(me):yn;function oa(v){return sa(v)?dn(v):vn(v)}function ze(){return[]}function je(){return!1}a.exports=na})(Ao,Ao.exports);var q_=Ao.exports;const M_=sn(q_);function z_(a,t){return t=t||{},new Promise(function(r,s){var o=new XMLHttpRequest,h=[],f=[],y={},m=function(){return{ok:(o.status/100|0)==2,statusText:o.statusText,status:o.status,url:o.responseURL,text:function(){return Promise.resolve(o.responseText)},json:function(){return Promise.resolve(o.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([o.response]))},clone:m,headers:{keys:function(){return h},entries:function(){return f},get:function(_){return y[_.toLowerCase()]},has:function(_){return _.toLowerCase()in y}}}};for(var g in o.open(t.method||"get",a,!0),o.onload=function(){o.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(_,O,$){h.push(O=O.toLowerCase()),f.push([O,$]),y[O]=y[O]?y[O]+","+$:$}),r(m())},o.onerror=s,o.withCredentials=t.credentials=="include",t.headers)o.setRequestHeader(g,t.headers[g]);o.send(t.body||null)})}const U_=Object.freeze(Object.defineProperty({__proto__:null,default:z_},Symbol.toStringTag,{value:"Module"})),xl=hf(U_);var H_=self.fetch||(self.fetch=xl.default||xl);const k_=sn(H_);var K_={};function B_(a,t){if(a.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),s=0;s<r.length;s++)r[s]=255;for(var o=0;o<a.length;o++){var h=a.charAt(o),f=h.charCodeAt(0);if(r[f]!==255)throw new TypeError(h+" is ambiguous");r[f]=o}var y=a.length,m=a.charAt(0),g=Math.log(y)/Math.log(256),_=Math.log(256)/Math.log(y);function O(A){if(A instanceof Uint8Array||(ArrayBuffer.isView(A)?A=new Uint8Array(A.buffer,A.byteOffset,A.byteLength):Array.isArray(A)&&(A=Uint8Array.from(A))),!(A instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(A.length===0)return"";for(var Q=0,ee=0,ce=0,ae=A.length;ce!==ae&&A[ce]===0;)ce++,Q++;for(var oe=(ae-ce)*_+1>>>0,te=new Uint8Array(oe);ce!==ae;){for(var he=A[ce],pe=0,Y=oe-1;(he!==0||pe<ee)&&Y!==-1;Y--,pe++)he+=256*te[Y]>>>0,te[Y]=he%y>>>0,he=he/y>>>0;if(he!==0)throw new Error("Non-zero carry");ee=pe,ce++}for(var ve=oe-ee;ve!==oe&&te[ve]===0;)ve++;for(var bt=m.repeat(Q);ve<oe;++ve)bt+=a.charAt(te[ve]);return bt}function $(A){if(typeof A!="string")throw new TypeError("Expected String");if(A.length===0)return new Uint8Array;var Q=0;if(A[Q]!==" "){for(var ee=0,ce=0;A[Q]===m;)ee++,Q++;for(var ae=(A.length-Q)*g+1>>>0,oe=new Uint8Array(ae);A[Q];){var te=r[A.charCodeAt(Q)];if(te===255)return;for(var he=0,pe=ae-1;(te!==0||he<ce)&&pe!==-1;pe--,he++)te+=y*oe[pe]>>>0,oe[pe]=te%256>>>0,te=te/256>>>0;if(te!==0)throw new Error("Non-zero carry");ce=he,Q++}if(A[Q]!==" "){for(var Y=ae-ce;Y!==ae&&oe[Y]===0;)Y++;for(var ve=new Uint8Array(ee+(ae-Y)),bt=ee;Y!==ae;)ve[bt++]=oe[Y++];return ve}}}function j(A){var Q=$(A);if(Q)return Q;throw new Error(`Non-${t} character`)}return{encode:O,decodeUnsafe:$,decode:j}}var F_=B_,V_=F_;const Bf=a=>{if(a instanceof Uint8Array&&a.constructor.name==="Uint8Array")return a;if(a instanceof ArrayBuffer)return new Uint8Array(a);if(ArrayBuffer.isView(a))return new Uint8Array(a.buffer,a.byteOffset,a.byteLength);throw new Error("Unknown type, must be binary type")},G_=a=>new TextEncoder().encode(a),W_=a=>new TextDecoder().decode(a);class J_{constructor(t,r,s){this.name=t,this.prefix=r,this.baseEncode=s}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}}class Q_{constructor(t,r,s){if(this.name=t,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=s}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return Ff(this,t)}}class Y_{constructor(t){this.decoders=t}or(t){return Ff(this,t)}decode(t){const r=t[0],s=this.decoders[r];if(s)return s.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Ff=(a,t)=>new Y_({...a.decoders||{[a.prefix]:a},...t.decoders||{[t.prefix]:t}});class Z_{constructor(t,r,s,o){this.name=t,this.prefix=r,this.baseEncode=s,this.baseDecode=o,this.encoder=new J_(t,r,s),this.decoder=new Q_(t,r,o)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}}const Mo=({name:a,prefix:t,encode:r,decode:s})=>new Z_(a,t,r,s),hn=({prefix:a,name:t,alphabet:r})=>{const{encode:s,decode:o}=V_(r,t);return Mo({prefix:a,name:t,encode:s,decode:h=>Bf(o(h))})},X_=(a,t,r,s)=>{const o={};for(let _=0;_<t.length;++_)o[t[_]]=_;let h=a.length;for(;a[h-1]==="=";)--h;const f=new Uint8Array(h*r/8|0);let y=0,m=0,g=0;for(let _=0;_<h;++_){const O=o[a[_]];if(O===void 0)throw new SyntaxError(`Non-${s} character`);m=m<<r|O,y+=r,y>=8&&(y-=8,f[g++]=255&m>>y)}if(y>=r||255&m<<8-y)throw new SyntaxError("Unexpected end of data");return f},e1=(a,t,r)=>{const s=t[t.length-1]==="=",o=(1<<r)-1;let h="",f=0,y=0;for(let m=0;m<a.length;++m)for(y=y<<8|a[m],f+=8;f>r;)f-=r,h+=t[o&y>>f];if(f&&(h+=t[o&y<<r-f]),s)for(;h.length*r&7;)h+="=";return h},Kt=({name:a,prefix:t,bitsPerChar:r,alphabet:s})=>Mo({prefix:t,name:a,encode(o){return e1(o,s,r)},decode(o){return X_(o,s,r,a)}}),t1=Mo({prefix:"\0",name:"identity",encode:a=>W_(a),decode:a=>G_(a)});var r1=Object.freeze({__proto__:null,identity:t1});const i1=Kt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var s1=Object.freeze({__proto__:null,base2:i1});const n1=Kt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var o1=Object.freeze({__proto__:null,base8:n1});const a1=hn({prefix:"9",name:"base10",alphabet:"0123456789"});var c1=Object.freeze({__proto__:null,base10:a1});const u1=Kt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),h1=Kt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var l1=Object.freeze({__proto__:null,base16:u1,base16upper:h1});const f1=Kt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),p1=Kt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),d1=Kt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),g1=Kt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),y1=Kt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),v1=Kt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),m1=Kt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),w1=Kt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),b1=Kt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var _1=Object.freeze({__proto__:null,base32:f1,base32upper:p1,base32pad:d1,base32padupper:g1,base32hex:y1,base32hexupper:v1,base32hexpad:m1,base32hexpadupper:w1,base32z:b1});const E1=hn({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),I1=hn({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var x1=Object.freeze({__proto__:null,base36:E1,base36upper:I1});const P1=hn({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),S1=hn({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var R1=Object.freeze({__proto__:null,base58btc:P1,base58flickr:S1});const O1=Kt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),A1=Kt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),C1=Kt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),T1=Kt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var N1=Object.freeze({__proto__:null,base64:O1,base64pad:A1,base64url:C1,base64urlpad:T1});const Vf=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),$1=Vf.reduce((a,t,r)=>(a[r]=t,a),[]),D1=Vf.reduce((a,t,r)=>(a[t.codePointAt(0)]=r,a),[]);function L1(a){return a.reduce((t,r)=>(t+=$1[r],t),"")}function j1(a){const t=[];for(const r of a){const s=D1[r.codePointAt(0)];if(s===void 0)throw new Error(`Non-base256emoji character: ${r}`);t.push(s)}return new Uint8Array(t)}const q1=Mo({prefix:"🚀",name:"base256emoji",encode:L1,decode:j1});var M1=Object.freeze({__proto__:null,base256emoji:q1}),z1=Gf,Pl=128,U1=127,H1=~U1,k1=Math.pow(2,31);function Gf(a,t,r){t=t||[],r=r||0;for(var s=r;a>=k1;)t[r++]=a&255|Pl,a/=128;for(;a&H1;)t[r++]=a&255|Pl,a>>>=7;return t[r]=a|0,Gf.bytes=r-s+1,t}var K1=Cc,B1=128,Sl=127;function Cc(a,s){var r=0,s=s||0,o=0,h=s,f,y=a.length;do{if(h>=y)throw Cc.bytes=0,new RangeError("Could not decode varint");f=a[h++],r+=o<28?(f&Sl)<<o:(f&Sl)*Math.pow(2,o),o+=7}while(f>=B1);return Cc.bytes=h-s,r}var F1=Math.pow(2,7),V1=Math.pow(2,14),G1=Math.pow(2,21),W1=Math.pow(2,28),J1=Math.pow(2,35),Q1=Math.pow(2,42),Y1=Math.pow(2,49),Z1=Math.pow(2,56),X1=Math.pow(2,63),eE=function(a){return a<F1?1:a<V1?2:a<G1?3:a<W1?4:a<J1?5:a<Q1?6:a<Y1?7:a<Z1?8:a<X1?9:10},tE={encode:z1,decode:K1,encodingLength:eE},Wf=tE;const Rl=(a,t,r=0)=>(Wf.encode(a,t,r),t),Ol=a=>Wf.encodingLength(a),Tc=(a,t)=>{const r=t.byteLength,s=Ol(a),o=s+Ol(r),h=new Uint8Array(o+r);return Rl(a,h,0),Rl(r,h,s),h.set(t,o),new rE(a,r,t,h)};class rE{constructor(t,r,s,o){this.code=t,this.size=r,this.digest=s,this.bytes=o}}const Jf=({name:a,code:t,encode:r})=>new iE(a,t,r);class iE{constructor(t,r,s){this.name=t,this.code=r,this.encode=s}digest(t){if(t instanceof Uint8Array){const r=this.encode(t);return r instanceof Uint8Array?Tc(this.code,r):r.then(s=>Tc(this.code,s))}else throw Error("Unknown type, must be binary type")}}const Qf=a=>async t=>new Uint8Array(await crypto.subtle.digest(a,t)),sE=Jf({name:"sha2-256",code:18,encode:Qf("SHA-256")}),nE=Jf({name:"sha2-512",code:19,encode:Qf("SHA-512")});var oE=Object.freeze({__proto__:null,sha256:sE,sha512:nE});const Yf=0,aE="identity",Zf=Bf,cE=a=>Tc(Yf,Zf(a)),uE={code:Yf,name:aE,encode:Zf,digest:cE};var hE=Object.freeze({__proto__:null,identity:uE});new TextEncoder,new TextDecoder;const Al={...r1,...s1,...o1,...c1,...l1,..._1,...x1,...R1,...N1,...M1};({...oE,...hE});function Xf(a){return globalThis.Buffer!=null?new Uint8Array(a.buffer,a.byteOffset,a.byteLength):a}function lE(a=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Xf(globalThis.Buffer.allocUnsafe(a)):new Uint8Array(a)}function ep(a,t,r,s){return{name:a,prefix:t,encoder:{name:a,prefix:t,encode:r},decoder:{decode:s}}}const Cl=ep("utf8","u",a=>"u"+new TextDecoder("utf8").decode(a),a=>new TextEncoder().encode(a.substring(1))),vc=ep("ascii","a",a=>{let t="a";for(let r=0;r<a.length;r++)t+=String.fromCharCode(a[r]);return t},a=>{a=a.substring(1);const t=lE(a.length);for(let r=0;r<a.length;r++)t[r]=a.charCodeAt(r);return t}),fE={utf8:Cl,"utf-8":Cl,hex:Al.base16,latin1:vc,ascii:vc,binary:vc,...Al};function pE(a,t="utf8"){const r=fE[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Xf(globalThis.Buffer.from(a,"utf-8")):r.decoder.decode(`${r.prefix}${a}`)}const tp="wc",dE=2,Fc="core",xi=`${tp}@2:${Fc}:`,gE={name:Fc,logger:"error"},yE={database:":memory:"},vE="crypto",Tl="client_ed25519_seed",mE=re.ONE_DAY,wE="keychain",bE="0.3",_E="messages",EE="0.3",IE=re.SIX_HOURS,xE="publisher",rp="irn",PE="error",ip="wss://relay.walletconnect.com",Nl="wss://relay.walletconnect.org",SE="relayer",Gt={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},RE="_subscription",ai={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},OE=re.ONE_SECOND,AE="2.11.0",CE=1e4,TE="0.3",NE="WALLETCONNECT_CLIENT_ID",jr={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},$E="subscription",DE="0.3",LE=re.FIVE_SECONDS*1e3,jE="pairing",qE="0.3",Fs={wc_pairingDelete:{req:{ttl:re.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:re.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:re.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:re.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:re.ONE_DAY,prompt:!1,tag:0},res:{ttl:re.ONE_DAY,prompt:!1,tag:0}}},Ys={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},Fr={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},ME="history",zE="0.3",UE="expirer",Rr={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},HE="0.3",mc="verify-api",ws="https://verify.walletconnect.com",Nc="https://verify.walletconnect.org",kE=[ws,Nc],KE="echo",BE="https://echo.walletconnect.com";class FE{constructor(t,r){this.core=t,this.logger=r,this.keychain=new Map,this.name=wE,this.version=bE,this.initialized=!1,this.storagePrefix=xi,this.init=async()=>{if(!this.initialized){const s=await this.getKeyChain();typeof s<"u"&&(this.keychain=s),this.initialized=!0}},this.has=s=>(this.isInitialized(),this.keychain.has(s)),this.set=async(s,o)=>{this.isInitialized(),this.keychain.set(s,o),await this.persist()},this.get=s=>{this.isInitialized();const o=this.keychain.get(s);if(typeof o>"u"){const{message:h}=G("NO_MATCHING_KEY",`${this.name}: ${s}`);throw new Error(h)}return o},this.del=async s=>{this.isInitialized(),this.keychain.delete(s),await this.persist()},this.core=t,this.logger=lr(r,this.name)}get context(){return hr(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(t){await this.core.storage.setItem(this.storageKey,yf(t))}async getKeyChain(){const t=await this.core.storage.getItem(this.storageKey);return typeof t<"u"?vf(t):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:t}=G("NOT_INITIALIZED",this.name);throw new Error(t)}}}class VE{constructor(t,r,s){this.core=t,this.logger=r,this.name=vE,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=o=>(this.isInitialized(),this.keychain.has(o)),this.getClientId=async()=>{this.isInitialized();const o=await this.getClientSeed(),h=yl(o);return jf(h.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const o=G0();return this.setPrivateKey(o.publicKey,o.privateKey)},this.signJWT=async o=>{this.isInitialized();const h=await this.getClientSeed(),f=yl(h),y=Sc();return await g_(y,o,mE,f)},this.generateSharedKey=(o,h,f)=>{this.isInitialized();const y=this.getPrivateKey(o),m=W0(y,h);return this.setSymKey(m,f)},this.setSymKey=async(o,h)=>{this.isInitialized();const f=h||J0(o);return await this.keychain.set(f,o),f},this.deleteKeyPair=async o=>{this.isInitialized(),await this.keychain.del(o)},this.deleteSymKey=async o=>{this.isInitialized(),await this.keychain.del(o)},this.encode=async(o,h,f)=>{this.isInitialized();const y=Q0(f),m=Fi(h);if(Jh(y)){const $=y.senderPublicKey,j=y.receiverPublicKey;o=await this.generateSharedKey($,j)}const g=this.getSymKey(o),{type:_,senderPublicKey:O}=y;return Y0({type:_,symKey:g,message:m,senderPublicKey:O})},this.decode=async(o,h,f)=>{this.isInitialized();const y=Z0(h,f);if(Jh(y)){const m=y.receiverPublicKey,g=y.senderPublicKey;o=await this.generateSharedKey(m,g)}try{const m=this.getSymKey(o),g=X0({symKey:m,encoded:h});return an(g)}catch(m){this.logger.error(`Failed to decode message from topic: '${o}', clientId: '${await this.getClientId()}'`),this.logger.error(m)}},this.getPayloadType=o=>{const h=Qh(o);return ew(h.type)},this.getPayloadSenderPublicKey=o=>{const h=Qh(o);return h.senderPublicKey?To(h.senderPublicKey,tw):void 0},this.core=t,this.logger=lr(r,this.name),this.keychain=s||new FE(this.core,this.logger)}get context(){return hr(this.logger)}async setPrivateKey(t,r){return await this.keychain.set(t,r),t}getPrivateKey(t){return this.keychain.get(t)}async getClientSeed(){let t="";try{t=this.keychain.get(Tl)}catch{t=Sc(),await this.keychain.set(Tl,t)}return pE(t,"base16")}getSymKey(t){return this.keychain.get(t)}isInitialized(){if(!this.initialized){const{message:t}=G("NOT_INITIALIZED",this.name);throw new Error(t)}}}class GE extends Vb{constructor(t,r){super(t,r),this.logger=t,this.core=r,this.messages=new Map,this.name=_E,this.version=EE,this.initialized=!1,this.storagePrefix=xi,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const s=await this.getRelayerMessages();typeof s<"u"&&(this.messages=s),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(s){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(s)}finally{this.initialized=!0}}},this.set=async(s,o)=>{this.isInitialized();const h=bs(o);let f=this.messages.get(s);return typeof f>"u"&&(f={}),typeof f[h]<"u"||(f[h]=o,this.messages.set(s,f),await this.persist()),h},this.get=s=>{this.isInitialized();let o=this.messages.get(s);return typeof o>"u"&&(o={}),o},this.has=(s,o)=>{this.isInitialized();const h=this.get(s),f=bs(o);return typeof h[f]<"u"},this.del=async s=>{this.isInitialized(),this.messages.delete(s),await this.persist()},this.logger=lr(t,this.name),this.core=r}get context(){return hr(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setRelayerMessages(t){await this.core.storage.setItem(this.storageKey,yf(t))}async getRelayerMessages(){const t=await this.core.storage.getItem(this.storageKey);return typeof t<"u"?vf(t):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:t}=G("NOT_INITIALIZED",this.name);throw new Error(t)}}}class WE extends Gb{constructor(t,r){super(t,r),this.relayer=t,this.logger=r,this.events=new ur.EventEmitter,this.name=xE,this.queue=new Map,this.publishTimeout=re.toMiliseconds(re.TEN_SECONDS),this.needsTransportRestart=!1,this.publish=async(s,o,h)=>{var f;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:s,message:o,opts:h}});try{const y=(h==null?void 0:h.ttl)||IE,m=Rc(h),g=(h==null?void 0:h.prompt)||!1,_=(h==null?void 0:h.tag)||0,O=(h==null?void 0:h.id)||Kc().toString(),$={topic:s,message:o,opts:{ttl:y,relay:m,prompt:g,tag:_,id:O}},j=setTimeout(()=>this.queue.set(O,$),this.publishTimeout);try{await await en(this.rpcPublish(s,o,y,m,g,_,O),this.publishTimeout,"Failed to publish payload, please try again."),this.removeRequestFromQueue(O),this.relayer.events.emit(Gt.publish,$)}catch(A){if(this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0,(f=h==null?void 0:h.internal)!=null&&f.throwOnFailedPublish)throw this.removeRequestFromQueue(O),A;return}finally{clearTimeout(j)}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:s,message:o,opts:h}})}catch(y){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(y),y}},this.on=(s,o)=>{this.events.on(s,o)},this.once=(s,o)=>{this.events.once(s,o)},this.off=(s,o)=>{this.events.off(s,o)},this.removeListener=(s,o)=>{this.events.removeListener(s,o)},this.relayer=t,this.logger=lr(r,this.name),this.registerEventListeners()}get context(){return hr(this.logger)}rpcPublish(t,r,s,o,h,f,y){var m,g,_,O;const $={method:Io(o.protocol).publish,params:{topic:t,message:r,ttl:s,prompt:h,tag:f},id:y};return Ii((m=$.params)==null?void 0:m.prompt)&&((g=$.params)==null||delete g.prompt),Ii((_=$.params)==null?void 0:_.tag)&&((O=$.params)==null||delete O.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:$}),this.relayer.request($)}removeRequestFromQueue(t){this.queue.delete(t)}checkQueue(){this.queue.forEach(async t=>{const{topic:r,message:s,opts:o}=t;await this.publish(r,s,o)})}registerEventListeners(){this.relayer.core.heartbeat.on(Is.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(Gt.connection_stalled);return}this.checkQueue()}),this.relayer.on(Gt.message_ack,t=>{this.removeRequestFromQueue(t.id.toString())})}}class JE{constructor(){this.map=new Map,this.set=(t,r)=>{const s=this.get(t);this.exists(t,r)||this.map.set(t,[...s,r])},this.get=t=>this.map.get(t)||[],this.exists=(t,r)=>this.get(t).includes(r),this.delete=(t,r)=>{if(typeof r>"u"){this.map.delete(t);return}if(!this.map.has(t))return;const s=this.get(t);if(!this.exists(t,r))return;const o=s.filter(h=>h!==r);if(!o.length){this.map.delete(t);return}this.map.set(t,o)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var QE=Object.defineProperty,YE=Object.defineProperties,ZE=Object.getOwnPropertyDescriptors,$l=Object.getOwnPropertySymbols,XE=Object.prototype.hasOwnProperty,eI=Object.prototype.propertyIsEnumerable,Dl=(a,t,r)=>t in a?QE(a,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[t]=r,Vs=(a,t)=>{for(var r in t||(t={}))XE.call(t,r)&&Dl(a,r,t[r]);if($l)for(var r of $l(t))eI.call(t,r)&&Dl(a,r,t[r]);return a},wc=(a,t)=>YE(a,ZE(t));class tI extends Qb{constructor(t,r){super(t,r),this.relayer=t,this.logger=r,this.subscriptions=new Map,this.topicMap=new JE,this.events=new ur.EventEmitter,this.name=$E,this.version=DE,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=xi,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(s,o)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:s,opts:o}});try{const h=Rc(o),f={topic:s,relay:h};this.pending.set(s,f);const y=await this.rpcSubscribe(s,h);return this.onSubscribe(y,f),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:s,opts:o}}),y}catch(h){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(h),h}},this.unsubscribe=async(s,o)=>{await this.restartToComplete(),this.isInitialized(),typeof(o==null?void 0:o.id)<"u"?await this.unsubscribeById(s,o.id,o):await this.unsubscribeByTopic(s,o)},this.isSubscribed=async s=>this.topics.includes(s)?!0:await new Promise((o,h)=>{const f=new re.Watch;f.start(this.pendingSubscriptionWatchLabel);const y=setInterval(()=>{!this.pending.has(s)&&this.topics.includes(s)&&(clearInterval(y),f.stop(this.pendingSubscriptionWatchLabel),o(!0)),f.elapsed(this.pendingSubscriptionWatchLabel)>=LE&&(clearInterval(y),f.stop(this.pendingSubscriptionWatchLabel),h(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1),this.on=(s,o)=>{this.events.on(s,o)},this.once=(s,o)=>{this.events.once(s,o)},this.off=(s,o)=>{this.events.off(s,o)},this.removeListener=(s,o)=>{this.events.removeListener(s,o)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=t,this.logger=lr(r,this.name),this.clientId=""}get context(){return hr(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(t,r){let s=!1;try{s=this.getSubscription(t).topic===r}catch{}return s}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(t,r){const s=this.topicMap.get(t);await Promise.all(s.map(async o=>await this.unsubscribeById(t,o,r)))}async unsubscribeById(t,r,s){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:r,opts:s}});try{const o=Rc(s);await this.rpcUnsubscribe(t,r,o);const h=Vt("USER_DISCONNECTED",`${this.name}, ${t}`);await this.onUnsubscribe(t,r,h),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:r,opts:s}})}catch(o){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(o),o}}async rpcSubscribe(t,r){const s={method:Io(r.protocol).subscribe,params:{topic:t}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});try{await await en(this.relayer.request(s),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(Gt.connection_stalled)}return bs(t+this.clientId)}async rpcBatchSubscribe(t){if(!t.length)return;const r=t[0].relay,s={method:Io(r.protocol).batchSubscribe,params:{topics:t.map(o=>o.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});try{return await await en(this.relayer.request(s),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(Gt.connection_stalled)}}rpcUnsubscribe(t,r,s){const o={method:Io(s.protocol).unsubscribe,params:{topic:t,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:o}),this.relayer.request(o)}onSubscribe(t,r){this.setSubscription(t,wc(Vs({},r),{id:t})),this.pending.delete(r.topic)}onBatchSubscribe(t){t.length&&t.forEach(r=>{this.setSubscription(r.id,Vs({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(t,r,s){this.events.removeAllListeners(r),this.hasSubscription(r,t)&&this.deleteSubscription(r,s),await this.relayer.messages.del(t)}async setRelayerSubscriptions(t){await this.relayer.core.storage.setItem(this.storageKey,t)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(t,r){this.subscriptions.has(t)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:t,subscription:r}),this.addSubscription(t,r))}addSubscription(t,r){this.subscriptions.set(t,Vs({},r)),this.topicMap.set(r.topic,t),this.events.emit(jr.created,r)}getSubscription(t){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:t});const r=this.subscriptions.get(t);if(!r){const{message:s}=G("NO_MATCHING_KEY",`${this.name}: ${t}`);throw new Error(s)}return r}deleteSubscription(t,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:t,reason:r});const s=this.getSubscription(t);this.subscriptions.delete(t),this.topicMap.delete(s.topic,t),this.events.emit(jr.deleted,wc(Vs({},s),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(jr.sync)}async reset(){if(this.cached.length){const t=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<t;r++){const s=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(s)}}this.events.emit(jr.resubscribed)}async restore(){try{const t=await this.getRelayerSubscriptions();if(typeof t>"u"||!t.length)return;if(this.subscriptions.size){const{message:r}=G("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(t){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(t)}}async batchSubscribe(t){if(!t.length)return;const r=await this.rpcBatchSubscribe(t);Es(r)&&this.onBatchSubscribe(r.map((s,o)=>wc(Vs({},t[o]),{id:s})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(!this.initialized||this.relayer.transportExplicitlyClosed)return;const t=[];this.pending.forEach(r=>{t.push(r)}),await this.batchSubscribe(t)}registerEventListeners(){this.relayer.core.heartbeat.on(Is.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(Gt.connect,async()=>{await this.onConnect()}),this.relayer.on(Gt.disconnect,()=>{this.onDisconnect()}),this.events.on(jr.created,async t=>{const r=jr.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),await this.persist()}),this.events.on(jr.deleted,async t=>{const r=jr.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:t}=G("NOT_INITIALIZED",this.name);throw new Error(t)}}async restartToComplete(){this.restartInProgress&&await new Promise(t=>{const r=setInterval(()=>{this.restartInProgress||(clearInterval(r),t())},this.pollingInterval)})}}var rI=Object.defineProperty,Ll=Object.getOwnPropertySymbols,iI=Object.prototype.hasOwnProperty,sI=Object.prototype.propertyIsEnumerable,jl=(a,t,r)=>t in a?rI(a,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[t]=r,nI=(a,t)=>{for(var r in t||(t={}))iI.call(t,r)&&jl(a,r,t[r]);if(Ll)for(var r of Ll(t))sI.call(t,r)&&jl(a,r,t[r]);return a};class oI extends Wb{constructor(t){super(t),this.protocol="wc",this.version=2,this.events=new ur.EventEmitter,this.name=SE,this.transportExplicitlyClosed=!1,this.initialized=!1,this.connectionAttemptInProgress=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.hasExperiencedNetworkDisruption=!1,this.request=async r=>{this.logger.debug("Publishing Request Payload");try{return await this.toEstablishConnection(),await this.provider.request(r)}catch(s){throw this.logger.debug("Failed to Publish Request"),this.logger.error(s),s}},this.onPayloadHandler=r=>{this.onProviderPayload(r)},this.onConnectHandler=()=>{this.events.emit(Gt.connect)},this.onDisconnectHandler=()=>{this.onProviderDisconnect()},this.onProviderErrorHandler=r=>{this.logger.error(r),this.events.emit(Gt.error,r),this.logger.info("Fatal socket error received, closing transport"),this.transportClose()},this.registerProviderListeners=()=>{this.provider.on(ai.payload,this.onPayloadHandler),this.provider.on(ai.connect,this.onConnectHandler),this.provider.on(ai.disconnect,this.onDisconnectHandler),this.provider.on(ai.error,this.onProviderErrorHandler)},this.core=t.core,this.logger=typeof t.logger<"u"&&typeof t.logger!="string"?lr(t.logger,this.name):Do(Lo({level:t.logger||PE})),this.messages=new GE(this.logger,t.core),this.subscriber=new tI(this,this.logger),this.publisher=new WE(this,this.logger),this.relayUrl=(t==null?void 0:t.relayUrl)||ip,this.projectId=t.projectId,this.bundleId=rw(),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${Nl}...`),await this.restartTransport(Nl)}this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},CE)}get context(){return hr(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(t,r,s){this.isInitialized(),await this.publisher.publish(t,r,s),await this.recordMessageEvent({topic:t,message:r,publishedAt:Date.now()})}async subscribe(t,r){var s;this.isInitialized();let o=((s=this.subscriber.topicMap.get(t))==null?void 0:s[0])||"";if(o)return o;let h;const f=y=>{y.topic===t&&(this.subscriber.off(jr.created,f),h())};return await Promise.all([new Promise(y=>{h=y,this.subscriber.on(jr.created,f)}),new Promise(async y=>{o=await this.subscriber.subscribe(t,r),y()})]),o}async unsubscribe(t,r){this.isInitialized(),await this.subscriber.unsubscribe(t,r)}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async transportClose(){this.transportExplicitlyClosed=!0,this.hasExperiencedNetworkDisruption&&this.connected?await en(this.provider.disconnect(),1e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.connected&&await this.provider.disconnect()}async transportOpen(t){if(this.transportExplicitlyClosed=!1,await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress){t&&t!==this.relayUrl&&(this.relayUrl=t,await this.transportClose(),await this.createProvider()),this.connectionAttemptInProgress=!0;try{await Promise.all([new Promise(r=>{if(!this.initialized)return r();this.subscriber.once(jr.resubscribed,()=>{r()})}),new Promise(async(r,s)=>{try{await en(this.provider.connect(),1e4,`Socket stalled when trying to connect to ${this.relayUrl}`)}catch(o){s(o);return}r()})])}catch(r){this.logger.error(r);const s=r;if(!this.isConnectionStalled(s.message))throw r;this.provider.events.emit(ai.disconnect)}finally{this.connectionAttemptInProgress=!1,this.hasExperiencedNetworkDisruption=!1}}}async restartTransport(t){await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress&&(this.relayUrl=t||this.relayUrl,await this.transportClose(),await this.createProvider(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await Yh())throw new Error("No internet connection detected. Please restart your network and try again.")}isConnectionStalled(t){return this.staleConnectionErrors.some(r=>t.includes(r))}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const t=await this.core.crypto.signJWT(this.relayUrl);this.provider=new N_(new j_(iw({sdkVersion:AE,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:t,useOnCloseEvent:!0,bundleId:this.bundleId}))),this.registerProviderListeners()}async recordMessageEvent(t){const{topic:r,message:s}=t;await this.messages.set(r,s)}async shouldIgnoreMessageEvent(t){const{topic:r,message:s}=t;if(!s||s.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${s}`),!0;if(!await this.subscriber.isSubscribed(r))return this.logger.debug(`Ignoring message for non-subscribed topic ${r}`),!0;const o=this.messages.has(r,s);return o&&this.logger.debug(`Ignoring duplicate message: ${s}`),o}async onProviderPayload(t){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:t}),Bc(t)){if(!t.method.endsWith(RE))return;const r=t.params,{topic:s,message:o,publishedAt:h}=r.data,f={topic:s,message:o,publishedAt:h};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(nI({type:"event",event:r.id},f)),this.events.emit(r.id,f),await this.acknowledgePayload(t),await this.onMessageEvent(f)}else un(t)&&this.events.emit(Gt.message_ack,t)}async onMessageEvent(t){await this.shouldIgnoreMessageEvent(t)||(this.events.emit(Gt.message,t),await this.recordMessageEvent(t))}async acknowledgePayload(t){const r=jo(t.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(ai.payload,this.onPayloadHandler),this.provider.off(ai.connect,this.onConnectHandler),this.provider.off(ai.disconnect,this.onDisconnectHandler),this.provider.off(ai.error,this.onProviderErrorHandler)}async registerEventListeners(){this.events.on(Gt.connection_stalled,()=>{this.restartTransport().catch(r=>this.logger.error(r))});let t=await Yh();sw(async r=>{this.initialized&&t!==r&&(t=r,r?await this.restartTransport().catch(s=>this.logger.error(s)):(this.hasExperiencedNetworkDisruption=!0,await this.transportClose().catch(s=>this.logger.error(s))))})}onProviderDisconnect(){this.events.emit(Gt.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||(this.logger.info("attemptToReconnect called. Connecting..."),setTimeout(async()=>{await this.restartTransport().catch(t=>this.logger.error(t))},re.toMiliseconds(OE)))}isInitialized(){if(!this.initialized){const{message:t}=G("NOT_INITIALIZED",this.name);throw new Error(t)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectionAttemptInProgress)return await new Promise(t=>{const r=setInterval(()=>{this.connected&&(clearInterval(r),t())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var aI=Object.defineProperty,ql=Object.getOwnPropertySymbols,cI=Object.prototype.hasOwnProperty,uI=Object.prototype.propertyIsEnumerable,Ml=(a,t,r)=>t in a?aI(a,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[t]=r,zl=(a,t)=>{for(var r in t||(t={}))cI.call(t,r)&&Ml(a,r,t[r]);if(ql)for(var r of ql(t))uI.call(t,r)&&Ml(a,r,t[r]);return a};class zo extends Jb{constructor(t,r,s,o=xi,h=void 0){super(t,r,s,o),this.core=t,this.logger=r,this.name=s,this.map=new Map,this.version=TE,this.cached=[],this.initialized=!1,this.storagePrefix=xi,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(f=>{this.getKey&&f!==null&&!Ii(f)?this.map.set(this.getKey(f),f):F0(f)?this.map.set(f.id,f):V0(f)&&this.map.set(f.topic,f)}),this.cached=[],this.initialized=!0)},this.set=async(f,y)=>{this.isInitialized(),this.map.has(f)?await this.update(f,y):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:f,value:y}),this.map.set(f,y),await this.persist())},this.get=f=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:f}),this.getData(f)),this.getAll=f=>(this.isInitialized(),f?this.values.filter(y=>Object.keys(f).every(m=>M_(y[m],f[m]))):this.values),this.update=async(f,y)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:f,update:y});const m=zl(zl({},this.getData(f)),y);this.map.set(f,m),await this.persist()},this.delete=async(f,y)=>{this.isInitialized(),this.map.has(f)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:f,reason:y}),this.map.delete(f),await this.persist())},this.logger=lr(r,this.name),this.storagePrefix=o,this.getKey=h}get context(){return hr(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(t){await this.core.storage.setItem(this.storageKey,t)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(t){const r=this.map.get(t);if(!r){const{message:s}=G("NO_MATCHING_KEY",`${this.name}: ${t}`);throw this.logger.error(s),new Error(s)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const t=await this.getDataStore();if(typeof t>"u"||!t.length)return;if(this.map.size){const{message:r}=G("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(t){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(t)}}isInitialized(){if(!this.initialized){const{message:t}=G("NOT_INITIALIZED",this.name);throw new Error(t)}}}class hI{constructor(t,r){this.core=t,this.logger=r,this.name=jE,this.version=qE,this.events=new zc,this.initialized=!1,this.storagePrefix=xi,this.ignoredPayloadTypes=[pf],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:s})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...s])]},this.create=async()=>{this.isInitialized();const s=Sc(),o=await this.core.crypto.setSymKey(s),h=qr(re.FIVE_MINUTES),f={protocol:rp},y={topic:o,expiry:h,relay:f,active:!1},m=nw({protocol:this.core.protocol,version:this.core.version,topic:o,symKey:s,relay:f});return await this.pairings.set(o,y),await this.core.relayer.subscribe(o),this.core.expirer.set(o,h),{topic:o,uri:m}},this.pair=async s=>{this.isInitialized(),this.isValidPair(s);const{topic:o,symKey:h,relay:f}=Zh(s.uri);let y;if(this.pairings.keys.includes(o)&&(y=this.pairings.get(o),y.active))throw new Error(`Pairing already exists: ${o}. Please try again with a new connection URI.`);const m=qr(re.FIVE_MINUTES),g={topic:o,relay:f,expiry:m,active:!1};return await this.pairings.set(o,g),this.core.expirer.set(o,m),s.activatePairing&&await this.activate({topic:o}),this.events.emit(Ys.create,g),this.core.crypto.keychain.has(o)||(await this.core.crypto.setSymKey(h,o),await this.core.relayer.subscribe(o,{relay:f})),g},this.activate=async({topic:s})=>{this.isInitialized();const o=qr(re.THIRTY_DAYS);await this.pairings.update(s,{active:!0,expiry:o}),this.core.expirer.set(s,o)},this.ping=async s=>{this.isInitialized(),await this.isValidPing(s);const{topic:o}=s;if(this.pairings.keys.includes(o)){const h=await this.sendRequest(o,"wc_pairingPing",{}),{done:f,resolve:y,reject:m}=vs();this.events.once(Ct("pairing_ping",h),({error:g})=>{g?m(g):y()}),await f()}},this.updateExpiry=async({topic:s,expiry:o})=>{this.isInitialized(),await this.pairings.update(s,{expiry:o})},this.updateMetadata=async({topic:s,metadata:o})=>{this.isInitialized(),await this.pairings.update(s,{peerMetadata:o})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async s=>{this.isInitialized(),await this.isValidDisconnect(s);const{topic:o}=s;this.pairings.keys.includes(o)&&(await this.sendRequest(o,"wc_pairingDelete",Vt("USER_DISCONNECTED")),await this.deletePairing(o))},this.sendRequest=async(s,o,h)=>{const f=Bi(o,h),y=await this.core.crypto.encode(s,f),m=Fs[o].req;return this.core.history.set(s,f),this.core.relayer.publish(s,y,m),f.id},this.sendResult=async(s,o,h)=>{const f=jo(s,h),y=await this.core.crypto.encode(o,f),m=await this.core.history.get(o,s),g=Fs[m.request.method].res;await this.core.relayer.publish(o,y,g),await this.core.history.resolve(f)},this.sendError=async(s,o,h)=>{const f=qo(s,h),y=await this.core.crypto.encode(o,f),m=await this.core.history.get(o,s),g=Fs[m.request.method]?Fs[m.request.method].res:Fs.unregistered_method.res;await this.core.relayer.publish(o,y,g),await this.core.history.resolve(f)},this.deletePairing=async(s,o)=>{await this.core.relayer.unsubscribe(s),await Promise.all([this.pairings.delete(s,Vt("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(s),o?Promise.resolve():this.core.expirer.del(s)])},this.cleanup=async()=>{const s=this.pairings.getAll().filter(o=>Ei(o.expiry));await Promise.all(s.map(o=>this.deletePairing(o.topic)))},this.onRelayEventRequest=s=>{const{topic:o,payload:h}=s;switch(h.method){case"wc_pairingPing":return this.onPairingPingRequest(o,h);case"wc_pairingDelete":return this.onPairingDeleteRequest(o,h);default:return this.onUnknownRpcMethodRequest(o,h)}},this.onRelayEventResponse=async s=>{const{topic:o,payload:h}=s,f=(await this.core.history.get(o,h.id)).request.method;switch(f){case"wc_pairingPing":return this.onPairingPingResponse(o,h);default:return this.onUnknownRpcMethodResponse(f)}},this.onPairingPingRequest=async(s,o)=>{const{id:h}=o;try{this.isValidPing({topic:s}),await this.sendResult(h,s,!0),this.events.emit(Ys.ping,{id:h,topic:s})}catch(f){await this.sendError(h,s,f),this.logger.error(f)}},this.onPairingPingResponse=(s,o)=>{const{id:h}=o;setTimeout(()=>{ui(o)?this.events.emit(Ct("pairing_ping",h),{}):Or(o)&&this.events.emit(Ct("pairing_ping",h),{error:o.error})},500)},this.onPairingDeleteRequest=async(s,o)=>{const{id:h}=o;try{this.isValidDisconnect({topic:s}),await this.deletePairing(s),this.events.emit(Ys.delete,{id:h,topic:s})}catch(f){await this.sendError(h,s,f),this.logger.error(f)}},this.onUnknownRpcMethodRequest=async(s,o)=>{const{id:h,method:f}=o;try{if(this.registeredMethods.includes(f))return;const y=Vt("WC_METHOD_UNSUPPORTED",f);await this.sendError(h,s,y),this.logger.error(y)}catch(y){await this.sendError(h,s,y),this.logger.error(y)}},this.onUnknownRpcMethodResponse=s=>{this.registeredMethods.includes(s)||this.logger.error(Vt("WC_METHOD_UNSUPPORTED",s))},this.isValidPair=s=>{var o;if(!cr(s)){const{message:f}=G("MISSING_OR_INVALID",`pair() params: ${s}`);throw new Error(f)}if(!ow(s.uri)){const{message:f}=G("MISSING_OR_INVALID",`pair() uri: ${s.uri}`);throw new Error(f)}const h=Zh(s.uri);if(!((o=h==null?void 0:h.relay)!=null&&o.protocol)){const{message:f}=G("MISSING_OR_INVALID","pair() uri#relay-protocol");throw new Error(f)}if(!(h!=null&&h.symKey)){const{message:f}=G("MISSING_OR_INVALID","pair() uri#symKey");throw new Error(f)}},this.isValidPing=async s=>{if(!cr(s)){const{message:h}=G("MISSING_OR_INVALID",`ping() params: ${s}`);throw new Error(h)}const{topic:o}=s;await this.isValidPairingTopic(o)},this.isValidDisconnect=async s=>{if(!cr(s)){const{message:h}=G("MISSING_OR_INVALID",`disconnect() params: ${s}`);throw new Error(h)}const{topic:o}=s;await this.isValidPairingTopic(o)},this.isValidPairingTopic=async s=>{if(!ms(s,!1)){const{message:o}=G("MISSING_OR_INVALID",`pairing topic should be a string: ${s}`);throw new Error(o)}if(!this.pairings.keys.includes(s)){const{message:o}=G("NO_MATCHING_KEY",`pairing topic doesn't exist: ${s}`);throw new Error(o)}if(Ei(this.pairings.get(s).expiry)){await this.deletePairing(s);const{message:o}=G("EXPIRED",`pairing topic: ${s}`);throw new Error(o)}},this.core=t,this.logger=lr(r,this.name),this.pairings=new zo(this.core,this.logger,this.name,this.storagePrefix)}get context(){return hr(this.logger)}isInitialized(){if(!this.initialized){const{message:t}=G("NOT_INITIALIZED",this.name);throw new Error(t)}}registerRelayerEvents(){this.core.relayer.on(Gt.message,async t=>{const{topic:r,message:s}=t;if(!this.pairings.keys.includes(r)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(s)))return;const o=await this.core.crypto.decode(r,s);try{Bc(o)?(this.core.history.set(r,o),this.onRelayEventRequest({topic:r,payload:o})):un(o)&&(await this.core.history.resolve(o),await this.onRelayEventResponse({topic:r,payload:o}),this.core.history.delete(r,o.id))}catch(h){this.logger.error(h)}})}registerExpirerEvents(){this.core.expirer.on(Rr.expired,async t=>{const{topic:r}=df(t.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit(Ys.expire,{topic:r}))})}}class lI extends Fb{constructor(t,r){super(t,r),this.core=t,this.logger=r,this.records=new Map,this.events=new ur.EventEmitter,this.name=ME,this.version=zE,this.cached=[],this.initialized=!1,this.storagePrefix=xi,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(s=>this.records.set(s.id,s)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(s,o,h)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:s,request:o,chainId:h}),this.records.has(o.id))return;const f={id:o.id,topic:s,request:{method:o.method,params:o.params||null},chainId:h,expiry:qr(re.THIRTY_DAYS)};this.records.set(f.id,f),this.events.emit(Fr.created,f)},this.resolve=async s=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:s}),!this.records.has(s.id))return;const o=await this.getRecord(s.id);typeof o.response>"u"&&(o.response=Or(s)?{error:s.error}:{result:s.result},this.records.set(o.id,o),this.events.emit(Fr.updated,o))},this.get=async(s,o)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:s,id:o}),await this.getRecord(o)),this.delete=(s,o)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:o}),this.values.forEach(h=>{if(h.topic===s){if(typeof o<"u"&&h.id!==o)return;this.records.delete(h.id),this.events.emit(Fr.deleted,h)}})},this.exists=async(s,o)=>(this.isInitialized(),this.records.has(o)?(await this.getRecord(o)).topic===s:!1),this.on=(s,o)=>{this.events.on(s,o)},this.once=(s,o)=>{this.events.once(s,o)},this.off=(s,o)=>{this.events.off(s,o)},this.removeListener=(s,o)=>{this.events.removeListener(s,o)},this.logger=lr(r,this.name)}get context(){return hr(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const t=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const s={topic:r.topic,request:Bi(r.request.method,r.request.params,r.id),chainId:r.chainId};return t.push(s)}),t}async setJsonRpcRecords(t){await this.core.storage.setItem(this.storageKey,t)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(t){this.isInitialized();const r=this.records.get(t);if(!r){const{message:s}=G("NO_MATCHING_KEY",`${this.name}: ${t}`);throw new Error(s)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Fr.sync)}async restore(){try{const t=await this.getJsonRpcRecords();if(typeof t>"u"||!t.length)return;if(this.records.size){const{message:r}=G("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(t){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(t)}}registerEventListeners(){this.events.on(Fr.created,t=>{const r=Fr.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.events.on(Fr.updated,t=>{const r=Fr.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.events.on(Fr.deleted,t=>{const r=Fr.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.core.heartbeat.on(Is.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(t=>{re.toMiliseconds(t.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${t.id}`),this.delete(t.topic,t.id))})}catch(t){this.logger.warn(t)}}isInitialized(){if(!this.initialized){const{message:t}=G("NOT_INITIALIZED",this.name);throw new Error(t)}}}class fI extends Yb{constructor(t,r){super(t,r),this.core=t,this.logger=r,this.expirations=new Map,this.events=new ur.EventEmitter,this.name=UE,this.version=HE,this.cached=[],this.initialized=!1,this.storagePrefix=xi,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(s=>this.expirations.set(s.target,s)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=s=>{try{const o=this.formatTarget(s);return typeof this.getExpiration(o)<"u"}catch{return!1}},this.set=(s,o)=>{this.isInitialized();const h=this.formatTarget(s),f={target:h,expiry:o};this.expirations.set(h,f),this.checkExpiry(h,f),this.events.emit(Rr.created,{target:h,expiration:f})},this.get=s=>{this.isInitialized();const o=this.formatTarget(s);return this.getExpiration(o)},this.del=s=>{if(this.isInitialized(),this.has(s)){const o=this.formatTarget(s),h=this.getExpiration(o);this.expirations.delete(o),this.events.emit(Rr.deleted,{target:o,expiration:h})}},this.on=(s,o)=>{this.events.on(s,o)},this.once=(s,o)=>{this.events.once(s,o)},this.off=(s,o)=>{this.events.off(s,o)},this.removeListener=(s,o)=>{this.events.removeListener(s,o)},this.logger=lr(r,this.name)}get context(){return hr(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(t){if(typeof t=="string")return aw(t);if(typeof t=="number")return cw(t);const{message:r}=G("UNKNOWN_TYPE",`Target type: ${typeof t}`);throw new Error(r)}async setExpirations(t){await this.core.storage.setItem(this.storageKey,t)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Rr.sync)}async restore(){try{const t=await this.getExpirations();if(typeof t>"u"||!t.length)return;if(this.expirations.size){const{message:r}=G("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(t){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(t)}}getExpiration(t){const r=this.expirations.get(t);if(!r){const{message:s}=G("NO_MATCHING_KEY",`${this.name}: ${t}`);throw this.logger.error(s),new Error(s)}return r}checkExpiry(t,r){const{expiry:s}=r;re.toMiliseconds(s)-Date.now()<=0&&this.expire(t,r)}expire(t,r){this.expirations.delete(t),this.events.emit(Rr.expired,{target:t,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((t,r)=>this.checkExpiry(r,t))}registerEventListeners(){this.core.heartbeat.on(Is.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(Rr.created,t=>{const r=Rr.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()}),this.events.on(Rr.expired,t=>{const r=Rr.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()}),this.events.on(Rr.deleted,t=>{const r=Rr.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()})}isInitialized(){if(!this.initialized){const{message:t}=G("NOT_INITIALIZED",this.name);throw new Error(t)}}}class pI extends Zb{constructor(t,r){super(t,r),this.projectId=t,this.logger=r,this.name=mc,this.initialized=!1,this.queue=[],this.verifyDisabled=!1,this.init=async s=>{if(this.verifyDisabled||uw()||!gf())return;const o=this.getVerifyUrl(s==null?void 0:s.verifyUrl);this.verifyUrl!==o&&this.removeIframe(),this.verifyUrl=o;try{await this.createIframe()}catch(h){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(h)}if(!this.initialized){this.removeIframe(),this.verifyUrl=Nc;try{await this.createIframe()}catch(h){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(h),this.verifyDisabled=!0}}},this.register=async s=>{this.initialized?this.sendPost(s.attestationId):(this.addToQueue(s.attestationId),await this.init())},this.resolve=async s=>{if(this.isDevEnv)return"";const o=this.getVerifyUrl(s==null?void 0:s.verifyUrl);let h;try{h=await this.fetchAttestation(s.attestationId,o)}catch(f){this.logger.info(`failed to resolve attestation: ${s.attestationId} from url: ${o}`),this.logger.info(f),h=await this.fetchAttestation(s.attestationId,Nc)}return h},this.fetchAttestation=async(s,o)=>{this.logger.info(`resolving attestation: ${s} from url: ${o}`);const h=this.startAbortTimer(re.ONE_SECOND*2),f=await fetch(`${o}/attestation/${s}`,{signal:this.abortController.signal});return clearTimeout(h),f.status===200?await f.json():void 0},this.addToQueue=s=>{this.queue.push(s)},this.processQueue=()=>{this.queue.length!==0&&(this.queue.forEach(s=>this.sendPost(s)),this.queue=[])},this.sendPost=s=>{var o;try{if(!this.iframe)return;(o=this.iframe.contentWindow)==null||o.postMessage(s,"*"),this.logger.info(`postMessage sent: ${s} ${this.verifyUrl}`)}catch{}},this.createIframe=async()=>{let s;const o=h=>{h.data==="verify_ready"&&(this.initialized=!0,this.processQueue(),window.removeEventListener("message",o),s())};await Promise.race([new Promise(h=>{if(document.getElementById(mc))return h();window.addEventListener("message",o);const f=document.createElement("iframe");f.id=mc,f.src=`${this.verifyUrl}/${this.projectId}`,f.style.display="none",document.body.append(f),this.iframe=f,s=h}),new Promise((h,f)=>setTimeout(()=>{window.removeEventListener("message",o),f("verify iframe load timeout")},re.toMiliseconds(re.FIVE_SECONDS)))])},this.removeIframe=()=>{this.iframe&&(this.iframe.remove(),this.iframe=void 0,this.initialized=!1)},this.getVerifyUrl=s=>{let o=s||ws;return kE.includes(o)||(this.logger.info(`verify url: ${o}, not included in trusted list, assigning default: ${ws}`),o=ws),o},this.logger=lr(r,this.name),this.verifyUrl=ws,this.abortController=new AbortController,this.isDevEnv=hw()&&K_.IS_VITEST}get context(){return hr(this.logger)}startAbortTimer(t){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),re.toMiliseconds(t))}}class dI extends Xb{constructor(t,r){super(t,r),this.projectId=t,this.logger=r,this.context=KE,this.registerDeviceToken=async s=>{const{clientId:o,token:h,notificationType:f,enableEncrypted:y=!1}=s,m=`${BE}/${this.projectId}/clients`;await k_(m,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:o,type:f,token:h,always_raw:y})})},this.logger=lr(r,this.context)}}var gI=Object.defineProperty,Ul=Object.getOwnPropertySymbols,yI=Object.prototype.hasOwnProperty,vI=Object.prototype.propertyIsEnumerable,Hl=(a,t,r)=>t in a?gI(a,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[t]=r,kl=(a,t)=>{for(var r in t||(t={}))yI.call(t,r)&&Hl(a,r,t[r]);if(Ul)for(var r of Ul(t))vI.call(t,r)&&Hl(a,r,t[r]);return a};class Vc extends Bb{constructor(t){super(t),this.protocol=tp,this.version=dE,this.name=Fc,this.events=new ur.EventEmitter,this.initialized=!1,this.on=(s,o)=>this.events.on(s,o),this.once=(s,o)=>this.events.once(s,o),this.off=(s,o)=>this.events.off(s,o),this.removeListener=(s,o)=>this.events.removeListener(s,o),this.projectId=t==null?void 0:t.projectId,this.relayUrl=(t==null?void 0:t.relayUrl)||ip,this.customStoragePrefix=t!=null&&t.customStoragePrefix?`:${t.customStoragePrefix}`:"";const r=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:Do(Lo({level:(t==null?void 0:t.logger)||gE.logger}));this.logger=lr(r,this.name),this.heartbeat=new Is.HeartBeat,this.crypto=new VE(this,this.logger,t==null?void 0:t.keychain),this.history=new lI(this,this.logger),this.expirer=new fI(this,this.logger),this.storage=t!=null&&t.storage?t.storage:new pb(kl(kl({},yE),t==null?void 0:t.storageOptions)),this.relayer=new oI({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new hI(this,this.logger),this.verify=new pI(this.projectId||"",this.logger),this.echoClient=new dI(this.projectId||"",this.logger)}static async init(t){const r=new Vc(t);await r.initialize();const s=await r.crypto.getClientId();return await r.storage.setItem(NE,s),r}get context(){return hr(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(t){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,t),this.logger.error(t.message),t}}}const mI=Vc,sp="wc",np=2,op="client",Gc=`${sp}@${np}:${op}:`,bc={name:op,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},Kl="WALLETCONNECT_DEEPLINK_CHOICE",wI="proposal",ap="Proposal expired",bI="session",bo=re.SEVEN_DAYS,_I="engine",Gs={wc_sessionPropose:{req:{ttl:re.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:re.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:re.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:re.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:re.ONE_DAY,prompt:!1,tag:1104},res:{ttl:re.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:re.ONE_DAY,prompt:!1,tag:1106},res:{ttl:re.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:re.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:re.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:re.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:re.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:re.ONE_DAY,prompt:!1,tag:1112},res:{ttl:re.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:re.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:re.THIRTY_SECONDS,prompt:!1,tag:1115}}},_c={min:re.FIVE_MINUTES,max:re.SEVEN_DAYS},ci={idle:"IDLE",active:"ACTIVE"},EI="request",II=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var xI=Object.defineProperty,PI=Object.defineProperties,SI=Object.getOwnPropertyDescriptors,Bl=Object.getOwnPropertySymbols,RI=Object.prototype.hasOwnProperty,OI=Object.prototype.propertyIsEnumerable,Fl=(a,t,r)=>t in a?xI(a,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[t]=r,or=(a,t)=>{for(var r in t||(t={}))RI.call(t,r)&&Fl(a,r,t[r]);if(Bl)for(var r of Bl(t))OI.call(t,r)&&Fl(a,r,t[r]);return a},Ws=(a,t)=>PI(a,SI(t));class AI extends t_{constructor(t){super(t),this.name=_I,this.events=new zc,this.initialized=!1,this.ignoredPayloadTypes=[pf],this.requestQueue={state:ci.idle,queue:[]},this.sessionRequestQueue={state:ci.idle,queue:[]},this.requestQueueDelay=re.ONE_SECOND,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),this.client.core.pairing.register({methods:Object.keys(Gs)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},re.toMiliseconds(this.requestQueueDelay)))},this.connect=async r=>{await this.isInitialized();const s=Ws(or({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(s);const{pairingTopic:o,requiredNamespaces:h,optionalNamespaces:f,sessionProperties:y,relays:m}=s;let g=o,_,O=!1;if(g&&(O=this.client.core.pairing.pairings.get(g).active),!g||!O){const{topic:oe,uri:te}=await this.client.core.pairing.create();g=oe,_=te}const $=await this.client.core.crypto.generateKeyPair(),j=or({requiredNamespaces:h,optionalNamespaces:f,relays:m??[{protocol:rp}],proposer:{publicKey:$,metadata:this.client.metadata}},y&&{sessionProperties:y}),{reject:A,resolve:Q,done:ee}=vs(re.FIVE_MINUTES,ap);if(this.events.once(Ct("session_connect"),async({error:oe,session:te})=>{if(oe)A(oe);else if(te){te.self.publicKey=$;const he=Ws(or({},te),{requiredNamespaces:te.requiredNamespaces,optionalNamespaces:te.optionalNamespaces});await this.client.session.set(te.topic,he),await this.setExpiry(te.topic,te.expiry),g&&await this.client.core.pairing.updateMetadata({topic:g,metadata:te.peer.metadata}),Q(he)}}),!g){const{message:oe}=G("NO_MATCHING_KEY",`connect() pairing topic: ${g}`);throw new Error(oe)}const ce=await this.sendRequest({topic:g,method:"wc_sessionPropose",params:j}),ae=qr(re.FIVE_MINUTES);return await this.setProposal(ce,or({id:ce,expiry:ae},j)),{uri:_,approval:ee}},this.pair=async r=>(await this.isInitialized(),await this.client.core.pairing.pair(r)),this.approve=async r=>{await this.isInitialized(),await this.isValidApprove(r);const{id:s,relayProtocol:o,namespaces:h,sessionProperties:f}=r,y=this.client.proposal.get(s);let{pairingTopic:m,proposer:g,requiredNamespaces:_,optionalNamespaces:O}=y;m=m||"",xo(_)||(_=fw(h,"approve()"));const $=await this.client.core.crypto.generateKeyPair(),j=g.publicKey,A=await this.client.core.crypto.generateSharedKey($,j);m&&s&&(await this.client.core.pairing.updateMetadata({topic:m,metadata:g.metadata}),await this.sendResult({id:s,topic:m,result:{relay:{protocol:o??"irn"},responderPublicKey:$}}),await this.client.proposal.delete(s,Vt("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:m}));const Q=or({relay:{protocol:o??"irn"},namespaces:h,requiredNamespaces:_,optionalNamespaces:O,pairingTopic:m,controller:{publicKey:$,metadata:this.client.metadata},expiry:qr(bo)},f&&{sessionProperties:f});await this.client.core.relayer.subscribe(A),await this.sendRequest({topic:A,method:"wc_sessionSettle",params:Q,throwOnFailedPublish:!0});const ee=Ws(or({},Q),{topic:A,pairingTopic:m,acknowledged:!1,self:Q.controller,peer:{publicKey:g.publicKey,metadata:g.metadata},controller:$});return await this.client.session.set(A,ee),await this.setExpiry(A,qr(bo)),{topic:A,acknowledged:()=>new Promise(ce=>setTimeout(()=>ce(this.client.session.get(A)),500))}},this.reject=async r=>{await this.isInitialized(),await this.isValidReject(r);const{id:s,reason:o}=r,{pairingTopic:h}=this.client.proposal.get(s);h&&(await this.sendError(s,h,o),await this.client.proposal.delete(s,Vt("USER_DISCONNECTED")))},this.update=async r=>{await this.isInitialized(),await this.isValidUpdate(r);const{topic:s,namespaces:o}=r,h=await this.sendRequest({topic:s,method:"wc_sessionUpdate",params:{namespaces:o}}),{done:f,resolve:y,reject:m}=vs();return this.events.once(Ct("session_update",h),({error:g})=>{g?m(g):y()}),await this.client.session.update(s,{namespaces:o}),{acknowledged:f}},this.extend=async r=>{await this.isInitialized(),await this.isValidExtend(r);const{topic:s}=r,o=await this.sendRequest({topic:s,method:"wc_sessionExtend",params:{}}),{done:h,resolve:f,reject:y}=vs();return this.events.once(Ct("session_extend",o),({error:m})=>{m?y(m):f()}),await this.setExpiry(s,qr(bo)),{acknowledged:h}},this.request=async r=>{await this.isInitialized(),await this.isValidRequest(r);const{chainId:s,request:o,topic:h,expiry:f}=r,y=kc(),{done:m,resolve:g,reject:_}=vs(f,"Request expired. Please try again.");return this.events.once(Ct("session_request",y),({error:O,result:$})=>{O?_(O):g($)}),await Promise.all([new Promise(async O=>{await this.sendRequest({clientRpcId:y,topic:h,method:"wc_sessionRequest",params:{request:o,chainId:s},expiry:f,throwOnFailedPublish:!0}).catch($=>_($)),this.client.events.emit("session_request_sent",{topic:h,request:o,chainId:s,id:y}),O()}),new Promise(async O=>{const $=await pw(this.client.core.storage,Kl);dw({id:y,topic:h,wcDeepLink:$}),O()}),m()]).then(O=>O[2])},this.respond=async r=>{await this.isInitialized(),await this.isValidRespond(r);const{topic:s,response:o}=r,{id:h}=o;ui(o)?await this.sendResult({id:h,topic:s,result:o.result,throwOnFailedPublish:!0}):Or(o)&&await this.sendError(h,s,o.error),this.cleanupAfterResponse(r)},this.ping=async r=>{await this.isInitialized(),await this.isValidPing(r);const{topic:s}=r;if(this.client.session.keys.includes(s)){const o=await this.sendRequest({topic:s,method:"wc_sessionPing",params:{}}),{done:h,resolve:f,reject:y}=vs();this.events.once(Ct("session_ping",o),({error:m})=>{m?y(m):f()}),await h()}else this.client.core.pairing.pairings.keys.includes(s)&&await this.client.core.pairing.ping({topic:s})},this.emit=async r=>{await this.isInitialized(),await this.isValidEmit(r);const{topic:s,event:o,chainId:h}=r;await this.sendRequest({topic:s,method:"wc_sessionEvent",params:{event:o,chainId:h}})},this.disconnect=async r=>{await this.isInitialized(),await this.isValidDisconnect(r);const{topic:s}=r;this.client.session.keys.includes(s)?(await this.sendRequest({topic:s,method:"wc_sessionDelete",params:Vt("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession(s)):await this.client.core.pairing.disconnect({topic:s})},this.find=r=>(this.isInitialized(),this.client.session.getAll().filter(s=>gw(s,r))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.cleanupDuplicatePairings=async r=>{if(r.pairingTopic)try{const s=this.client.core.pairing.pairings.get(r.pairingTopic),o=this.client.core.pairing.pairings.getAll().filter(h=>{var f,y;return((f=h.peerMetadata)==null?void 0:f.url)&&((y=h.peerMetadata)==null?void 0:y.url)===r.peer.metadata.url&&h.topic&&h.topic!==s.topic});if(o.length===0)return;this.client.logger.info(`Cleaning up ${o.length} duplicate pairing(s)`),await Promise.all(o.map(h=>this.client.core.pairing.disconnect({topic:h.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(s){this.client.logger.error(s)}},this.deleteSession=async(r,s)=>{const{self:o}=this.client.session.get(r);await this.client.core.relayer.unsubscribe(r),this.client.session.delete(r,Vt("USER_DISCONNECTED")),this.client.core.crypto.keychain.has(o.publicKey)&&await this.client.core.crypto.deleteKeyPair(o.publicKey),this.client.core.crypto.keychain.has(r)&&await this.client.core.crypto.deleteSymKey(r),s||this.client.core.expirer.del(r),this.client.core.storage.removeItem(Kl).catch(h=>this.client.logger.warn(h)),this.getPendingSessionRequests().forEach(h=>{h.topic===r&&this.deletePendingSessionRequest(h.id,Vt("USER_DISCONNECTED"))})},this.deleteProposal=async(r,s)=>{await Promise.all([this.client.proposal.delete(r,Vt("USER_DISCONNECTED")),s?Promise.resolve():this.client.core.expirer.del(r)])},this.deletePendingSessionRequest=async(r,s,o=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,s),o?Promise.resolve():this.client.core.expirer.del(r)]),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(h=>h.id!==r),o&&(this.sessionRequestQueue.state=ci.idle)},this.setExpiry=async(r,s)=>{this.client.session.keys.includes(r)&&await this.client.session.update(r,{expiry:s}),this.client.core.expirer.set(r,s)},this.setProposal=async(r,s)=>{await this.client.proposal.set(r,s),this.client.core.expirer.set(r,s.expiry)},this.setPendingSessionRequest=async r=>{const s=Gs.wc_sessionRequest.req.ttl,{id:o,topic:h,params:f,verifyContext:y}=r;await this.client.pendingRequest.set(o,{id:o,topic:h,params:f,verifyContext:y}),s&&this.client.core.expirer.set(o,qr(s))},this.sendRequest=async r=>{const{topic:s,method:o,params:h,expiry:f,relayRpcId:y,clientRpcId:m,throwOnFailedPublish:g}=r,_=Bi(o,h,m);if(gf()&&II.includes(o)){const j=bs(JSON.stringify(_));this.client.core.verify.register({attestationId:j})}const O=await this.client.core.crypto.encode(s,_),$=Gs[o].req;return f&&($.ttl=f),y&&($.id=y),this.client.core.history.set(s,_),g?($.internal=Ws(or({},$.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(s,O,$)):this.client.core.relayer.publish(s,O,$).catch(j=>this.client.logger.error(j)),_.id},this.sendResult=async r=>{const{id:s,topic:o,result:h,throwOnFailedPublish:f}=r,y=jo(s,h),m=await this.client.core.crypto.encode(o,y),g=await this.client.core.history.get(o,s),_=Gs[g.request.method].res;f?(_.internal=Ws(or({},_.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(o,m,_)):this.client.core.relayer.publish(o,m,_).catch(O=>this.client.logger.error(O)),await this.client.core.history.resolve(y)},this.sendError=async(r,s,o)=>{const h=qo(r,o),f=await this.client.core.crypto.encode(s,h),y=await this.client.core.history.get(s,r),m=Gs[y.request.method].res;this.client.core.relayer.publish(s,f,m),await this.client.core.history.resolve(h)},this.cleanup=async()=>{const r=[],s=[];this.client.session.getAll().forEach(o=>{Ei(o.expiry)&&r.push(o.topic)}),this.client.proposal.getAll().forEach(o=>{Ei(o.expiry)&&s.push(o.id)}),await Promise.all([...r.map(o=>this.deleteSession(o)),...s.map(o=>this.deleteProposal(o))])},this.onRelayEventRequest=async r=>{this.requestQueue.queue.push(r),await this.processRequestsQueue()},this.processRequestsQueue=async()=>{if(this.requestQueue.state===ci.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=ci.active;const r=this.requestQueue.queue.shift();if(r)try{this.processRequest(r),await new Promise(s=>setTimeout(s,300))}catch(s){this.client.logger.warn(s)}}this.requestQueue.state=ci.idle},this.processRequest=r=>{const{topic:s,payload:o}=r,h=o.method;switch(h){case"wc_sessionPropose":return this.onSessionProposeRequest(s,o);case"wc_sessionSettle":return this.onSessionSettleRequest(s,o);case"wc_sessionUpdate":return this.onSessionUpdateRequest(s,o);case"wc_sessionExtend":return this.onSessionExtendRequest(s,o);case"wc_sessionPing":return this.onSessionPingRequest(s,o);case"wc_sessionDelete":return this.onSessionDeleteRequest(s,o);case"wc_sessionRequest":return this.onSessionRequest(s,o);case"wc_sessionEvent":return this.onSessionEventRequest(s,o);default:return this.client.logger.info(`Unsupported request method ${h}`)}},this.onRelayEventResponse=async r=>{const{topic:s,payload:o}=r,h=(await this.client.core.history.get(s,o.id)).request.method;switch(h){case"wc_sessionPropose":return this.onSessionProposeResponse(s,o);case"wc_sessionSettle":return this.onSessionSettleResponse(s,o);case"wc_sessionUpdate":return this.onSessionUpdateResponse(s,o);case"wc_sessionExtend":return this.onSessionExtendResponse(s,o);case"wc_sessionPing":return this.onSessionPingResponse(s,o);case"wc_sessionRequest":return this.onSessionRequestResponse(s,o);default:return this.client.logger.info(`Unsupported response method ${h}`)}},this.onRelayEventUnknownPayload=r=>{const{topic:s}=r,{message:o}=G("MISSING_OR_INVALID",`Decoded payload on topic ${s} is not identifiable as a JSON-RPC request or a response.`);throw new Error(o)},this.onSessionProposeRequest=async(r,s)=>{const{params:o,id:h}=s;try{this.isValidConnect(or({},s.params));const f=qr(re.FIVE_MINUTES),y=or({id:h,pairingTopic:r,expiry:f},o);await this.setProposal(h,y);const m=bs(JSON.stringify(s)),g=await this.getVerifyContext(m,y.proposer.metadata);this.client.events.emit("session_proposal",{id:h,params:y,verifyContext:g})}catch(f){await this.sendError(h,r,f),this.client.logger.error(f)}},this.onSessionProposeResponse=async(r,s)=>{const{id:o}=s;if(ui(s)){const{result:h}=s;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:h});const f=this.client.proposal.get(o);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:f});const y=f.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:y});const m=h.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:m});const g=await this.client.core.crypto.generateSharedKey(y,m);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:g});const _=await this.client.core.relayer.subscribe(g);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:_}),await this.client.core.pairing.activate({topic:r})}else Or(s)&&(await this.client.proposal.delete(o,Vt("USER_DISCONNECTED")),this.events.emit(Ct("session_connect"),{error:s.error}))},this.onSessionSettleRequest=async(r,s)=>{const{id:o,params:h}=s;try{this.isValidSessionSettleRequest(h);const{relay:f,controller:y,expiry:m,namespaces:g,requiredNamespaces:_,optionalNamespaces:O,sessionProperties:$,pairingTopic:j}=s.params,A=or({topic:r,relay:f,expiry:m,namespaces:g,acknowledged:!0,pairingTopic:j,requiredNamespaces:_,optionalNamespaces:O,controller:y.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:y.publicKey,metadata:y.metadata}},$&&{sessionProperties:$});await this.sendResult({id:s.id,topic:r,result:!0}),this.events.emit(Ct("session_connect"),{session:A}),this.cleanupDuplicatePairings(A)}catch(f){await this.sendError(o,r,f),this.client.logger.error(f)}},this.onSessionSettleResponse=async(r,s)=>{const{id:o}=s;ui(s)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(Ct("session_approve",o),{})):Or(s)&&(await this.client.session.delete(r,Vt("USER_DISCONNECTED")),this.events.emit(Ct("session_approve",o),{error:s.error}))},this.onSessionUpdateRequest=async(r,s)=>{const{params:o,id:h}=s;try{const f=`${r}_session_update`,y=yo.get(f);if(y&&this.isRequestOutOfSync(y,h)){this.client.logger.info(`Discarding out of sync request - ${h}`);return}this.isValidUpdate(or({topic:r},o)),await this.client.session.update(r,{namespaces:o.namespaces}),await this.sendResult({id:h,topic:r,result:!0}),this.client.events.emit("session_update",{id:h,topic:r,params:o}),yo.set(f,h)}catch(f){await this.sendError(h,r,f),this.client.logger.error(f)}},this.isRequestOutOfSync=(r,s)=>parseInt(s.toString().slice(0,-3))<=parseInt(r.toString().slice(0,-3)),this.onSessionUpdateResponse=(r,s)=>{const{id:o}=s;ui(s)?this.events.emit(Ct("session_update",o),{}):Or(s)&&this.events.emit(Ct("session_update",o),{error:s.error})},this.onSessionExtendRequest=async(r,s)=>{const{id:o}=s;try{this.isValidExtend({topic:r}),await this.setExpiry(r,qr(bo)),await this.sendResult({id:o,topic:r,result:!0}),this.client.events.emit("session_extend",{id:o,topic:r})}catch(h){await this.sendError(o,r,h),this.client.logger.error(h)}},this.onSessionExtendResponse=(r,s)=>{const{id:o}=s;ui(s)?this.events.emit(Ct("session_extend",o),{}):Or(s)&&this.events.emit(Ct("session_extend",o),{error:s.error})},this.onSessionPingRequest=async(r,s)=>{const{id:o}=s;try{this.isValidPing({topic:r}),await this.sendResult({id:o,topic:r,result:!0}),this.client.events.emit("session_ping",{id:o,topic:r})}catch(h){await this.sendError(o,r,h),this.client.logger.error(h)}},this.onSessionPingResponse=(r,s)=>{const{id:o}=s;setTimeout(()=>{ui(s)?this.events.emit(Ct("session_ping",o),{}):Or(s)&&this.events.emit(Ct("session_ping",o),{error:s.error})},500)},this.onSessionDeleteRequest=async(r,s)=>{const{id:o}=s;try{this.isValidDisconnect({topic:r,reason:s.params}),await Promise.all([new Promise(h=>{this.client.core.relayer.once(Gt.publish,async()=>{h(await this.deleteSession(r))})}),this.sendResult({id:o,topic:r,result:!0})]),this.client.events.emit("session_delete",{id:o,topic:r})}catch(h){this.client.logger.error(h)}},this.onSessionRequest=async(r,s)=>{const{id:o,params:h}=s;try{this.isValidRequest(or({topic:r},h));const f=bs(JSON.stringify(Bi("wc_sessionRequest",h,o))),y=this.client.session.get(r),m=await this.getVerifyContext(f,y.peer.metadata),g={id:o,topic:r,params:h,verifyContext:m};await this.setPendingSessionRequest(g),this.addSessionRequestToSessionRequestQueue(g),this.processSessionRequestQueue()}catch(f){await this.sendError(o,r,f),this.client.logger.error(f)}},this.onSessionRequestResponse=(r,s)=>{const{id:o}=s;ui(s)?this.events.emit(Ct("session_request",o),{result:s.result}):Or(s)&&this.events.emit(Ct("session_request",o),{error:s.error})},this.onSessionEventRequest=async(r,s)=>{const{id:o,params:h}=s;try{const f=`${r}_session_event_${h.event.name}`,y=yo.get(f);if(y&&this.isRequestOutOfSync(y,o)){this.client.logger.info(`Discarding out of sync request - ${o}`);return}this.isValidEmit(or({topic:r},h)),this.client.events.emit("session_event",{id:o,topic:r,params:h}),yo.set(f,o)}catch(f){await this.sendError(o,r,f),this.client.logger.error(f)}},this.addSessionRequestToSessionRequestQueue=r=>{this.sessionRequestQueue.queue.push(r)},this.cleanupAfterResponse=r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=ci.idle,this.processSessionRequestQueue()},re.toMiliseconds(this.requestQueueDelay))},this.processSessionRequestQueue=()=>{if(this.sessionRequestQueue.state===ci.active){this.client.logger.info("session request queue is already active.");return}const r=this.sessionRequestQueue.queue[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=ci.active,this.client.events.emit("session_request",r)}catch(s){this.client.logger.error(s)}},this.onPairingCreated=r=>{if(r.active)return;const s=this.client.proposal.getAll().find(o=>o.pairingTopic===r.topic);s&&this.onSessionProposeRequest(r.topic,Bi("wc_sessionPropose",{requiredNamespaces:s.requiredNamespaces,optionalNamespaces:s.optionalNamespaces,relays:s.relays,proposer:s.proposer,sessionProperties:s.sessionProperties},s.id))},this.isValidConnect=async r=>{if(!cr(r)){const{message:m}=G("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(m)}const{pairingTopic:s,requiredNamespaces:o,optionalNamespaces:h,sessionProperties:f,relays:y}=r;if(Ii(s)||await this.isValidPairingTopic(s),!yw(y)){const{message:m}=G("MISSING_OR_INVALID",`connect() relays: ${y}`);throw new Error(m)}!Ii(o)&&xo(o)!==0&&this.validateNamespaces(o,"requiredNamespaces"),!Ii(h)&&xo(h)!==0&&this.validateNamespaces(h,"optionalNamespaces"),Ii(f)||this.validateSessionProps(f,"sessionProperties")},this.validateNamespaces=(r,s)=>{const o=vw(r,"connect()",s);if(o)throw new Error(o.message)},this.isValidApprove=async r=>{if(!cr(r))throw new Error(G("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:s,namespaces:o,relayProtocol:h,sessionProperties:f}=r;await this.isValidProposalId(s);const y=this.client.proposal.get(s),m=hc(o,"approve()");if(m)throw new Error(m.message);const g=Xh(y.requiredNamespaces,o,"approve()");if(g)throw new Error(g.message);if(!ms(h,!0)){const{message:_}=G("MISSING_OR_INVALID",`approve() relayProtocol: ${h}`);throw new Error(_)}Ii(f)||this.validateSessionProps(f,"sessionProperties")},this.isValidReject=async r=>{if(!cr(r)){const{message:h}=G("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(h)}const{id:s,reason:o}=r;if(await this.isValidProposalId(s),!mw(o)){const{message:h}=G("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(o)}`);throw new Error(h)}},this.isValidSessionSettleRequest=r=>{if(!cr(r)){const{message:g}=G("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(g)}const{relay:s,controller:o,namespaces:h,expiry:f}=r;if(!ww(s)){const{message:g}=G("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(g)}const y=bw(o,"onSessionSettleRequest()");if(y)throw new Error(y.message);const m=hc(h,"onSessionSettleRequest()");if(m)throw new Error(m.message);if(Ei(f)){const{message:g}=G("EXPIRED","onSessionSettleRequest()");throw new Error(g)}},this.isValidUpdate=async r=>{if(!cr(r)){const{message:m}=G("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(m)}const{topic:s,namespaces:o}=r;await this.isValidSessionTopic(s);const h=this.client.session.get(s),f=hc(o,"update()");if(f)throw new Error(f.message);const y=Xh(h.requiredNamespaces,o,"update()");if(y)throw new Error(y.message)},this.isValidExtend=async r=>{if(!cr(r)){const{message:o}=G("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(o)}const{topic:s}=r;await this.isValidSessionTopic(s)},this.isValidRequest=async r=>{if(!cr(r)){const{message:m}=G("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(m)}const{topic:s,request:o,chainId:h,expiry:f}=r;await this.isValidSessionTopic(s);const{namespaces:y}=this.client.session.get(s);if(!el(y,h)){const{message:m}=G("MISSING_OR_INVALID",`request() chainId: ${h}`);throw new Error(m)}if(!_w(o)){const{message:m}=G("MISSING_OR_INVALID",`request() ${JSON.stringify(o)}`);throw new Error(m)}if(!Ew(y,h,o.method)){const{message:m}=G("MISSING_OR_INVALID",`request() method: ${o.method}`);throw new Error(m)}if(f&&!Iw(f,_c)){const{message:m}=G("MISSING_OR_INVALID",`request() expiry: ${f}. Expiry must be a number (in seconds) between ${_c.min} and ${_c.max}`);throw new Error(m)}},this.isValidRespond=async r=>{var s;if(!cr(r)){const{message:f}=G("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(f)}const{topic:o,response:h}=r;try{await this.isValidSessionTopic(o)}catch(f){throw(s=r==null?void 0:r.response)!=null&&s.id&&this.cleanupAfterResponse(r),f}if(!xw(h)){const{message:f}=G("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(h)}`);throw new Error(f)}},this.isValidPing=async r=>{if(!cr(r)){const{message:o}=G("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(o)}const{topic:s}=r;await this.isValidSessionOrPairingTopic(s)},this.isValidEmit=async r=>{if(!cr(r)){const{message:y}=G("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(y)}const{topic:s,event:o,chainId:h}=r;await this.isValidSessionTopic(s);const{namespaces:f}=this.client.session.get(s);if(!el(f,h)){const{message:y}=G("MISSING_OR_INVALID",`emit() chainId: ${h}`);throw new Error(y)}if(!Pw(o)){const{message:y}=G("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(o)}`);throw new Error(y)}if(!Sw(f,h,o.name)){const{message:y}=G("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(o)}`);throw new Error(y)}},this.isValidDisconnect=async r=>{if(!cr(r)){const{message:o}=G("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(o)}const{topic:s}=r;await this.isValidSessionOrPairingTopic(s)},this.getVerifyContext=async(r,s)=>{const o={verified:{verifyUrl:s.verifyUrl||ws,validation:"UNKNOWN",origin:s.url||""}};try{const h=await this.client.core.verify.resolve({attestationId:r,verifyUrl:s.verifyUrl});h&&(o.verified.origin=h.origin,o.verified.isScam=h.isScam,o.verified.validation=h.origin===new URL(s.url).origin?"VALID":"INVALID")}catch(h){this.client.logger.info(h)}return this.client.logger.info(`Verify context: ${JSON.stringify(o)}`),o},this.validateSessionProps=(r,s)=>{Object.values(r).forEach(o=>{if(!ms(o,!1)){const{message:h}=G("MISSING_OR_INVALID",`${s} must be in Record<string, string> format. Received: ${JSON.stringify(o)}`);throw new Error(h)}})}}async isInitialized(){if(!this.initialized){const{message:t}=G("NOT_INITIALIZED",this.name);throw new Error(t)}await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(Gt.message,async t=>{const{topic:r,message:s}=t;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(s)))return;const o=await this.client.core.crypto.decode(r,s);try{Bc(o)?(this.client.core.history.set(r,o),this.onRelayEventRequest({topic:r,payload:o})):un(o)?(await this.client.core.history.resolve(o),await this.onRelayEventResponse({topic:r,payload:o}),this.client.core.history.delete(r,o.id)):this.onRelayEventUnknownPayload({topic:r,payload:o})}catch(h){this.client.logger.error(h)}})}registerExpirerEvents(){this.client.core.expirer.on(Rr.expired,async t=>{const{topic:r,id:s}=df(t.target);if(s&&this.client.pendingRequest.keys.includes(s))return await this.deletePendingSessionRequest(s,G("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession(r,!0),this.client.events.emit("session_expire",{topic:r})):s&&(await this.deleteProposal(s,!0),this.client.events.emit("proposal_expire",{id:s}))})}registerPairingEvents(){this.client.core.pairing.events.on(Ys.create,t=>this.onPairingCreated(t))}isValidPairingTopic(t){if(!ms(t,!1)){const{message:r}=G("MISSING_OR_INVALID",`pairing topic should be a string: ${t}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(t)){const{message:r}=G("NO_MATCHING_KEY",`pairing topic doesn't exist: ${t}`);throw new Error(r)}if(Ei(this.client.core.pairing.pairings.get(t).expiry)){const{message:r}=G("EXPIRED",`pairing topic: ${t}`);throw new Error(r)}}async isValidSessionTopic(t){if(!ms(t,!1)){const{message:r}=G("MISSING_OR_INVALID",`session topic should be a string: ${t}`);throw new Error(r)}if(!this.client.session.keys.includes(t)){const{message:r}=G("NO_MATCHING_KEY",`session topic doesn't exist: ${t}`);throw new Error(r)}if(Ei(this.client.session.get(t).expiry)){await this.deleteSession(t);const{message:r}=G("EXPIRED",`session topic: ${t}`);throw new Error(r)}}async isValidSessionOrPairingTopic(t){if(this.client.session.keys.includes(t))await this.isValidSessionTopic(t);else if(this.client.core.pairing.pairings.keys.includes(t))this.isValidPairingTopic(t);else if(ms(t,!1)){const{message:r}=G("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${t}`);throw new Error(r)}else{const{message:r}=G("MISSING_OR_INVALID",`session or pairing topic should be a string: ${t}`);throw new Error(r)}}async isValidProposalId(t){if(!Rw(t)){const{message:r}=G("MISSING_OR_INVALID",`proposal id should be a number: ${t}`);throw new Error(r)}if(!this.client.proposal.keys.includes(t)){const{message:r}=G("NO_MATCHING_KEY",`proposal id doesn't exist: ${t}`);throw new Error(r)}if(Ei(this.client.proposal.get(t).expiry)){await this.deleteProposal(t);const{message:r}=G("EXPIRED",`proposal id: ${t}`);throw new Error(r)}}}class CI extends zo{constructor(t,r){super(t,r,wI,Gc),this.core=t,this.logger=r}}class TI extends zo{constructor(t,r){super(t,r,bI,Gc),this.core=t,this.logger=r}}class NI extends zo{constructor(t,r){super(t,r,EI,Gc,s=>s.id),this.core=t,this.logger=r}}let $I=class cp extends e_{constructor(t){super(t),this.protocol=sp,this.version=np,this.name=bc.name,this.events=new ur.EventEmitter,this.on=(s,o)=>this.events.on(s,o),this.once=(s,o)=>this.events.once(s,o),this.off=(s,o)=>this.events.off(s,o),this.removeListener=(s,o)=>this.events.removeListener(s,o),this.removeAllListeners=s=>this.events.removeAllListeners(s),this.connect=async s=>{try{return await this.engine.connect(s)}catch(o){throw this.logger.error(o.message),o}},this.pair=async s=>{try{return await this.engine.pair(s)}catch(o){throw this.logger.error(o.message),o}},this.approve=async s=>{try{return await this.engine.approve(s)}catch(o){throw this.logger.error(o.message),o}},this.reject=async s=>{try{return await this.engine.reject(s)}catch(o){throw this.logger.error(o.message),o}},this.update=async s=>{try{return await this.engine.update(s)}catch(o){throw this.logger.error(o.message),o}},this.extend=async s=>{try{return await this.engine.extend(s)}catch(o){throw this.logger.error(o.message),o}},this.request=async s=>{try{return await this.engine.request(s)}catch(o){throw this.logger.error(o.message),o}},this.respond=async s=>{try{return await this.engine.respond(s)}catch(o){throw this.logger.error(o.message),o}},this.ping=async s=>{try{return await this.engine.ping(s)}catch(o){throw this.logger.error(o.message),o}},this.emit=async s=>{try{return await this.engine.emit(s)}catch(o){throw this.logger.error(o.message),o}},this.disconnect=async s=>{try{return await this.engine.disconnect(s)}catch(o){throw this.logger.error(o.message),o}},this.find=s=>{try{return this.engine.find(s)}catch(o){throw this.logger.error(o.message),o}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(s){throw this.logger.error(s.message),s}},this.name=(t==null?void 0:t.name)||bc.name,this.metadata=(t==null?void 0:t.metadata)||lw();const r=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:Do(Lo({level:(t==null?void 0:t.logger)||bc.logger}));this.core=(t==null?void 0:t.core)||new mI(t),this.logger=lr(r,this.name),this.session=new TI(this.core,this.logger),this.proposal=new CI(this.core,this.logger),this.pendingRequest=new NI(this.core,this.logger),this.engine=new AI(this)}static async init(t){const r=new cp(t);return await r.initialize(),r}get context(){return hr(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(t){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(t.message),t}}};var $c={exports:{}};(function(a,t){var r=typeof self<"u"?self:Mr,s=function(){function h(){this.fetch=!1,this.DOMException=r.DOMException}return h.prototype=r,new h}();(function(h){(function(f){var y={searchParams:"URLSearchParams"in h,iterable:"Symbol"in h&&"iterator"in Symbol,blob:"FileReader"in h&&"Blob"in h&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in h,arrayBuffer:"ArrayBuffer"in h};function m(b){return b&&DataView.prototype.isPrototypeOf(b)}if(y.arrayBuffer)var g=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],_=ArrayBuffer.isView||function(b){return b&&g.indexOf(Object.prototype.toString.call(b))>-1};function O(b){if(typeof b!="string"&&(b=String(b)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(b))throw new TypeError("Invalid character in header field name");return b.toLowerCase()}function $(b){return typeof b!="string"&&(b=String(b)),b}function j(b){var S={next:function(){var J=b.shift();return{done:J===void 0,value:J}}};return y.iterable&&(S[Symbol.iterator]=function(){return S}),S}function A(b){this.map={},b instanceof A?b.forEach(function(S,J){this.append(J,S)},this):Array.isArray(b)?b.forEach(function(S){this.append(S[0],S[1])},this):b&&Object.getOwnPropertyNames(b).forEach(function(S){this.append(S,b[S])},this)}A.prototype.append=function(b,S){b=O(b),S=$(S);var J=this.map[b];this.map[b]=J?J+", "+S:S},A.prototype.delete=function(b){delete this.map[O(b)]},A.prototype.get=function(b){return b=O(b),this.has(b)?this.map[b]:null},A.prototype.has=function(b){return this.map.hasOwnProperty(O(b))},A.prototype.set=function(b,S){this.map[O(b)]=$(S)},A.prototype.forEach=function(b,S){for(var J in this.map)this.map.hasOwnProperty(J)&&b.call(S,this.map[J],J,this)},A.prototype.keys=function(){var b=[];return this.forEach(function(S,J){b.push(J)}),j(b)},A.prototype.values=function(){var b=[];return this.forEach(function(S){b.push(S)}),j(b)},A.prototype.entries=function(){var b=[];return this.forEach(function(S,J){b.push([J,S])}),j(b)},y.iterable&&(A.prototype[Symbol.iterator]=A.prototype.entries);function Q(b){if(b.bodyUsed)return Promise.reject(new TypeError("Already read"));b.bodyUsed=!0}function ee(b){return new Promise(function(S,J){b.onload=function(){S(b.result)},b.onerror=function(){J(b.error)}})}function ce(b){var S=new FileReader,J=ee(S);return S.readAsArrayBuffer(b),J}function ae(b){var S=new FileReader,J=ee(S);return S.readAsText(b),J}function oe(b){for(var S=new Uint8Array(b),J=new Array(S.length),le=0;le<S.length;le++)J[le]=String.fromCharCode(S[le]);return J.join("")}function te(b){if(b.slice)return b.slice(0);var S=new Uint8Array(b.byteLength);return S.set(new Uint8Array(b)),S.buffer}function he(){return this.bodyUsed=!1,this._initBody=function(b){this._bodyInit=b,b?typeof b=="string"?this._bodyText=b:y.blob&&Blob.prototype.isPrototypeOf(b)?this._bodyBlob=b:y.formData&&FormData.prototype.isPrototypeOf(b)?this._bodyFormData=b:y.searchParams&&URLSearchParams.prototype.isPrototypeOf(b)?this._bodyText=b.toString():y.arrayBuffer&&y.blob&&m(b)?(this._bodyArrayBuffer=te(b.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):y.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(b)||_(b))?this._bodyArrayBuffer=te(b):this._bodyText=b=Object.prototype.toString.call(b):this._bodyText="",this.headers.get("content-type")||(typeof b=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):y.searchParams&&URLSearchParams.prototype.isPrototypeOf(b)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},y.blob&&(this.blob=function(){var b=Q(this);if(b)return b;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?Q(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(ce)}),this.text=function(){var b=Q(this);if(b)return b;if(this._bodyBlob)return ae(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(oe(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},y.formData&&(this.formData=function(){return this.text().then(bt)}),this.json=function(){return this.text().then(JSON.parse)},this}var pe=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function Y(b){var S=b.toUpperCase();return pe.indexOf(S)>-1?S:b}function ve(b,S){S=S||{};var J=S.body;if(b instanceof ve){if(b.bodyUsed)throw new TypeError("Already read");this.url=b.url,this.credentials=b.credentials,S.headers||(this.headers=new A(b.headers)),this.method=b.method,this.mode=b.mode,this.signal=b.signal,!J&&b._bodyInit!=null&&(J=b._bodyInit,b.bodyUsed=!0)}else this.url=String(b);if(this.credentials=S.credentials||this.credentials||"same-origin",(S.headers||!this.headers)&&(this.headers=new A(S.headers)),this.method=Y(S.method||this.method||"GET"),this.mode=S.mode||this.mode||null,this.signal=S.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&J)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(J)}ve.prototype.clone=function(){return new ve(this,{body:this._bodyInit})};function bt(b){var S=new FormData;return b.trim().split("&").forEach(function(J){if(J){var le=J.split("="),k=le.shift().replace(/\+/g," "),H=le.join("=").replace(/\+/g," ");S.append(decodeURIComponent(k),decodeURIComponent(H))}}),S}function nt(b){var S=new A,J=b.replace(/\r?\n[\t ]+/g," ");return J.split(/\r?\n/).forEach(function(le){var k=le.split(":"),H=k.shift().trim();if(H){var K=k.join(":").trim();S.append(H,K)}}),S}he.call(ve.prototype);function Be(b,S){S||(S={}),this.type="default",this.status=S.status===void 0?200:S.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in S?S.statusText:"OK",this.headers=new A(S.headers),this.url=S.url||"",this._initBody(b)}he.call(Be.prototype),Be.prototype.clone=function(){return new Be(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new A(this.headers),url:this.url})},Be.error=function(){var b=new Be(null,{status:0,statusText:""});return b.type="error",b};var Mt=[301,302,303,307,308];Be.redirect=function(b,S){if(Mt.indexOf(S)===-1)throw new RangeError("Invalid status code");return new Be(null,{status:S,headers:{location:b}})},f.DOMException=h.DOMException;try{new f.DOMException}catch{f.DOMException=function(S,J){this.message=S,this.name=J;var le=Error(S);this.stack=le.stack},f.DOMException.prototype=Object.create(Error.prototype),f.DOMException.prototype.constructor=f.DOMException}function zt(b,S){return new Promise(function(J,le){var k=new ve(b,S);if(k.signal&&k.signal.aborted)return le(new f.DOMException("Aborted","AbortError"));var H=new XMLHttpRequest;function K(){H.abort()}H.onload=function(){var B={status:H.status,statusText:H.statusText,headers:nt(H.getAllResponseHeaders()||"")};B.url="responseURL"in H?H.responseURL:B.headers.get("X-Request-URL");var et="response"in H?H.response:H.responseText;J(new Be(et,B))},H.onerror=function(){le(new TypeError("Network request failed"))},H.ontimeout=function(){le(new TypeError("Network request failed"))},H.onabort=function(){le(new f.DOMException("Aborted","AbortError"))},H.open(k.method,k.url,!0),k.credentials==="include"?H.withCredentials=!0:k.credentials==="omit"&&(H.withCredentials=!1),"responseType"in H&&y.blob&&(H.responseType="blob"),k.headers.forEach(function(B,et){H.setRequestHeader(et,B)}),k.signal&&(k.signal.addEventListener("abort",K),H.onreadystatechange=function(){H.readyState===4&&k.signal.removeEventListener("abort",K)}),H.send(typeof k._bodyInit>"u"?null:k._bodyInit)})}return zt.polyfill=!0,h.fetch||(h.fetch=zt,h.Headers=A,h.Request=ve,h.Response=Be),f.Headers=A,f.Request=ve,f.Response=Be,f.fetch=zt,Object.defineProperty(f,"__esModule",{value:!0}),f})({})})(s),s.fetch.ponyfill=!0,delete s.fetch.polyfill;var o=s;t=o.fetch,t.default=o.fetch,t.fetch=o.fetch,t.Headers=o.Headers,t.Request=o.Request,t.Response=o.Response,a.exports=t})($c,$c.exports);var DI=$c.exports;const Vl=sn(DI);var LI=Object.defineProperty,jI=Object.defineProperties,qI=Object.getOwnPropertyDescriptors,Gl=Object.getOwnPropertySymbols,MI=Object.prototype.hasOwnProperty,zI=Object.prototype.propertyIsEnumerable,Wl=(a,t,r)=>t in a?LI(a,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[t]=r,Jl=(a,t)=>{for(var r in t||(t={}))MI.call(t,r)&&Wl(a,r,t[r]);if(Gl)for(var r of Gl(t))zI.call(t,r)&&Wl(a,r,t[r]);return a},Ql=(a,t)=>jI(a,qI(t));const UI={Accept:"application/json","Content-Type":"application/json"},HI="POST",Yl={headers:UI,method:HI},Zl=10;let Si=class{constructor(t,r=!1){if(this.url=t,this.disableProviderPing=r,this.events=new ur.EventEmitter,this.isAvailable=!1,this.registering=!1,!bl(t))throw new Error(`Provided URL is not compatible with HTTP connection: ${t}`);this.url=t,this.disableProviderPing=r}get connected(){return this.isAvailable}get connecting(){return this.registering}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async open(t=this.url){await this.register(t)}async close(){if(!this.isAvailable)throw new Error("Connection already closed");this.onClose()}async send(t){this.isAvailable||await this.register();try{const r=Fi(t),s=await(await Vl(this.url,Ql(Jl({},Yl),{body:r}))).json();this.onPayload({data:s})}catch(r){this.onError(t.id,r)}}async register(t=this.url){if(!bl(t))throw new Error(`Provided URL is not compatible with HTTP connection: ${t}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((s,o)=>{this.events.once("register_error",h=>{this.resetMaxListeners(),o(h)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return o(new Error("HTTP connection is missing or invalid"));s()})})}this.url=t,this.registering=!0;try{if(!this.disableProviderPing){const r=Fi({id:1,jsonrpc:"2.0",method:"test",params:[]});await Vl(t,Ql(Jl({},Yl),{body:r}))}this.onOpen()}catch(r){const s=this.parseError(r);throw this.events.emit("register_error",s),this.onClose(),s}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(t){if(typeof t.data>"u")return;const r=typeof t.data=="string"?an(t.data):t.data;this.events.emit("payload",r)}onError(t,r){const s=this.parseError(r),o=s.message||s.toString(),h=qo(t,o);this.events.emit("payload",h)}parseError(t,r=this.url){return zf(t,r,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>Zl&&this.events.setMaxListeners(Zl)}};class Ri extends Hf{constructor(t){super(t),this.events=new ur.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(t),this.connection.connected&&this.registerEventListeners()}async connect(t=this.connection){await this.open(t)}async disconnect(){await this.close()}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async request(t,r){return this.requestStrict(Bi(t.method,t.params||[],t.id||Kc().toString()),r)}async requestStrict(t,r){return new Promise(async(s,o)=>{if(!this.connection.connected)try{await this.open()}catch(h){o(h)}this.events.on(`${t.id}`,h=>{Or(h)?o(h.error):s(h.result)});try{await this.connection.send(t,r)}catch(h){o(h)}})}setConnection(t=this.connection){return t}onPayload(t){this.events.emit("payload",t),un(t)?this.events.emit(`${t.id}`,t):this.events.emit("message",{type:t.method,data:t.params})}onClose(t){t&&t.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${t.code} ${t.reason?`(${t.reason})`:""}`)),this.events.emit("disconnect")}async open(t=this.connection){this.connection===t&&this.connection.connected||(this.connection.connected&&this.close(),typeof t=="string"&&(await this.connection.open(t),t=this.connection),this.connection=this.setConnection(t),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",t=>this.onPayload(t)),this.connection.on("close",t=>this.onClose(t)),this.connection.on("error",t=>this.events.emit("error",t)),this.connection.on("register_error",t=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const Xl="error",kI="wss://relay.walletconnect.com",KI="wc",BI="universal_provider",ef=`${KI}@2:${BI}:`,FI="https://rpc.walletconnect.com/v1/",hi={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var Js=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Dc={exports:{}};/**
* @license
* Lodash <https://lodash.com/>
* Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
* Released under MIT license <https://lodash.com/license>
* Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
* Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
*/(function(a,t){(function(){var r,s="4.17.21",o=200,h="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",f="Expected a function",y="Invalid `variable` option passed into `_.template`",m="__lodash_hash_undefined__",g=500,_="__lodash_placeholder__",O=1,$=2,j=4,A=1,Q=2,ee=1,ce=2,ae=4,oe=8,te=16,he=32,pe=64,Y=128,ve=256,bt=512,nt=30,Be="...",Mt=800,zt=16,b=1,S=2,J=3,le=1/0,k=9007199254740991,H=17976931348623157e292,K=NaN,B=4294967295,et=B-1,ot=B>>>1,Oi=[["ary",Y],["bind",ee],["bindKey",ce],["curry",oe],["curryRight",te],["flip",bt],["partial",he],["partialRight",pe],["rearg",ve]],Ee="[object Arguments]",Ar="[object Array]",D="[object AsyncFunction]",N="[object Boolean]",C="[object Date]",u="[object DOMException]",I="[object Error]",Z="[object Function]",ue="[object GeneratorFunction]",me="[object Map]",Re="[object Number]",Ae="[object Null]",Ie="[object Object]",_t="[object Promise]",gt="[object Proxy]",tt="[object RegExp]",Te="[object Set]",Fe="[object String]",Ve="[object Symbol]",rt="[object Undefined]",Le="[object WeakMap]",Ge="[object WeakSet]",Oe="[object ArrayBuffer]",Me="[object DataView]",at="[object Float32Array]",$e="[object Float64Array]",Et="[object Int8Array]",Tt="[object Int16Array]",Ut="[object Int32Array]",Ht="[object Uint8Array]",Dt="[object Uint8ClampedArray]",Wt="[object Uint16Array]",er="[object Uint32Array]",zr=/\b__p \+= '';/g,Jt=/\b(__p \+=) '' \+/g,Gr=/(__e\(.*?\)|\b__t\)) \+\n'';/g,li=/&(?:amp|lt|gt|quot|#39);/g,Ai=/[&<>"']/g,ct=RegExp(li.source),Qe=RegExp(Ai.source),ut=/<%-([\s\S]+?)%>/g,ht=/<%([\s\S]+?)%>/g,it=/<%=([\s\S]+?)%>/g,Ye=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,It=/^\w*$/,xt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,lt=/[\\^$.*+?()[\]{}|]/g,Pt=RegExp(lt.source),ft=/^\s+/,yt=/\s/,pt=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Ke=/\{\n\/\* \[wrapped with (.+)\] \*/,St=/,? & /,Rt=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Uo=/[()=,{}\[\]\/\s]/,Ho=/\\(\\)?/g,ko=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,mr=/\w*$/,Ko=/^[-+]0x[0-9a-f]+$/i,Bo=/^0b[01]+$/i,Fo=/^\[object .+?Constructor\]$/,Vo=/^0o[0-7]+$/i,Go=/^(?:0|[1-9]\d*)$/,Wr=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Ji=/($^)/,Wo=/['\n\r\u2028\u2029\\]/g,Qi="\\ud800-\\udfff",Jo="\\u0300-\\u036f",Qo="\\ufe20-\\ufe2f",Yi="\\u20d0-\\u20ff",ln=Jo+Qo+Yi,fn="\\u2700-\\u27bf",Cr="a-z\\xdf-\\xf6\\xf8-\\xff",Yo="\\xac\\xb1\\xd7\\xf7",Zo="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Xo="\\u2000-\\u206f",ea=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",pn="A-Z\\xc0-\\xd6\\xd8-\\xde",dn="\\ufe0e\\ufe0f",Ci=Yo+Zo+Xo+ea,xs="['’]",Ti="["+Qi+"]",Ps="["+Ci+"]",Ni="["+ln+"]",gn="\\d+",ta="["+fn+"]",yn="["+Cr+"]",vn="[^"+Qi+Ci+gn+fn+Cr+pn+"]",Zi="\\ud83c[\\udffb-\\udfff]",ra="(?:"+Ni+"|"+Zi+")",mn="[^"+Qi+"]",Xi="(?:\\ud83c[\\udde6-\\uddff]){2}",fi="[\\ud800-\\udbff][\\udc00-\\udfff]",fr="["+pn+"]",wn="\\u200d",bn="(?:"+yn+"|"+vn+")",Ur="(?:"+fr+"|"+vn+")",_n="(?:"+xs+"(?:d|ll|m|re|s|t|ve))?",En="(?:"+xs+"(?:D|LL|M|RE|S|T|VE))?",In=ra+"?",xn="["+dn+"]?",ia="(?:"+wn+"(?:"+[mn,Xi,fi].join("|")+")"+xn+In+")*",Jr="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Pn="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Sn=xn+In+ia,es="(?:"+[ta,Xi,fi].join("|")+")"+Sn,sa="(?:"+[mn+Ni+"?",Ni,Xi,fi,Ti].join("|")+")",Ss=RegExp(xs,"g"),na=RegExp(Ni,"g"),ts=RegExp(Zi+"(?="+Zi+")|"+sa+Sn,"g"),Rn=RegExp([fr+"?"+yn+"+"+_n+"(?="+[Ps,fr,"$"].join("|")+")",Ur+"+"+En+"(?="+[Ps,fr+bn,"$"].join("|")+")",fr+"?"+bn+"+"+_n,fr+"+"+En,Pn,Jr,gn,es].join("|"),"g"),On=RegExp("["+wn+Qi+ln+dn+"]"),$i=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,An=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],oa=-1,ze={};ze[at]=ze[$e]=ze[Et]=ze[Tt]=ze[Ut]=ze[Ht]=ze[Dt]=ze[Wt]=ze[er]=!0,ze[Ee]=ze[Ar]=ze[Oe]=ze[N]=ze[Me]=ze[C]=ze[I]=ze[Z]=ze[me]=ze[Re]=ze[Ie]=ze[tt]=ze[Te]=ze[Fe]=ze[Le]=!1;var je={};je[Ee]=je[Ar]=je[Oe]=je[Me]=je[N]=je[C]=je[at]=je[$e]=je[Et]=je[Tt]=je[Ut]=je[me]=je[Re]=je[Ie]=je[tt]=je[Te]=je[Fe]=je[Ve]=je[Ht]=je[Dt]=je[Wt]=je[er]=!0,je[I]=je[Z]=je[Le]=!1;var v={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},x={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},z={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},V={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Ue=parseFloat,de=parseInt,We=typeof Js=="object"&&Js&&Js.Object===Object&&Js,Ot=typeof self=="object"&&self&&self.Object===Object&&self,Pe=We||Ot||Function("return this")(),He=t&&!t.nodeType&&t,vt=He&&!0&&a&&!a.nodeType&&a,tr=vt&&vt.exports===He,At=tr&&We.process,Je=function(){try{var P=vt&&vt.require&&vt.require("util").types;return P||At&&At.binding&&At.binding("util")}catch{}}(),Qt=Je&&Je.isArrayBuffer,Tr=Je&&Je.isDate,wr=Je&&Je.isMap,Hr=Je&&Je.isRegExp,Rs=Je&&Je.isSet,Di=Je&&Je.isTypedArray;function Lt(P,L,T){switch(T.length){case 0:return P.call(L);case 1:return P.call(L,T[0]);case 2:return P.call(L,T[0],T[1]);case 3:return P.call(L,T[0],T[1],T[2])}return P.apply(L,T)}function lp(P,L,T,W){for(var fe=-1,Ce=P==null?0:P.length;++fe<Ce;){var Nt=P[fe];L(W,Nt,T(Nt),P)}return W}function br(P,L){for(var T=-1,W=P==null?0:P.length;++T<W&&L(P[T],T,P)!==!1;);return P}function fp(P,L){for(var T=P==null?0:P.length;T--&&L(P[T],T,P)!==!1;);return P}function Qc(P,L){for(var T=-1,W=P==null?0:P.length;++T<W;)if(!L(P[T],T,P))return!1;return!0}function pi(P,L){for(var T=-1,W=P==null?0:P.length,fe=0,Ce=[];++T<W;){var Nt=P[T];L(Nt,T,P)&&(Ce[fe++]=Nt)}return Ce}function Cn(P,L){var T=P==null?0:P.length;return!!T&&rs(P,L,0)>-1}function aa(P,L,T){for(var W=-1,fe=P==null?0:P.length;++W<fe;)if(T(L,P[W]))return!0;return!1}function Ze(P,L){for(var T=-1,W=P==null?0:P.length,fe=Array(W);++T<W;)fe[T]=L(P[T],T,P);return fe}function di(P,L){for(var T=-1,W=L.length,fe=P.length;++T<W;)P[fe+T]=L[T];return P}function ca(P,L,T,W){var fe=-1,Ce=P==null?0:P.length;for(W&&Ce&&(T=P[++fe]);++fe<Ce;)T=L(T,P[fe],fe,P);return T}function pp(P,L,T,W){var fe=P==null?0:P.length;for(W&&fe&&(T=P[--fe]);fe--;)T=L(T,P[fe],fe,P);return T}function ua(P,L){for(var T=-1,W=P==null?0:P.length;++T<W;)if(L(P[T],T,P))return!0;return!1}var dp=ha("length");function gp(P){return P.split("")}function yp(P){return P.match(Rt)||[]}function Yc(P,L,T){var W;return T(P,function(fe,Ce,Nt){if(L(fe,Ce,Nt))return W=Ce,!1}),W}function Tn(P,L,T,W){for(var fe=P.length,Ce=T+(W?1:-1);W?Ce--:++Ce<fe;)if(L(P[Ce],Ce,P))return Ce;return-1}function rs(P,L,T){return L===L?Op(P,L,T):Tn(P,Zc,T)}function vp(P,L,T,W){for(var fe=T-1,Ce=P.length;++fe<Ce;)if(W(P[fe],L))return fe;return-1}function Zc(P){return P!==P}function Xc(P,L){var T=P==null?0:P.length;return T?fa(P,L)/T:K}function ha(P){return function(L){return L==null?r:L[P]}}function la(P){return function(L){return P==null?r:P[L]}}function eu(P,L,T,W,fe){return fe(P,function(Ce,Nt,ke){T=W?(W=!1,Ce):L(T,Ce,Nt,ke)}),T}function mp(P,L){var T=P.length;for(P.sort(L);T--;)P[T]=P[T].value;return P}function fa(P,L){for(var T,W=-1,fe=P.length;++W<fe;){var Ce=L(P[W]);Ce!==r&&(T=T===r?Ce:T+Ce)}return T}function pa(P,L){for(var T=-1,W=Array(P);++T<P;)W[T]=L(T);return W}function wp(P,L){return Ze(L,function(T){return[T,P[T]]})}function tu(P){return P&&P.slice(0,nu(P)+1).replace(ft,"")}function pr(P){return function(L){return P(L)}}function da(P,L){return Ze(L,function(T){return P[T]})}function Os(P,L){return P.has(L)}function ru(P,L){for(var T=-1,W=P.length;++T<W&&rs(L,P[T],0)>-1;);return T}function iu(P,L){for(var T=P.length;T--&&rs(L,P[T],0)>-1;);return T}function bp(P,L){for(var T=P.length,W=0;T--;)P[T]===L&&++W;return W}var _p=la(v),Ep=la(x);function Ip(P){return"\\"+V[P]}function xp(P,L){return P==null?r:P[L]}function is(P){return On.test(P)}function Pp(P){return $i.test(P)}function Sp(P){for(var L,T=[];!(L=P.next()).done;)T.push(L.value);return T}function ga(P){var L=-1,T=Array(P.size);return P.forEach(function(W,fe){T[++L]=[fe,W]}),T}function su(P,L){return function(T){return P(L(T))}}function gi(P,L){for(var T=-1,W=P.length,fe=0,Ce=[];++T<W;){var Nt=P[T];(Nt===L||Nt===_)&&(P[T]=_,Ce[fe++]=T)}return Ce}function Nn(P){var L=-1,T=Array(P.size);return P.forEach(function(W){T[++L]=W}),T}function Rp(P){var L=-1,T=Array(P.size);return P.forEach(function(W){T[++L]=[W,W]}),T}function Op(P,L,T){for(var W=T-1,fe=P.length;++W<fe;)if(P[W]===L)return W;return-1}function Ap(P,L,T){for(var W=T+1;W--;)if(P[W]===L)return W;return W}function ss(P){return is(P)?Tp(P):dp(P)}function Nr(P){return is(P)?Np(P):gp(P)}function nu(P){for(var L=P.length;L--&&yt.test(P.charAt(L)););return L}var Cp=la(z);function Tp(P){for(var L=ts.lastIndex=0;ts.test(P);)++L;return L}function Np(P){return P.match(ts)||[]}function $p(P){return P.match(Rn)||[]}var Dp=function P(L){L=L==null?Pe:ns.defaults(Pe.Object(),L,ns.pick(Pe,An));var T=L.Array,W=L.Date,fe=L.Error,Ce=L.Function,Nt=L.Math,ke=L.Object,ya=L.RegExp,Lp=L.String,_r=L.TypeError,$n=T.prototype,jp=Ce.prototype,os=ke.prototype,Dn=L["__core-js_shared__"],Ln=jp.toString,De=os.hasOwnProperty,qp=0,ou=function(){var e=/[^.]+$/.exec(Dn&&Dn.keys&&Dn.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),jn=os.toString,Mp=Ln.call(ke),zp=Pe._,Up=ya("^"+Ln.call(De).replace(lt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),qn=tr?L.Buffer:r,yi=L.Symbol,Mn=L.Uint8Array,au=qn?qn.allocUnsafe:r,zn=su(ke.getPrototypeOf,ke),cu=ke.create,uu=os.propertyIsEnumerable,Un=$n.splice,hu=yi?yi.isConcatSpreadable:r,As=yi?yi.iterator:r,Li=yi?yi.toStringTag:r,Hn=function(){try{var e=Ui(ke,"defineProperty");return e({},"",{}),e}catch{}}(),Hp=L.clearTimeout!==Pe.clearTimeout&&L.clearTimeout,kp=W&&W.now!==Pe.Date.now&&W.now,Kp=L.setTimeout!==Pe.setTimeout&&L.setTimeout,kn=Nt.ceil,Kn=Nt.floor,va=ke.getOwnPropertySymbols,Bp=qn?qn.isBuffer:r,lu=L.isFinite,Fp=$n.join,Vp=su(ke.keys,ke),$t=Nt.max,Bt=Nt.min,Gp=W.now,Wp=L.parseInt,fu=Nt.random,Jp=$n.reverse,ma=Ui(L,"DataView"),Cs=Ui(L,"Map"),wa=Ui(L,"Promise"),as=Ui(L,"Set"),Ts=Ui(L,"WeakMap"),Ns=Ui(ke,"create"),Bn=Ts&&new Ts,cs={},Qp=Hi(ma),Yp=Hi(Cs),Zp=Hi(wa),Xp=Hi(as),ed=Hi(Ts),Fn=yi?yi.prototype:r,$s=Fn?Fn.valueOf:r,pu=Fn?Fn.toString:r;function p(e){if(dt(e)&&!ge(e)&&!(e instanceof xe)){if(e instanceof Er)return e;if(De.call(e,"__wrapped__"))return dh(e)}return new Er(e)}var us=function(){function e(){}return function(i){if(!st(i))return{};if(cu)return cu(i);e.prototype=i;var n=new e;return e.prototype=r,n}}();function Vn(){}function Er(e,i){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!i,this.__index__=0,this.__values__=r}p.templateSettings={escape:ut,evaluate:ht,interpolate:it,variable:"",imports:{_:p}},p.prototype=Vn.prototype,p.prototype.constructor=p,Er.prototype=us(Vn.prototype),Er.prototype.constructor=Er;function xe(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=B,this.__views__=[]}function td(){var e=new xe(this.__wrapped__);return e.__actions__=rr(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=rr(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=rr(this.__views__),e}function rd(){if(this.__filtered__){var e=new xe(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function id(){var e=this.__wrapped__.value(),i=this.__dir__,n=ge(e),c=i<0,l=n?e.length:0,d=gg(0,l,this.__views__),w=d.start,E=d.end,R=E-w,q=c?E:w-1,M=this.__iteratees__,U=M.length,F=0,X=Bt(R,this.__takeCount__);if(!n||!c&&l==R&&X==R)return qu(e,this.__actions__);var se=[];e:for(;R--&&F<X;){q+=i;for(var we=-1,ne=e[q];++we<U;){var _e=M[we],Se=_e.iteratee,yr=_e.type,Xt=Se(ne);if(yr==S)ne=Xt;else if(!Xt){if(yr==b)continue e;break e}}se[F++]=ne}return se}xe.prototype=us(Vn.prototype),xe.prototype.constructor=xe;function ji(e){var i=-1,n=e==null?0:e.length;for(this.clear();++i<n;){var c=e[i];this.set(c[0],c[1])}}function sd(){this.__data__=Ns?Ns(null):{},this.size=0}function nd(e){var i=this.has(e)&&delete this.__data__[e];return this.size-=i?1:0,i}function od(e){var i=this.__data__;if(Ns){var n=i[e];return n===m?r:n}return De.call(i,e)?i[e]:r}function ad(e){var i=this.__data__;return Ns?i[e]!==r:De.call(i,e)}function cd(e,i){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Ns&&i===r?m:i,this}ji.prototype.clear=sd,ji.prototype.delete=nd,ji.prototype.get=od,ji.prototype.has=ad,ji.prototype.set=cd;function Qr(e){var i=-1,n=e==null?0:e.length;for(this.clear();++i<n;){var c=e[i];this.set(c[0],c[1])}}function ud(){this.__data__=[],this.size=0}function hd(e){var i=this.__data__,n=Gn(i,e);if(n<0)return!1;var c=i.length-1;return n==c?i.pop():Un.call(i,n,1),--this.size,!0}function ld(e){var i=this.__data__,n=Gn(i,e);return n<0?r:i[n][1]}function fd(e){return Gn(this.__data__,e)>-1}function pd(e,i){var n=this.__data__,c=Gn(n,e);return c<0?(++this.size,n.push([e,i])):n[c][1]=i,this}Qr.prototype.clear=ud,Qr.prototype.delete=hd,Qr.prototype.get=ld,Qr.prototype.has=fd,Qr.prototype.set=pd;function Yr(e){var i=-1,n=e==null?0:e.length;for(this.clear();++i<n;){var c=e[i];this.set(c[0],c[1])}}function dd(){this.size=0,this.__data__={hash:new ji,map:new(Cs||Qr),string:new ji}}function gd(e){var i=no(this,e).delete(e);return this.size-=i?1:0,i}function yd(e){return no(this,e).get(e)}function vd(e){return no(this,e).has(e)}function md(e,i){var n=no(this,e),c=n.size;return n.set(e,i),this.size+=n.size==c?0:1,this}Yr.prototype.clear=dd,Yr.prototype.delete=gd,Yr.prototype.get=yd,Yr.prototype.has=vd,Yr.prototype.set=md;function qi(e){var i=-1,n=e==null?0:e.length;for(this.__data__=new Yr;++i<n;)this.add(e[i])}function wd(e){return this.__data__.set(e,m),this}function bd(e){return this.__data__.has(e)}qi.prototype.add=qi.prototype.push=wd,qi.prototype.has=bd;function $r(e){var i=this.__data__=new Qr(e);this.size=i.size}function _d(){this.__data__=new Qr,this.size=0}function Ed(e){var i=this.__data__,n=i.delete(e);return this.size=i.size,n}function Id(e){return this.__data__.get(e)}function xd(e){return this.__data__.has(e)}function Pd(e,i){var n=this.__data__;if(n instanceof Qr){var c=n.__data__;if(!Cs||c.length<o-1)return c.push([e,i]),this.size=++n.size,this;n=this.__data__=new Yr(c)}return n.set(e,i),this.size=n.size,this}$r.prototype.clear=_d,$r.prototype.delete=Ed,$r.prototype.get=Id,$r.prototype.has=xd,$r.prototype.set=Pd;function du(e,i){var n=ge(e),c=!n&&ki(e),l=!n&&!c&&_i(e),d=!n&&!c&&!l&&ps(e),w=n||c||l||d,E=w?pa(e.length,Lp):[],R=E.length;for(var q in e)(i||De.call(e,q))&&!(w&&(q=="length"||l&&(q=="offset"||q=="parent")||d&&(q=="buffer"||q=="byteLength"||q=="byteOffset")||ti(q,R)))&&E.push(q);return E}function gu(e){var i=e.length;return i?e[Ca(0,i-1)]:r}function Sd(e,i){return oo(rr(e),Mi(i,0,e.length))}function Rd(e){return oo(rr(e))}function ba(e,i,n){(n!==r&&!Dr(e[i],n)||n===r&&!(i in e))&&Zr(e,i,n)}function Ds(e,i,n){var c=e[i];(!(De.call(e,i)&&Dr(c,n))||n===r&&!(i in e))&&Zr(e,i,n)}function Gn(e,i){for(var n=e.length;n--;)if(Dr(e[n][0],i))return n;return-1}function Od(e,i,n,c){return vi(e,function(l,d,w){i(c,l,n(l),w)}),c}function yu(e,i){return e&&Kr(i,jt(i),e)}function Ad(e,i){return e&&Kr(i,sr(i),e)}function Zr(e,i,n){i=="__proto__"&&Hn?Hn(e,i,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[i]=n}function _a(e,i){for(var n=-1,c=i.length,l=T(c),d=e==null;++n<c;)l[n]=d?r:tc(e,i[n]);return l}function Mi(e,i,n){return e===e&&(n!==r&&(e=e<=n?e:n),i!==r&&(e=e>=i?e:i)),e}function Ir(e,i,n,c,l,d){var w,E=i&O,R=i&$,q=i&j;if(n&&(w=l?n(e,c,l,d):n(e)),w!==r)return w;if(!st(e))return e;var M=ge(e);if(M){if(w=vg(e),!E)return rr(e,w)}else{var U=Ft(e),F=U==Z||U==ue;if(_i(e))return Uu(e,E);if(U==Ie||U==Ee||F&&!l){if(w=R||F?{}:nh(e),!E)return R?og(e,Ad(w,e)):ng(e,yu(w,e))}else{if(!je[U])return l?e:{};w=mg(e,U,E)}}d||(d=new $r);var X=d.get(e);if(X)return X;d.set(e,w),Dh(e)?e.forEach(function(ne){w.add(Ir(ne,i,n,ne,e,d))}):Nh(e)&&e.forEach(function(ne,_e){w.set(_e,Ir(ne,i,n,_e,e,d))});var se=q?R?Ha:Ua:R?sr:jt,we=M?r:se(e);return br(we||e,function(ne,_e){we&&(_e=ne,ne=e[_e]),Ds(w,_e,Ir(ne,i,n,_e,e,d))}),w}function Cd(e){var i=jt(e);return function(n){return vu(n,e,i)}}function vu(e,i,n){var c=n.length;if(e==null)return!c;for(e=ke(e);c--;){var l=n[c],d=i[l],w=e[l];if(w===r&&!(l in e)||!d(w))return!1}return!0}function mu(e,i,n){if(typeof e!="function")throw new _r(f);return Hs(function(){e.apply(r,n)},i)}function Ls(e,i,n,c){var l=-1,d=Cn,w=!0,E=e.length,R=[],q=i.length;if(!E)return R;n&&(i=Ze(i,pr(n))),c?(d=aa,w=!1):i.length>=o&&(d=Os,w=!1,i=new qi(i));e:for(;++l<E;){var M=e[l],U=n==null?M:n(M);if(M=c||M!==0?M:0,w&&U===U){for(var F=q;F--;)if(i[F]===U)continue e;R.push(M)}else d(i,U,c)||R.push(M)}return R}var vi=Fu(kr),wu=Fu(Ia,!0);function Td(e,i){var n=!0;return vi(e,function(c,l,d){return n=!!i(c,l,d),n}),n}function Wn(e,i,n){for(var c=-1,l=e.length;++c<l;){var d=e[c],w=i(d);if(w!=null&&(E===r?w===w&&!gr(w):n(w,E)))var E=w,R=d}return R}function Nd(e,i,n,c){var l=e.length;for(n=ye(n),n<0&&(n=-n>l?0:l+n),c=c===r||c>l?l:ye(c),c<0&&(c+=l),c=n>c?0:jh(c);n<c;)e[n++]=i;return e}function bu(e,i){var n=[];return vi(e,function(c,l,d){i(c,l,d)&&n.push(c)}),n}function kt(e,i,n,c,l){var d=-1,w=e.length;for(n||(n=bg),l||(l=[]);++d<w;){var E=e[d];i>0&&n(E)?i>1?kt(E,i-1,n,c,l):di(l,E):c||(l[l.length]=E)}return l}var Ea=Vu(),_u=Vu(!0);function kr(e,i){return e&&Ea(e,i,jt)}function Ia(e,i){return e&&_u(e,i,jt)}function Jn(e,i){return pi(i,function(n){return ri(e[n])})}function zi(e,i){i=wi(i,e);for(var n=0,c=i.length;e!=null&&n<c;)e=e[Br(i[n++])];return n&&n==c?e:r}function Eu(e,i,n){var c=i(e);return ge(e)?c:di(c,n(e))}function Yt(e){return e==null?e===r?rt:Ae:Li&&Li in ke(e)?dg(e):Rg(e)}function xa(e,i){return e>i}function $d(e,i){return e!=null&&De.call(e,i)}function Dd(e,i){return e!=null&&i in ke(e)}function Ld(e,i,n){return e>=Bt(i,n)&&e<$t(i,n)}function Pa(e,i,n){for(var c=n?aa:Cn,l=e[0].length,d=e.length,w=d,E=T(d),R=1/0,q=[];w--;){var M=e[w];w&&i&&(M=Ze(M,pr(i))),R=Bt(M.length,R),E[w]=!n&&(i||l>=120&&M.length>=120)?new qi(w&&M):r}M=e[0];var U=-1,F=E[0];e:for(;++U<l&&q.length<R;){var X=M[U],se=i?i(X):X;if(X=n||X!==0?X:0,!(F?Os(F,se):c(q,se,n))){for(w=d;--w;){var we=E[w];if(!(we?Os(we,se):c(e[w],se,n)))continue e}F&&F.push(se),q.push(X)}}return q}function jd(e,i,n,c){return kr(e,function(l,d,w){i(c,n(l),d,w)}),c}function js(e,i,n){i=wi(i,e),e=uh(e,i);var c=e==null?e:e[Br(Pr(i))];return c==null?r:Lt(c,e,n)}function Iu(e){return dt(e)&&Yt(e)==Ee}function qd(e){return dt(e)&&Yt(e)==Oe}function Md(e){return dt(e)&&Yt(e)==C}function qs(e,i,n,c,l){return e===i?!0:e==null||i==null||!dt(e)&&!dt(i)?e!==e&&i!==i:zd(e,i,n,c,qs,l)}function zd(e,i,n,c,l,d){var w=ge(e),E=ge(i),R=w?Ar:Ft(e),q=E?Ar:Ft(i);R=R==Ee?Ie:R,q=q==Ee?Ie:q;var M=R==Ie,U=q==Ie,F=R==q;if(F&&_i(e)){if(!_i(i))return!1;w=!0,M=!1}if(F&&!M)return d||(d=new $r),w||ps(e)?rh(e,i,n,c,l,d):fg(e,i,R,n,c,l,d);if(!(n&A)){var X=M&&De.call(e,"__wrapped__"),se=U&&De.call(i,"__wrapped__");if(X||se){var we=X?e.value():e,ne=se?i.value():i;return d||(d=new $r),l(we,ne,n,c,d)}}return F?(d||(d=new $r),pg(e,i,n,c,l,d)):!1}function Ud(e){return dt(e)&&Ft(e)==me}function Sa(e,i,n,c){var l=n.length,d=l,w=!c;if(e==null)return!d;for(e=ke(e);l--;){var E=n[l];if(w&&E[2]?E[1]!==e[E[0]]:!(E[0]in e))return!1}for(;++l<d;){E=n[l];var R=E[0],q=e[R],M=E[1];if(w&&E[2]){if(q===r&&!(R in e))return!1}else{var U=new $r;if(c)var F=c(q,M,R,e,i,U);if(!(F===r?qs(M,q,A|Q,c,U):F))return!1}}return!0}function xu(e){if(!st(e)||Eg(e))return!1;var i=ri(e)?Up:Fo;return i.test(Hi(e))}function Hd(e){return dt(e)&&Yt(e)==tt}function kd(e){return dt(e)&&Ft(e)==Te}function Kd(e){return dt(e)&&fo(e.length)&&!!ze[Yt(e)]}function Pu(e){return typeof e=="function"?e:e==null?nr:typeof e=="object"?ge(e)?Ou(e[0],e[1]):Ru(e):Gh(e)}function Ra(e){if(!Us(e))return Vp(e);var i=[];for(var n in ke(e))De.call(e,n)&&n!="constructor"&&i.push(n);return i}function Bd(e){if(!st(e))return Sg(e);var i=Us(e),n=[];for(var c in e)c=="constructor"&&(i||!De.call(e,c))||n.push(c);return n}function Oa(e,i){return e<i}function Su(e,i){var n=-1,c=ir(e)?T(e.length):[];return vi(e,function(l,d,w){c[++n]=i(l,d,w)}),c}function Ru(e){var i=Ka(e);return i.length==1&&i[0][2]?ah(i[0][0],i[0][1]):function(n){return n===e||Sa(n,e,i)}}function Ou(e,i){return Fa(e)&&oh(i)?ah(Br(e),i):function(n){var c=tc(n,e);return c===r&&c===i?rc(n,e):qs(i,c,A|Q)}}function Qn(e,i,n,c,l){e!==i&&Ea(i,function(d,w){if(l||(l=new $r),st(d))Fd(e,i,w,n,Qn,c,l);else{var E=c?c(Ga(e,w),d,w+"",e,i,l):r;E===r&&(E=d),ba(e,w,E)}},sr)}function Fd(e,i,n,c,l,d,w){var E=Ga(e,n),R=Ga(i,n),q=w.get(R);if(q){ba(e,n,q);return}var M=d?d(E,R,n+"",e,i,w):r,U=M===r;if(U){var F=ge(R),X=!F&&_i(R),se=!F&&!X&&ps(R);M=R,F||X||se?ge(E)?M=E:mt(E)?M=rr(E):X?(U=!1,M=Uu(R,!0)):se?(U=!1,M=Hu(R,!0)):M=[]:ks(R)||ki(R)?(M=E,ki(E)?M=qh(E):(!st(E)||ri(E))&&(M=nh(R))):U=!1}U&&(w.set(R,M),l(M,R,c,d,w),w.delete(R)),ba(e,n,M)}function Au(e,i){var n=e.length;if(n)return i+=i<0?n:0,ti(i,n)?e[i]:r}function Cu(e,i,n){i.length?i=Ze(i,function(d){return ge(d)?function(w){return zi(w,d.length===1?d[0]:d)}:d}):i=[nr];var c=-1;i=Ze(i,pr(ie()));var l=Su(e,function(d,w,E){var R=Ze(i,function(q){return q(d)});return{criteria:R,index:++c,value:d}});return mp(l,function(d,w){return sg(d,w,n)})}function Vd(e,i){return Tu(e,i,function(n,c){return rc(e,c)})}function Tu(e,i,n){for(var c=-1,l=i.length,d={};++c<l;){var w=i[c],E=zi(e,w);n(E,w)&&Ms(d,wi(w,e),E)}return d}function Gd(e){return function(i){return zi(i,e)}}function Aa(e,i,n,c){var l=c?vp:rs,d=-1,w=i.length,E=e;for(e===i&&(i=rr(i)),n&&(E=Ze(e,pr(n)));++d<w;)for(var R=0,q=i[d],M=n?n(q):q;(R=l(E,M,R,c))>-1;)E!==e&&Un.call(E,R,1),Un.call(e,R,1);return e}function Nu(e,i){for(var n=e?i.length:0,c=n-1;n--;){var l=i[n];if(n==c||l!==d){var d=l;ti(l)?Un.call(e,l,1):$a(e,l)}}return e}function Ca(e,i){return e+Kn(fu()*(i-e+1))}function Wd(e,i,n,c){for(var l=-1,d=$t(kn((i-e)/(n||1)),0),w=T(d);d--;)w[c?d:++l]=e,e+=n;return w}function Ta(e,i){var n="";if(!e||i<1||i>k)return n;do i%2&&(n+=e),i=Kn(i/2),i&&(e+=e);while(i);return n}function be(e,i){return Wa(ch(e,i,nr),e+"")}function Jd(e){return gu(ds(e))}function Qd(e,i){var n=ds(e);return oo(n,Mi(i,0,n.length))}function Ms(e,i,n,c){if(!st(e))return e;i=wi(i,e);for(var l=-1,d=i.length,w=d-1,E=e;E!=null&&++l<d;){var R=Br(i[l]),q=n;if(R==="__proto__"||R==="constructor"||R==="prototype")return e;if(l!=w){var M=E[R];q=c?c(M,R,E):r,q===r&&(q=st(M)?M:ti(i[l+1])?[]:{})}Ds(E,R,q),E=E[R]}return e}var $u=Bn?function(e,i){return Bn.set(e,i),e}:nr,Yd=Hn?function(e,i){return Hn(e,"toString",{configurable:!0,enumerable:!1,value:sc(i),writable:!0})}:nr;function Zd(e){return oo(ds(e))}function xr(e,i,n){var c=-1,l=e.length;i<0&&(i=-i>l?0:l+i),n=n>l?l:n,n<0&&(n+=l),l=i>n?0:n-i>>>0,i>>>=0;for(var d=T(l);++c<l;)d[c]=e[c+i];return d}function Xd(e,i){var n;return vi(e,function(c,l,d){return n=i(c,l,d),!n}),!!n}function Yn(e,i,n){var c=0,l=e==null?c:e.length;if(typeof i=="number"&&i===i&&l<=ot){for(;c<l;){var d=c+l>>>1,w=e[d];w!==null&&!gr(w)&&(n?w<=i:w<i)?c=d+1:l=d}return l}return Na(e,i,nr,n)}function Na(e,i,n,c){var l=0,d=e==null?0:e.length;if(d===0)return 0;i=n(i);for(var w=i!==i,E=i===null,R=gr(i),q=i===r;l<d;){var M=Kn((l+d)/2),U=n(e[M]),F=U!==r,X=U===null,se=U===U,we=gr(U);if(w)var ne=c||se;else q?ne=se&&(c||F):E?ne=se&&F&&(c||!X):R?ne=se&&F&&!X&&(c||!we):X||we?ne=!1:ne=c?U<=i:U<i;ne?l=M+1:d=M}return Bt(d,et)}function Du(e,i){for(var n=-1,c=e.length,l=0,d=[];++n<c;){var w=e[n],E=i?i(w):w;if(!n||!Dr(E,R)){var R=E;d[l++]=w===0?0:w}}return d}function Lu(e){return typeof e=="number"?e:gr(e)?K:+e}function dr(e){if(typeof e=="string")return e;if(ge(e))return Ze(e,dr)+"";if(gr(e))return pu?pu.call(e):"";var i=e+"";return i=="0"&&1/e==-le?"-0":i}function mi(e,i,n){var c=-1,l=Cn,d=e.length,w=!0,E=[],R=E;if(n)w=!1,l=aa;else if(d>=o){var q=i?null:hg(e);if(q)return Nn(q);w=!1,l=Os,R=new qi}else R=i?[]:E;e:for(;++c<d;){var M=e[c],U=i?i(M):M;if(M=n||M!==0?M:0,w&&U===U){for(var F=R.length;F--;)if(R[F]===U)continue e;i&&R.push(U),E.push(M)}else l(R,U,n)||(R!==E&&R.push(U),E.push(M))}return E}function $a(e,i){return i=wi(i,e),e=uh(e,i),e==null||delete e[Br(Pr(i))]}function ju(e,i,n,c){return Ms(e,i,n(zi(e,i)),c)}function Zn(e,i,n,c){for(var l=e.length,d=c?l:-1;(c?d--:++d<l)&&i(e[d],d,e););return n?xr(e,c?0:d,c?d+1:l):xr(e,c?d+1:0,c?l:d)}function qu(e,i){var n=e;return n instanceof xe&&(n=n.value()),ca(i,function(c,l){return l.func.apply(l.thisArg,di([c],l.args))},n)}function Da(e,i,n){var c=e.length;if(c<2)return c?mi(e[0]):[];for(var l=-1,d=T(c);++l<c;)for(var w=e[l],E=-1;++E<c;)E!=l&&(d[l]=Ls(d[l]||w,e[E],i,n));return mi(kt(d,1),i,n)}function Mu(e,i,n){for(var c=-1,l=e.length,d=i.length,w={};++c<l;){var E=c<d?i[c]:r;n(w,e[c],E)}return w}function La(e){return mt(e)?e:[]}function ja(e){return typeof e=="function"?e:nr}function wi(e,i){return ge(e)?e:Fa(e,i)?[e]:ph(Ne(e))}var eg=be;function bi(e,i,n){var c=e.length;return n=n===r?c:n,!i&&n>=c?e:xr(e,i,n)}var zu=Hp||function(e){return Pe.clearTimeout(e)};function Uu(e,i){if(i)return e.slice();var n=e.length,c=au?au(n):new e.constructor(n);return e.copy(c),c}function qa(e){var i=new e.constructor(e.byteLength);return new Mn(i).set(new Mn(e)),i}function tg(e,i){var n=i?qa(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}function rg(e){var i=new e.constructor(e.source,mr.exec(e));return i.lastIndex=e.lastIndex,i}function ig(e){return $s?ke($s.call(e)):{}}function Hu(e,i){var n=i?qa(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}function ku(e,i){if(e!==i){var n=e!==r,c=e===null,l=e===e,d=gr(e),w=i!==r,E=i===null,R=i===i,q=gr(i);if(!E&&!q&&!d&&e>i||d&&w&&R&&!E&&!q||c&&w&&R||!n&&R||!l)return 1;if(!c&&!d&&!q&&e<i||q&&n&&l&&!c&&!d||E&&n&&l||!w&&l||!R)return-1}return 0}function sg(e,i,n){for(var c=-1,l=e.criteria,d=i.criteria,w=l.length,E=n.length;++c<w;){var R=ku(l[c],d[c]);if(R){if(c>=E)return R;var q=n[c];return R*(q=="desc"?-1:1)}}return e.index-i.index}function Ku(e,i,n,c){for(var l=-1,d=e.length,w=n.length,E=-1,R=i.length,q=$t(d-w,0),M=T(R+q),U=!c;++E<R;)M[E]=i[E];for(;++l<w;)(U||l<d)&&(M[n[l]]=e[l]);for(;q--;)M[E++]=e[l++];return M}function Bu(e,i,n,c){for(var l=-1,d=e.length,w=-1,E=n.length,R=-1,q=i.length,M=$t(d-E,0),U=T(M+q),F=!c;++l<M;)U[l]=e[l];for(var X=l;++R<q;)U[X+R]=i[R];for(;++w<E;)(F||l<d)&&(U[X+n[w]]=e[l++]);return U}function rr(e,i){var n=-1,c=e.length;for(i||(i=T(c));++n<c;)i[n]=e[n];return i}function Kr(e,i,n,c){var l=!n;n||(n={});for(var d=-1,w=i.length;++d<w;){var E=i[d],R=c?c(n[E],e[E],E,n,e):r;R===r&&(R=e[E]),l?Zr(n,E,R):Ds(n,E,R)}return n}function ng(e,i){return Kr(e,Ba(e),i)}function og(e,i){return Kr(e,ih(e),i)}function Xn(e,i){return function(n,c){var l=ge(n)?lp:Od,d=i?i():{};return l(n,e,ie(c,2),d)}}function hs(e){return be(function(i,n){var c=-1,l=n.length,d=l>1?n[l-1]:r,w=l>2?n[2]:r;for(d=e.length>3&&typeof d=="function"?(l--,d):r,w&&Zt(n[0],n[1],w)&&(d=l<3?r:d,l=1),i=ke(i);++c<l;){var E=n[c];E&&e(i,E,c,d)}return i})}function Fu(e,i){return function(n,c){if(n==null)return n;if(!ir(n))return e(n,c);for(var l=n.length,d=i?l:-1,w=ke(n);(i?d--:++d<l)&&c(w[d],d,w)!==!1;);return n}}function Vu(e){return function(i,n,c){for(var l=-1,d=ke(i),w=c(i),E=w.length;E--;){var R=w[e?E:++l];if(n(d[R],R,d)===!1)break}return i}}function ag(e,i,n){var c=i&ee,l=zs(e);function d(){var w=this&&this!==Pe&&this instanceof d?l:e;return w.apply(c?n:this,arguments)}return d}function Gu(e){return function(i){i=Ne(i);var n=is(i)?Nr(i):r,c=n?n[0]:i.charAt(0),l=n?bi(n,1).join(""):i.slice(1);return c[e]()+l}}function ls(e){return function(i){return ca(Fh(Bh(i).replace(Ss,"")),e,"")}}function zs(e){return function(){var i=arguments;switch(i.length){case 0:return new e;case 1:return new e(i[0]);case 2:return new e(i[0],i[1]);case 3:return new e(i[0],i[1],i[2]);case 4:return new e(i[0],i[1],i[2],i[3]);case 5:return new e(i[0],i[1],i[2],i[3],i[4]);case 6:return new e(i[0],i[1],i[2],i[3],i[4],i[5]);case 7:return new e(i[0],i[1],i[2],i[3],i[4],i[5],i[6])}var n=us(e.prototype),c=e.apply(n,i);return st(c)?c:n}}function cg(e,i,n){var c=zs(e);function l(){for(var d=arguments.length,w=T(d),E=d,R=fs(l);E--;)w[E]=arguments[E];var q=d<3&&w[0]!==R&&w[d-1]!==R?[]:gi(w,R);if(d-=q.length,d<n)return Zu(e,i,eo,l.placeholder,r,w,q,r,r,n-d);var M=this&&this!==Pe&&this instanceof l?c:e;return Lt(M,this,w)}return l}function Wu(e){return function(i,n,c){var l=ke(i);if(!ir(i)){var d=ie(n,3);i=jt(i),n=function(E){return d(l[E],E,l)}}var w=e(i,n,c);return w>-1?l[d?i[w]:w]:r}}function Ju(e){return ei(function(i){var n=i.length,c=n,l=Er.prototype.thru;for(e&&i.reverse();c--;){var d=i[c];if(typeof d!="function")throw new _r(f);if(l&&!w&&so(d)=="wrapper")var w=new Er([],!0)}for(c=w?c:n;++c<n;){d=i[c];var E=so(d),R=E=="wrapper"?ka(d):r;R&&Va(R[0])&&R[1]==(Y|oe|he|ve)&&!R[4].length&&R[9]==1?w=w[so(R[0])].apply(w,R[3]):w=d.length==1&&Va(d)?w[E]():w.thru(d)}return function(){var q=arguments,M=q[0];if(w&&q.length==1&&ge(M))return w.plant(M).value();for(var U=0,F=n?i[U].apply(this,q):M;++U<n;)F=i[U].call(this,F);return F}})}function eo(e,i,n,c,l,d,w,E,R,q){var M=i&Y,U=i&ee,F=i&ce,X=i&(oe|te),se=i&bt,we=F?r:zs(e);function ne(){for(var _e=arguments.length,Se=T(_e),yr=_e;yr--;)Se[yr]=arguments[yr];if(X)var Xt=fs(ne),vr=bp(Se,Xt);if(c&&(Se=Ku(Se,c,l,X)),d&&(Se=Bu(Se,d,w,X)),_e-=vr,X&&_e<q){var wt=gi(Se,Xt);return Zu(e,i,eo,ne.placeholder,n,Se,wt,E,R,q-_e)}var Lr=U?n:this,si=F?Lr[e]:e;return _e=Se.length,E?Se=Og(Se,E):se&&_e>1&&Se.reverse(),M&&R<_e&&(Se.length=R),this&&this!==Pe&&this instanceof ne&&(si=we||zs(si)),si.apply(Lr,Se)}return ne}function Qu(e,i){return function(n,c){return jd(n,e,i(c),{})}}function to(e,i){return function(n,c){var l;if(n===r&&c===r)return i;if(n!==r&&(l=n),c!==r){if(l===r)return c;typeof n=="string"||typeof c=="string"?(n=dr(n),c=dr(c)):(n=Lu(n),c=Lu(c)),l=e(n,c)}return l}}function Ma(e){return ei(function(i){return i=Ze(i,pr(ie())),be(function(n){var c=this;return e(i,function(l){return Lt(l,c,n)})})})}function ro(e,i){i=i===r?" ":dr(i);var n=i.length;if(n<2)return n?Ta(i,e):i;var c=Ta(i,kn(e/ss(i)));return is(i)?bi(Nr(c),0,e).join(""):c.slice(0,e)}function ug(e,i,n,c){var l=i&ee,d=zs(e);function w(){for(var E=-1,R=arguments.length,q=-1,M=c.length,U=T(M+R),F=this&&this!==Pe&&this instanceof w?d:e;++q<M;)U[q]=c[q];for(;R--;)U[q++]=arguments[++E];return Lt(F,l?n:this,U)}return w}function Yu(e){return function(i,n,c){return c&&typeof c!="number"&&Zt(i,n,c)&&(n=c=r),i=ii(i),n===r?(n=i,i=0):n=ii(n),c=c===r?i<n?1:-1:ii(c),Wd(i,n,c,e)}}function io(e){return function(i,n){return typeof i=="string"&&typeof n=="string"||(i=Sr(i),n=Sr(n)),e(i,n)}}function Zu(e,i,n,c,l,d,w,E,R,q){var M=i&oe,U=M?w:r,F=M?r:w,X=M?d:r,se=M?r:d;i|=M?he:pe,i&=~(M?pe:he),i&ae||(i&=~(ee|ce));var we=[e,i,l,X,U,se,F,E,R,q],ne=n.apply(r,we);return Va(e)&&hh(ne,we),ne.placeholder=c,lh(ne,e,i)}function za(e){var i=Nt[e];return function(n,c){if(n=Sr(n),c=c==null?0:Bt(ye(c),292),c&&lu(n)){var l=(Ne(n)+"e").split("e"),d=i(l[0]+"e"+(+l[1]+c));return l=(Ne(d)+"e").split("e"),+(l[0]+"e"+(+l[1]-c))}return i(n)}}var hg=as&&1/Nn(new as([,-0]))[1]==le?function(e){return new as(e)}:ac;function Xu(e){return function(i){var n=Ft(i);return n==me?ga(i):n==Te?Rp(i):wp(i,e(i))}}function Xr(e,i,n,c,l,d,w,E){var R=i&ce;if(!R&&typeof e!="function")throw new _r(f);var q=c?c.length:0;if(q||(i&=~(he|pe),c=l=r),w=w===r?w:$t(ye(w),0),E=E===r?E:ye(E),q-=l?l.length:0,i&pe){var M=c,U=l;c=l=r}var F=R?r:ka(e),X=[e,i,n,c,l,M,U,d,w,E];if(F&&Pg(X,F),e=X[0],i=X[1],n=X[2],c=X[3],l=X[4],E=X[9]=X[9]===r?R?0:e.length:$t(X[9]-q,0),!E&&i&(oe|te)&&(i&=~(oe|te)),!i||i==ee)var se=ag(e,i,n);else i==oe||i==te?se=cg(e,i,E):(i==he||i==(ee|he))&&!l.length?se=ug(e,i,n,c):se=eo.apply(r,X);var we=F?$u:hh;return lh(we(se,X),e,i)}function eh(e,i,n,c){return e===r||Dr(e,os[n])&&!De.call(c,n)?i:e}function th(e,i,n,c,l,d){return st(e)&&st(i)&&(d.set(i,e),Qn(e,i,r,th,d),d.delete(i)),e}function lg(e){return ks(e)?r:e}function rh(e,i,n,c,l,d){var w=n&A,E=e.length,R=i.length;if(E!=R&&!(w&&R>E))return!1;var q=d.get(e),M=d.get(i);if(q&&M)return q==i&&M==e;var U=-1,F=!0,X=n&Q?new qi:r;for(d.set(e,i),d.set(i,e);++U<E;){var se=e[U],we=i[U];if(c)var ne=w?c(we,se,U,i,e,d):c(se,we,U,e,i,d);if(ne!==r){if(ne)continue;F=!1;break}if(X){if(!ua(i,function(_e,Se){if(!Os(X,Se)&&(se===_e||l(se,_e,n,c,d)))return X.push(Se)})){F=!1;break}}else if(!(se===we||l(se,we,n,c,d))){F=!1;break}}return d.delete(e),d.delete(i),F}function fg(e,i,n,c,l,d,w){switch(n){case Me:if(e.byteLength!=i.byteLength||e.byteOffset!=i.byteOffset)return!1;e=e.buffer,i=i.buffer;case Oe:return!(e.byteLength!=i.byteLength||!d(new Mn(e),new Mn(i)));case N:case C:case Re:return Dr(+e,+i);case I:return e.name==i.name&&e.message==i.message;case tt:case Fe:return e==i+"";case me:var E=ga;case Te:var R=c&A;if(E||(E=Nn),e.size!=i.size&&!R)return!1;var q=w.get(e);if(q)return q==i;c|=Q,w.set(e,i);var M=rh(E(e),E(i),c,l,d,w);return w.delete(e),M;case Ve:if($s)return $s.call(e)==$s.call(i)}return!1}function pg(e,i,n,c,l,d){var w=n&A,E=Ua(e),R=E.length,q=Ua(i),M=q.length;if(R!=M&&!w)return!1;for(var U=R;U--;){var F=E[U];if(!(w?F in i:De.call(i,F)))return!1}var X=d.get(e),se=d.get(i);if(X&&se)return X==i&&se==e;var we=!0;d.set(e,i),d.set(i,e);for(var ne=w;++U<R;){F=E[U];var _e=e[F],Se=i[F];if(c)var yr=w?c(Se,_e,F,i,e,d):c(_e,Se,F,e,i,d);if(!(yr===r?_e===Se||l(_e,Se,n,c,d):yr)){we=!1;break}ne||(ne=F=="constructor")}if(we&&!ne){var Xt=e.constructor,vr=i.constructor;Xt!=vr&&"constructor"in e&&"constructor"in i&&!(typeof Xt=="function"&&Xt instanceof Xt&&typeof vr=="function"&&vr instanceof vr)&&(we=!1)}return d.delete(e),d.delete(i),we}function ei(e){return Wa(ch(e,r,vh),e+"")}function Ua(e){return Eu(e,jt,Ba)}function Ha(e){return Eu(e,sr,ih)}var ka=Bn?function(e){return Bn.get(e)}:ac;function so(e){for(var i=e.name+"",n=cs[i],c=De.call(cs,i)?n.length:0;c--;){var l=n[c],d=l.func;if(d==null||d==e)return l.name}return i}function fs(e){var i=De.call(p,"placeholder")?p:e;return i.placeholder}function ie(){var e=p.iteratee||nc;return e=e===nc?Pu:e,arguments.length?e(arguments[0],arguments[1]):e}function no(e,i){var n=e.__data__;return _g(i)?n[typeof i=="string"?"string":"hash"]:n.map}function Ka(e){for(var i=jt(e),n=i.length;n--;){var c=i[n],l=e[c];i[n]=[c,l,oh(l)]}return i}function Ui(e,i){var n=xp(e,i);return xu(n)?n:r}function dg(e){var i=De.call(e,Li),n=e[Li];try{e[Li]=r;var c=!0}catch{}var l=jn.call(e);return c&&(i?e[Li]=n:delete e[Li]),l}var Ba=va?function(e){return e==null?[]:(e=ke(e),pi(va(e),function(i){return uu.call(e,i)}))}:cc,ih=va?function(e){for(var i=[];e;)di(i,Ba(e)),e=zn(e);return i}:cc,Ft=Yt;(ma&&Ft(new ma(new ArrayBuffer(1)))!=Me||Cs&&Ft(new Cs)!=me||wa&&Ft(wa.resolve())!=_t||as&&Ft(new as)!=Te||Ts&&Ft(new Ts)!=Le)&&(Ft=function(e){var i=Yt(e),n=i==Ie?e.constructor:r,c=n?Hi(n):"";if(c)switch(c){case Qp:return Me;case Yp:return me;case Zp:return _t;case Xp:return Te;case ed:return Le}return i});function gg(e,i,n){for(var c=-1,l=n.length;++c<l;){var d=n[c],w=d.size;switch(d.type){case"drop":e+=w;break;case"dropRight":i-=w;break;case"take":i=Bt(i,e+w);break;case"takeRight":e=$t(e,i-w);break}}return{start:e,end:i}}function yg(e){var i=e.match(Ke);return i?i[1].split(St):[]}function sh(e,i,n){i=wi(i,e);for(var c=-1,l=i.length,d=!1;++c<l;){var w=Br(i[c]);if(!(d=e!=null&&n(e,w)))break;e=e[w]}return d||++c!=l?d:(l=e==null?0:e.length,!!l&&fo(l)&&ti(w,l)&&(ge(e)||ki(e)))}function vg(e){var i=e.length,n=new e.constructor(i);return i&&typeof e[0]=="string"&&De.call(e,"index")&&(n.index=e.index,n.input=e.input),n}function nh(e){return typeof e.constructor=="function"&&!Us(e)?us(zn(e)):{}}function mg(e,i,n){var c=e.constructor;switch(i){case Oe:return qa(e);case N:case C:return new c(+e);case Me:return tg(e,n);case at:case $e:case Et:case Tt:case Ut:case Ht:case Dt:case Wt:case er:return Hu(e,n);case me:return new c;case Re:case Fe:return new c(e);case tt:return rg(e);case Te:return new c;case Ve:return ig(e)}}function wg(e,i){var n=i.length;if(!n)return e;var c=n-1;return i[c]=(n>1?"& ":"")+i[c],i=i.join(n>2?", ":" "),e.replace(pt,`{
/* [wrapped with `+i+`] */
`)}function bg(e){return ge(e)||ki(e)||!!(hu&&e&&e[hu])}function ti(e,i){var n=typeof e;return i=i??k,!!i&&(n=="number"||n!="symbol"&&Go.test(e))&&e>-1&&e%1==0&&e<i}function Zt(e,i,n){if(!st(n))return!1;var c=typeof i;return(c=="number"?ir(n)&&ti(i,n.length):c=="string"&&i in n)?Dr(n[i],e):!1}function Fa(e,i){if(ge(e))return!1;var n=typeof e;return n=="number"||n=="symbol"||n=="boolean"||e==null||gr(e)?!0:It.test(e)||!Ye.test(e)||i!=null&&e in ke(i)}function _g(e){var i=typeof e;return i=="string"||i=="number"||i=="symbol"||i=="boolean"?e!=="__proto__":e===null}function Va(e){var i=so(e),n=p[i];if(typeof n!="function"||!(i in xe.prototype))return!1;if(e===n)return!0;var c=ka(n);return!!c&&e===c[0]}function Eg(e){return!!ou&&ou in e}var Ig=Dn?ri:uc;function Us(e){var i=e&&e.constructor,n=typeof i=="function"&&i.prototype||os;return e===n}function oh(e){return e===e&&!st(e)}function ah(e,i){return function(n){return n==null?!1:n[e]===i&&(i!==r||e in ke(n))}}function xg(e){var i=ho(e,function(c){return n.size===g&&n.clear(),c}),n=i.cache;return i}function Pg(e,i){var n=e[1],c=i[1],l=n|c,d=l<(ee|ce|Y),w=c==Y&&n==oe||c==Y&&n==ve&&e[7].length<=i[8]||c==(Y|ve)&&i[7].length<=i[8]&&n==oe;if(!(d||w))return e;c&ee&&(e[2]=i[2],l|=n&ee?0:ae);var E=i[3];if(E){var R=e[3];e[3]=R?Ku(R,E,i[4]):E,e[4]=R?gi(e[3],_):i[4]}return E=i[5],E&&(R=e[5],e[5]=R?Bu(R,E,i[6]):E,e[6]=R?gi(e[5],_):i[6]),E=i[7],E&&(e[7]=E),c&Y&&(e[8]=e[8]==null?i[8]:Bt(e[8],i[8])),e[9]==null&&(e[9]=i[9]),e[0]=i[0],e[1]=l,e}function Sg(e){var i=[];if(e!=null)for(var n in ke(e))i.push(n);return i}function Rg(e){return jn.call(e)}function ch(e,i,n){return i=$t(i===r?e.length-1:i,0),function(){for(var c=arguments,l=-1,d=$t(c.length-i,0),w=T(d);++l<d;)w[l]=c[i+l];l=-1;for(var E=T(i+1);++l<i;)E[l]=c[l];return E[i]=n(w),Lt(e,this,E)}}function uh(e,i){return i.length<2?e:zi(e,xr(i,0,-1))}function Og(e,i){for(var n=e.length,c=Bt(i.length,n),l=rr(e);c--;){var d=i[c];e[c]=ti(d,n)?l[d]:r}return e}function Ga(e,i){if(!(i==="constructor"&&typeof e[i]=="function")&&i!="__proto__")return e[i]}var hh=fh($u),Hs=Kp||function(e,i){return Pe.setTimeout(e,i)},Wa=fh(Yd);function lh(e,i,n){var c=i+"";return Wa(e,wg(c,Ag(yg(c),n)))}function fh(e){var i=0,n=0;return function(){var c=Gp(),l=zt-(c-n);if(n=c,l>0){if(++i>=Mt)return arguments[0]}else i=0;return e.apply(r,arguments)}}function oo(e,i){var n=-1,c=e.length,l=c-1;for(i=i===r?c:i;++n<i;){var d=Ca(n,l),w=e[d];e[d]=e[n],e[n]=w}return e.length=i,e}var ph=xg(function(e){var i=[];return e.charCodeAt(0)===46&&i.push(""),e.replace(xt,function(n,c,l,d){i.push(l?d.replace(Ho,"$1"):c||n)}),i});function Br(e){if(typeof e=="string"||gr(e))return e;var i=e+"";return i=="0"&&1/e==-le?"-0":i}function Hi(e){if(e!=null){try{return Ln.call(e)}catch{}try{return e+""}catch{}}return""}function Ag(e,i){return br(Oi,function(n){var c="_."+n[0];i&n[1]&&!Cn(e,c)&&e.push(c)}),e.sort()}function dh(e){if(e instanceof xe)return e.clone();var i=new Er(e.__wrapped__,e.__chain__);return i.__actions__=rr(e.__actions__),i.__index__=e.__index__,i.__values__=e.__values__,i}function Cg(e,i,n){(n?Zt(e,i,n):i===r)?i=1:i=$t(ye(i),0);var c=e==null?0:e.length;if(!c||i<1)return[];for(var l=0,d=0,w=T(kn(c/i));l<c;)w[d++]=xr(e,l,l+=i);return w}function Tg(e){for(var i=-1,n=e==null?0:e.length,c=0,l=[];++i<n;){var d=e[i];d&&(l[c++]=d)}return l}function Ng(){var e=arguments.length;if(!e)return[];for(var i=T(e-1),n=arguments[0],c=e;c--;)i[c-1]=arguments[c];return di(ge(n)?rr(n):[n],kt(i,1))}var $g=be(function(e,i){return mt(e)?Ls(e,kt(i,1,mt,!0)):[]}),Dg=be(function(e,i){var n=Pr(i);return mt(n)&&(n=r),mt(e)?Ls(e,kt(i,1,mt,!0),ie(n,2)):[]}),Lg=be(function(e,i){var n=Pr(i);return mt(n)&&(n=r),mt(e)?Ls(e,kt(i,1,mt,!0),r,n):[]});function jg(e,i,n){var c=e==null?0:e.length;return c?(i=n||i===r?1:ye(i),xr(e,i<0?0:i,c)):[]}function qg(e,i,n){var c=e==null?0:e.length;return c?(i=n||i===r?1:ye(i),i=c-i,xr(e,0,i<0?0:i)):[]}function Mg(e,i){return e&&e.length?Zn(e,ie(i,3),!0,!0):[]}function zg(e,i){return e&&e.length?Zn(e,ie(i,3),!0):[]}function Ug(e,i,n,c){var l=e==null?0:e.length;return l?(n&&typeof n!="number"&&Zt(e,i,n)&&(n=0,c=l),Nd(e,i,n,c)):[]}function gh(e,i,n){var c=e==null?0:e.length;if(!c)return-1;var l=n==null?0:ye(n);return l<0&&(l=$t(c+l,0)),Tn(e,ie(i,3),l)}function yh(e,i,n){var c=e==null?0:e.length;if(!c)return-1;var l=c-1;return n!==r&&(l=ye(n),l=n<0?$t(c+l,0):Bt(l,c-1)),Tn(e,ie(i,3),l,!0)}function vh(e){var i=e==null?0:e.length;return i?kt(e,1):[]}function Hg(e){var i=e==null?0:e.length;return i?kt(e,le):[]}function kg(e,i){var n=e==null?0:e.length;return n?(i=i===r?1:ye(i),kt(e,i)):[]}function Kg(e){for(var i=-1,n=e==null?0:e.length,c={};++i<n;){var l=e[i];c[l[0]]=l[1]}return c}function mh(e){return e&&e.length?e[0]:r}function Bg(e,i,n){var c=e==null?0:e.length;if(!c)return-1;var l=n==null?0:ye(n);return l<0&&(l=$t(c+l,0)),rs(e,i,l)}function Fg(e){var i=e==null?0:e.length;return i?xr(e,0,-1):[]}var Vg=be(function(e){var i=Ze(e,La);return i.length&&i[0]===e[0]?Pa(i):[]}),Gg=be(function(e){var i=Pr(e),n=Ze(e,La);return i===Pr(n)?i=r:n.pop(),n.length&&n[0]===e[0]?Pa(n,ie(i,2)):[]}),Wg=be(function(e){var i=Pr(e),n=Ze(e,La);return i=typeof i=="function"?i:r,i&&n.pop(),n.length&&n[0]===e[0]?Pa(n,r,i):[]});function Jg(e,i){return e==null?"":Fp.call(e,i)}function Pr(e){var i=e==null?0:e.length;return i?e[i-1]:r}function Qg(e,i,n){var c=e==null?0:e.length;if(!c)return-1;var l=c;return n!==r&&(l=ye(n),l=l<0?$t(c+l,0):Bt(l,c-1)),i===i?Ap(e,i,l):Tn(e,Zc,l,!0)}function Yg(e,i){return e&&e.length?Au(e,ye(i)):r}var Zg=be(wh);function wh(e,i){return e&&e.length&&i&&i.length?Aa(e,i):e}function Xg(e,i,n){return e&&e.length&&i&&i.length?Aa(e,i,ie(n,2)):e}function ey(e,i,n){return e&&e.length&&i&&i.length?Aa(e,i,r,n):e}var ty=ei(function(e,i){var n=e==null?0:e.length,c=_a(e,i);return Nu(e,Ze(i,function(l){return ti(l,n)?+l:l}).sort(ku)),c});function ry(e,i){var n=[];if(!(e&&e.length))return n;var c=-1,l=[],d=e.length;for(i=ie(i,3);++c<d;){var w=e[c];i(w,c,e)&&(n.push(w),l.push(c))}return Nu(e,l),n}function Ja(e){return e==null?e:Jp.call(e)}function iy(e,i,n){var c=e==null?0:e.length;return c?(n&&typeof n!="number"&&Zt(e,i,n)?(i=0,n=c):(i=i==null?0:ye(i),n=n===r?c:ye(n)),xr(e,i,n)):[]}function sy(e,i){return Yn(e,i)}function ny(e,i,n){return Na(e,i,ie(n,2))}function oy(e,i){var n=e==null?0:e.length;if(n){var c=Yn(e,i);if(c<n&&Dr(e[c],i))return c}return-1}function ay(e,i){return Yn(e,i,!0)}function cy(e,i,n){return Na(e,i,ie(n,2),!0)}function uy(e,i){var n=e==null?0:e.length;if(n){var c=Yn(e,i,!0)-1;if(Dr(e[c],i))return c}return-1}function hy(e){return e&&e.length?Du(e):[]}function ly(e,i){return e&&e.length?Du(e,ie(i,2)):[]}function fy(e){var i=e==null?0:e.length;return i?xr(e,1,i):[]}function py(e,i,n){return e&&e.length?(i=n||i===r?1:ye(i),xr(e,0,i<0?0:i)):[]}function dy(e,i,n){var c=e==null?0:e.length;return c?(i=n||i===r?1:ye(i),i=c-i,xr(e,i<0?0:i,c)):[]}function gy(e,i){return e&&e.length?Zn(e,ie(i,3),!1,!0):[]}function yy(e,i){return e&&e.length?Zn(e,ie(i,3)):[]}var vy=be(function(e){return mi(kt(e,1,mt,!0))}),my=be(function(e){var i=Pr(e);return mt(i)&&(i=r),mi(kt(e,1,mt,!0),ie(i,2))}),wy=be(function(e){var i=Pr(e);return i=typeof i=="function"?i:r,mi(kt(e,1,mt,!0),r,i)});function by(e){return e&&e.length?mi(e):[]}function _y(e,i){return e&&e.length?mi(e,ie(i,2)):[]}function Ey(e,i){return i=typeof i=="function"?i:r,e&&e.length?mi(e,r,i):[]}function Qa(e){if(!(e&&e.length))return[];var i=0;return e=pi(e,function(n){if(mt(n))return i=$t(n.length,i),!0}),pa(i,function(n){return Ze(e,ha(n))})}function bh(e,i){if(!(e&&e.length))return[];var n=Qa(e);return i==null?n:Ze(n,function(c){return Lt(i,r,c)})}var Iy=be(function(e,i){return mt(e)?Ls(e,i):[]}),xy=be(function(e){return Da(pi(e,mt))}),Py=be(function(e){var i=Pr(e);return mt(i)&&(i=r),Da(pi(e,mt),ie(i,2))}),Sy=be(function(e){var i=Pr(e);return i=typeof i=="function"?i:r,Da(pi(e,mt),r,i)}),Ry=be(Qa);function Oy(e,i){return Mu(e||[],i||[],Ds)}function Ay(e,i){return Mu(e||[],i||[],Ms)}var Cy=be(function(e){var i=e.length,n=i>1?e[i-1]:r;return n=typeof n=="function"?(e.pop(),n):r,bh(e,n)});function _h(e){var i=p(e);return i.__chain__=!0,i}function Ty(e,i){return i(e),e}function ao(e,i){return i(e)}var Ny=ei(function(e){var i=e.length,n=i?e[0]:0,c=this.__wrapped__,l=function(d){return _a(d,e)};return i>1||this.__actions__.length||!(c instanceof xe)||!ti(n)?this.thru(l):(c=c.slice(n,+n+(i?1:0)),c.__actions__.push({func:ao,args:[l],thisArg:r}),new Er(c,this.__chain__).thru(function(d){return i&&!d.length&&d.push(r),d}))});function $y(){return _h(this)}function Dy(){return new Er(this.value(),this.__chain__)}function Ly(){this.__values__===r&&(this.__values__=Lh(this.value()));var e=this.__index__>=this.__values__.length,i=e?r:this.__values__[this.__index__++];return{done:e,value:i}}function jy(){return this}function qy(e){for(var i,n=this;n instanceof Vn;){var c=dh(n);c.__index__=0,c.__values__=r,i?l.__wrapped__=c:i=c;var l=c;n=n.__wrapped__}return l.__wrapped__=e,i}function My(){var e=this.__wrapped__;if(e instanceof xe){var i=e;return this.__actions__.length&&(i=new xe(this)),i=i.reverse(),i.__actions__.push({func:ao,args:[Ja],thisArg:r}),new Er(i,this.__chain__)}return this.thru(Ja)}function zy(){return qu(this.__wrapped__,this.__actions__)}var Uy=Xn(function(e,i,n){De.call(e,n)?++e[n]:Zr(e,n,1)});function Hy(e,i,n){var c=ge(e)?Qc:Td;return n&&Zt(e,i,n)&&(i=r),c(e,ie(i,3))}function ky(e,i){var n=ge(e)?pi:bu;return n(e,ie(i,3))}var Ky=Wu(gh),By=Wu(yh);function Fy(e,i){return kt(co(e,i),1)}function Vy(e,i){return kt(co(e,i),le)}function Gy(e,i,n){return n=n===r?1:ye(n),kt(co(e,i),n)}function Eh(e,i){var n=ge(e)?br:vi;return n(e,ie(i,3))}function Ih(e,i){var n=ge(e)?fp:wu;return n(e,ie(i,3))}var Wy=Xn(function(e,i,n){De.call(e,n)?e[n].push(i):Zr(e,n,[i])});function Jy(e,i,n,c){e=ir(e)?e:ds(e),n=n&&!c?ye(n):0;var l=e.length;return n<0&&(n=$t(l+n,0)),po(e)?n<=l&&e.indexOf(i,n)>-1:!!l&&rs(e,i,n)>-1}var Qy=be(function(e,i,n){var c=-1,l=typeof i=="function",d=ir(e)?T(e.length):[];return vi(e,function(w){d[++c]=l?Lt(i,w,n):js(w,i,n)}),d}),Yy=Xn(function(e,i,n){Zr(e,n,i)});function co(e,i){var n=ge(e)?Ze:Su;return n(e,ie(i,3))}function Zy(e,i,n,c){return e==null?[]:(ge(i)||(i=i==null?[]:[i]),n=c?r:n,ge(n)||(n=n==null?[]:[n]),Cu(e,i,n))}var Xy=Xn(function(e,i,n){e[n?0:1].push(i)},function(){return[[],[]]});function ev(e,i,n){var c=ge(e)?ca:eu,l=arguments.length<3;return c(e,ie(i,4),n,l,vi)}function tv(e,i,n){var c=ge(e)?pp:eu,l=arguments.length<3;return c(e,ie(i,4),n,l,wu)}function rv(e,i){var n=ge(e)?pi:bu;return n(e,lo(ie(i,3)))}function iv(e){var i=ge(e)?gu:Jd;return i(e)}function sv(e,i,n){(n?Zt(e,i,n):i===r)?i=1:i=ye(i);var c=ge(e)?Sd:Qd;return c(e,i)}function nv(e){var i=ge(e)?Rd:Zd;return i(e)}function ov(e){if(e==null)return 0;if(ir(e))return po(e)?ss(e):e.length;var i=Ft(e);return i==me||i==Te?e.size:Ra(e).length}function av(e,i,n){var c=ge(e)?ua:Xd;return n&&Zt(e,i,n)&&(i=r),c(e,ie(i,3))}var cv=be(function(e,i){if(e==null)return[];var n=i.length;return n>1&&Zt(e,i[0],i[1])?i=[]:n>2&&Zt(i[0],i[1],i[2])&&(i=[i[0]]),Cu(e,kt(i,1),[])}),uo=kp||function(){return Pe.Date.now()};function uv(e,i){if(typeof i!="function")throw new _r(f);return e=ye(e),function(){if(--e<1)return i.apply(this,arguments)}}function xh(e,i,n){return i=n?r:i,i=e&&i==null?e.length:i,Xr(e,Y,r,r,r,r,i)}function Ph(e,i){var n;if(typeof i!="function")throw new _r(f);return e=ye(e),function(){return--e>0&&(n=i.apply(this,arguments)),e<=1&&(i=r),n}}var Ya=be(function(e,i,n){var c=ee;if(n.length){var l=gi(n,fs(Ya));c|=he}return Xr(e,c,i,n,l)}),Sh=be(function(e,i,n){var c=ee|ce;if(n.length){var l=gi(n,fs(Sh));c|=he}return Xr(i,c,e,n,l)});function Rh(e,i,n){i=n?r:i;var c=Xr(e,oe,r,r,r,r,r,i);return c.placeholder=Rh.placeholder,c}function Oh(e,i,n){i=n?r:i;var c=Xr(e,te,r,r,r,r,r,i);return c.placeholder=Oh.placeholder,c}function Ah(e,i,n){var c,l,d,w,E,R,q=0,M=!1,U=!1,F=!0;if(typeof e!="function")throw new _r(f);i=Sr(i)||0,st(n)&&(M=!!n.leading,U="maxWait"in n,d=U?$t(Sr(n.maxWait)||0,i):d,F="trailing"in n?!!n.trailing:F);function X(wt){var Lr=c,si=l;return c=l=r,q=wt,w=e.apply(si,Lr),w}function se(wt){return q=wt,E=Hs(_e,i),M?X(wt):w}function we(wt){var Lr=wt-R,si=wt-q,Wh=i-Lr;return U?Bt(Wh,d-si):Wh}function ne(wt){var Lr=wt-R,si=wt-q;return R===r||Lr>=i||Lr<0||U&&si>=d}function _e(){var wt=uo();if(ne(wt))return Se(wt);E=Hs(_e,we(wt))}function Se(wt){return E=r,F&&c?X(wt):(c=l=r,w)}function yr(){E!==r&&zu(E),q=0,c=R=l=E=r}function Xt(){return E===r?w:Se(uo())}function vr(){var wt=uo(),Lr=ne(wt);if(c=arguments,l=this,R=wt,Lr){if(E===r)return se(R);if(U)return zu(E),E=Hs(_e,i),X(R)}return E===r&&(E=Hs(_e,i)),w}return vr.cancel=yr,vr.flush=Xt,vr}var hv=be(function(e,i){return mu(e,1,i)}),lv=be(function(e,i,n){return mu(e,Sr(i)||0,n)});function fv(e){return Xr(e,bt)}function ho(e,i){if(typeof e!="function"||i!=null&&typeof i!="function")throw new _r(f);var n=function(){var c=arguments,l=i?i.apply(this,c):c[0],d=n.cache;if(d.has(l))return d.get(l);var w=e.apply(this,c);return n.cache=d.set(l,w)||d,w};return n.cache=new(ho.Cache||Yr),n}ho.Cache=Yr;function lo(e){if(typeof e!="function")throw new _r(f);return function(){var i=arguments;switch(i.length){case 0:return!e.call(this);case 1:return!e.call(this,i[0]);case 2:return!e.call(this,i[0],i[1]);case 3:return!e.call(this,i[0],i[1],i[2])}return!e.apply(this,i)}}function pv(e){return Ph(2,e)}var dv=eg(function(e,i){i=i.length==1&&ge(i[0])?Ze(i[0],pr(ie())):Ze(kt(i,1),pr(ie()));var n=i.length;return be(function(c){for(var l=-1,d=Bt(c.length,n);++l<d;)c[l]=i[l].call(this,c[l]);return Lt(e,this,c)})}),Za=be(function(e,i){var n=gi(i,fs(Za));return Xr(e,he,r,i,n)}),Ch=be(function(e,i){var n=gi(i,fs(Ch));return Xr(e,pe,r,i,n)}),gv=ei(function(e,i){return Xr(e,ve,r,r,r,i)});function yv(e,i){if(typeof e!="function")throw new _r(f);return i=i===r?i:ye(i),be(e,i)}function vv(e,i){if(typeof e!="function")throw new _r(f);return i=i==null?0:$t(ye(i),0),be(function(n){var c=n[i],l=bi(n,0,i);return c&&di(l,c),Lt(e,this,l)})}function mv(e,i,n){var c=!0,l=!0;if(typeof e!="function")throw new _r(f);return st(n)&&(c="leading"in n?!!n.leading:c,l="trailing"in n?!!n.trailing:l),Ah(e,i,{leading:c,maxWait:i,trailing:l})}function wv(e){return xh(e,1)}function bv(e,i){return Za(ja(i),e)}function _v(){if(!arguments.length)return[];var e=arguments[0];return ge(e)?e:[e]}function Ev(e){return Ir(e,j)}function Iv(e,i){return i=typeof i=="function"?i:r,Ir(e,j,i)}function xv(e){return Ir(e,O|j)}function Pv(e,i){return i=typeof i=="function"?i:r,Ir(e,O|j,i)}function Sv(e,i){return i==null||vu(e,i,jt(i))}function Dr(e,i){return e===i||e!==e&&i!==i}var Rv=io(xa),Ov=io(function(e,i){return e>=i}),ki=Iu(function(){return arguments}())?Iu:function(e){return dt(e)&&De.call(e,"callee")&&!uu.call(e,"callee")},ge=T.isArray,Av=Qt?pr(Qt):qd;function ir(e){return e!=null&&fo(e.length)&&!ri(e)}function mt(e){return dt(e)&&ir(e)}function Cv(e){return e===!0||e===!1||dt(e)&&Yt(e)==N}var _i=Bp||uc,Tv=Tr?pr(Tr):Md;function Nv(e){return dt(e)&&e.nodeType===1&&!ks(e)}function $v(e){if(e==null)return!0;if(ir(e)&&(ge(e)||typeof e=="string"||typeof e.splice=="function"||_i(e)||ps(e)||ki(e)))return!e.length;var i=Ft(e);if(i==me||i==Te)return!e.size;if(Us(e))return!Ra(e).length;for(var n in e)if(De.call(e,n))return!1;return!0}function Dv(e,i){return qs(e,i)}function Lv(e,i,n){n=typeof n=="function"?n:r;var c=n?n(e,i):r;return c===r?qs(e,i,r,n):!!c}function Xa(e){if(!dt(e))return!1;var i=Yt(e);return i==I||i==u||typeof e.message=="string"&&typeof e.name=="string"&&!ks(e)}function jv(e){return typeof e=="number"&&lu(e)}function ri(e){if(!st(e))return!1;var i=Yt(e);return i==Z||i==ue||i==D||i==gt}function Th(e){return typeof e=="number"&&e==ye(e)}function fo(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=k}function st(e){var i=typeof e;return e!=null&&(i=="object"||i=="function")}function dt(e){return e!=null&&typeof e=="object"}var Nh=wr?pr(wr):Ud;function qv(e,i){return e===i||Sa(e,i,Ka(i))}function Mv(e,i,n){return n=typeof n=="function"?n:r,Sa(e,i,Ka(i),n)}function zv(e){return $h(e)&&e!=+e}function Uv(e){if(Ig(e))throw new fe(h);return xu(e)}function Hv(e){return e===null}function kv(e){return e==null}function $h(e){return typeof e=="number"||dt(e)&&Yt(e)==Re}function ks(e){if(!dt(e)||Yt(e)!=Ie)return!1;var i=zn(e);if(i===null)return!0;var n=De.call(i,"constructor")&&i.constructor;return typeof n=="function"&&n instanceof n&&Ln.call(n)==Mp}var ec=Hr?pr(Hr):Hd;function Kv(e){return Th(e)&&e>=-k&&e<=k}var Dh=Rs?pr(Rs):kd;function po(e){return typeof e=="string"||!ge(e)&&dt(e)&&Yt(e)==Fe}function gr(e){return typeof e=="symbol"||dt(e)&&Yt(e)==Ve}var ps=Di?pr(Di):Kd;function Bv(e){return e===r}function Fv(e){return dt(e)&&Ft(e)==Le}function Vv(e){return dt(e)&&Yt(e)==Ge}var Gv=io(Oa),Wv=io(function(e,i){return e<=i});function Lh(e){if(!e)return[];if(ir(e))return po(e)?Nr(e):rr(e);if(As&&e[As])return Sp(e[As]());var i=Ft(e),n=i==me?ga:i==Te?Nn:ds;return n(e)}function ii(e){if(!e)return e===0?e:0;if(e=Sr(e),e===le||e===-le){var i=e<0?-1:1;return i*H}return e===e?e:0}function ye(e){var i=ii(e),n=i%1;return i===i?n?i-n:i:0}function jh(e){return e?Mi(ye(e),0,B):0}function Sr(e){if(typeof e=="number")return e;if(gr(e))return K;if(st(e)){var i=typeof e.valueOf=="function"?e.valueOf():e;e=st(i)?i+"":i}if(typeof e!="string")return e===0?e:+e;e=tu(e);var n=Bo.test(e);return n||Vo.test(e)?de(e.slice(2),n?2:8):Ko.test(e)?K:+e}function qh(e){return Kr(e,sr(e))}function Jv(e){return e?Mi(ye(e),-k,k):e===0?e:0}function Ne(e){return e==null?"":dr(e)}var Qv=hs(function(e,i){if(Us(i)||ir(i)){Kr(i,jt(i),e);return}for(var n in i)De.call(i,n)&&Ds(e,n,i[n])}),Mh=hs(function(e,i){Kr(i,sr(i),e)}),go=hs(function(e,i,n,c){Kr(i,sr(i),e,c)}),Yv=hs(function(e,i,n,c){Kr(i,jt(i),e,c)}),Zv=ei(_a);function Xv(e,i){var n=us(e);return i==null?n:yu(n,i)}var em=be(function(e,i){e=ke(e);var n=-1,c=i.length,l=c>2?i[2]:r;for(l&&Zt(i[0],i[1],l)&&(c=1);++n<c;)for(var d=i[n],w=sr(d),E=-1,R=w.length;++E<R;){var q=w[E],M=e[q];(M===r||Dr(M,os[q])&&!De.call(e,q))&&(e[q]=d[q])}return e}),tm=be(function(e){return e.push(r,th),Lt(zh,r,e)});function rm(e,i){return Yc(e,ie(i,3),kr)}function im(e,i){return Yc(e,ie(i,3),Ia)}function sm(e,i){return e==null?e:Ea(e,ie(i,3),sr)}function nm(e,i){return e==null?e:_u(e,ie(i,3),sr)}function om(e,i){return e&&kr(e,ie(i,3))}function am(e,i){return e&&Ia(e,ie(i,3))}function cm(e){return e==null?[]:Jn(e,jt(e))}function um(e){return e==null?[]:Jn(e,sr(e))}function tc(e,i,n){var c=e==null?r:zi(e,i);return c===r?n:c}function hm(e,i){return e!=null&&sh(e,i,$d)}function rc(e,i){return e!=null&&sh(e,i,Dd)}var lm=Qu(function(e,i,n){i!=null&&typeof i.toString!="function"&&(i=jn.call(i)),e[i]=n},sc(nr)),fm=Qu(function(e,i,n){i!=null&&typeof i.toString!="function"&&(i=jn.call(i)),De.call(e,i)?e[i].push(n):e[i]=[n]},ie),pm=be(js);function jt(e){return ir(e)?du(e):Ra(e)}function sr(e){return ir(e)?du(e,!0):Bd(e)}function dm(e,i){var n={};return i=ie(i,3),kr(e,function(c,l,d){Zr(n,i(c,l,d),c)}),n}function gm(e,i){var n={};return i=ie(i,3),kr(e,function(c,l,d){Zr(n,l,i(c,l,d))}),n}var ym=hs(function(e,i,n){Qn(e,i,n)}),zh=hs(function(e,i,n,c){Qn(e,i,n,c)}),vm=ei(function(e,i){var n={};if(e==null)return n;var c=!1;i=Ze(i,function(d){return d=wi(d,e),c||(c=d.length>1),d}),Kr(e,Ha(e),n),c&&(n=Ir(n,O|$|j,lg));for(var l=i.length;l--;)$a(n,i[l]);return n});function mm(e,i){return Uh(e,lo(ie(i)))}var wm=ei(function(e,i){return e==null?{}:Vd(e,i)});function Uh(e,i){if(e==null)return{};var n=Ze(Ha(e),function(c){return[c]});return i=ie(i),Tu(e,n,function(c,l){return i(c,l[0])})}function bm(e,i,n){i=wi(i,e);var c=-1,l=i.length;for(l||(l=1,e=r);++c<l;){var d=e==null?r:e[Br(i[c])];d===r&&(c=l,d=n),e=ri(d)?d.call(e):d}return e}function _m(e,i,n){return e==null?e:Ms(e,i,n)}function Em(e,i,n,c){return c=typeof c=="function"?c:r,e==null?e:Ms(e,i,n,c)}var Hh=Xu(jt),kh=Xu(sr);function Im(e,i,n){var c=ge(e),l=c||_i(e)||ps(e);if(i=ie(i,4),n==null){var d=e&&e.constructor;l?n=c?new d:[]:st(e)?n=ri(d)?us(zn(e)):{}:n={}}return(l?br:kr)(e,function(w,E,R){return i(n,w,E,R)}),n}function xm(e,i){return e==null?!0:$a(e,i)}function Pm(e,i,n){return e==null?e:ju(e,i,ja(n))}function Sm(e,i,n,c){return c=typeof c=="function"?c:r,e==null?e:ju(e,i,ja(n),c)}function ds(e){return e==null?[]:da(e,jt(e))}function Rm(e){return e==null?[]:da(e,sr(e))}function Om(e,i,n){return n===r&&(n=i,i=r),n!==r&&(n=Sr(n),n=n===n?n:0),i!==r&&(i=Sr(i),i=i===i?i:0),Mi(Sr(e),i,n)}function Am(e,i,n){return i=ii(i),n===r?(n=i,i=0):n=ii(n),e=Sr(e),Ld(e,i,n)}function Cm(e,i,n){if(n&&typeof n!="boolean"&&Zt(e,i,n)&&(i=n=r),n===r&&(typeof i=="boolean"?(n=i,i=r):typeof e=="boolean"&&(n=e,e=r)),e===r&&i===r?(e=0,i=1):(e=ii(e),i===r?(i=e,e=0):i=ii(i)),e>i){var c=e;e=i,i=c}if(n||e%1||i%1){var l=fu();return Bt(e+l*(i-e+Ue("1e-"+((l+"").length-1))),i)}return Ca(e,i)}var Tm=ls(function(e,i,n){return i=i.toLowerCase(),e+(n?Kh(i):i)});function Kh(e){return ic(Ne(e).toLowerCase())}function Bh(e){return e=Ne(e),e&&e.replace(Wr,_p).replace(na,"")}function Nm(e,i,n){e=Ne(e),i=dr(i);var c=e.length;n=n===r?c:Mi(ye(n),0,c);var l=n;return n-=i.length,n>=0&&e.slice(n,l)==i}function $m(e){return e=Ne(e),e&&Qe.test(e)?e.replace(Ai,Ep):e}function Dm(e){return e=Ne(e),e&&Pt.test(e)?e.replace(lt,"\\$&"):e}var Lm=ls(function(e,i,n){return e+(n?"-":"")+i.toLowerCase()}),jm=ls(function(e,i,n){return e+(n?" ":"")+i.toLowerCase()}),qm=Gu("toLowerCase");function Mm(e,i,n){e=Ne(e),i=ye(i);var c=i?ss(e):0;if(!i||c>=i)return e;var l=(i-c)/2;return ro(Kn(l),n)+e+ro(kn(l),n)}function zm(e,i,n){e=Ne(e),i=ye(i);var c=i?ss(e):0;return i&&c<i?e+ro(i-c,n):e}function Um(e,i,n){e=Ne(e),i=ye(i);var c=i?ss(e):0;return i&&c<i?ro(i-c,n)+e:e}function Hm(e,i,n){return n||i==null?i=0:i&&(i=+i),Wp(Ne(e).replace(ft,""),i||0)}function km(e,i,n){return(n?Zt(e,i,n):i===r)?i=1:i=ye(i),Ta(Ne(e),i)}function Km(){var e=arguments,i=Ne(e[0]);return e.length<3?i:i.replace(e[1],e[2])}var Bm=ls(function(e,i,n){return e+(n?"_":"")+i.toLowerCase()});function Fm(e,i,n){return n&&typeof n!="number"&&Zt(e,i,n)&&(i=n=r),n=n===r?B:n>>>0,n?(e=Ne(e),e&&(typeof i=="string"||i!=null&&!ec(i))&&(i=dr(i),!i&&is(e))?bi(Nr(e),0,n):e.split(i,n)):[]}var Vm=ls(function(e,i,n){return e+(n?" ":"")+ic(i)});function Gm(e,i,n){return e=Ne(e),n=n==null?0:Mi(ye(n),0,e.length),i=dr(i),e.slice(n,n+i.length)==i}function Wm(e,i,n){var c=p.templateSettings;n&&Zt(e,i,n)&&(i=r),e=Ne(e),i=go({},i,c,eh);var l=go({},i.imports,c.imports,eh),d=jt(l),w=da(l,d),E,R,q=0,M=i.interpolate||Ji,U="__p += '",F=ya((i.escape||Ji).source+"|"+M.source+"|"+(M===it?ko:Ji).source+"|"+(i.evaluate||Ji).source+"|$","g"),X="//# sourceURL="+(De.call(i,"sourceURL")?(i.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++oa+"]")+`
`;e.replace(F,function(ne,_e,Se,yr,Xt,vr){return Se||(Se=yr),U+=e.slice(q,vr).replace(Wo,Ip),_e&&(E=!0,U+=`' +
__e(`+_e+`) +
'`),Xt&&(R=!0,U+=`';
`+Xt+`;
__p += '`),Se&&(U+=`' +
((__t = (`+Se+`)) == null ? '' : __t) +
'`),q=vr+ne.length,ne}),U+=`';
`;var se=De.call(i,"variable")&&i.variable;if(!se)U=`with (obj) {
`+U+`
}
`;else if(Uo.test(se))throw new fe(y);U=(R?U.replace(zr,""):U).replace(Jt,"$1").replace(Gr,"$1;"),U="function("+(se||"obj")+`) {
`+(se?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(E?", __e = _.escape":"")+(R?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+U+`return __p
}`;var we=Vh(function(){return Ce(d,X+"return "+U).apply(r,w)});if(we.source=U,Xa(we))throw we;return we}function Jm(e){return Ne(e).toLowerCase()}function Qm(e){return Ne(e).toUpperCase()}function Ym(e,i,n){if(e=Ne(e),e&&(n||i===r))return tu(e);if(!e||!(i=dr(i)))return e;var c=Nr(e),l=Nr(i),d=ru(c,l),w=iu(c,l)+1;return bi(c,d,w).join("")}function Zm(e,i,n){if(e=Ne(e),e&&(n||i===r))return e.slice(0,nu(e)+1);if(!e||!(i=dr(i)))return e;var c=Nr(e),l=iu(c,Nr(i))+1;return bi(c,0,l).join("")}function Xm(e,i,n){if(e=Ne(e),e&&(n||i===r))return e.replace(ft,"");if(!e||!(i=dr(i)))return e;var c=Nr(e),l=ru(c,Nr(i));return bi(c,l).join("")}function e0(e,i){var n=nt,c=Be;if(st(i)){var l="separator"in i?i.separator:l;n="length"in i?ye(i.length):n,c="omission"in i?dr(i.omission):c}e=Ne(e);var d=e.length;if(is(e)){var w=Nr(e);d=w.length}if(n>=d)return e;var E=n-ss(c);if(E<1)return c;var R=w?bi(w,0,E).join(""):e.slice(0,E);if(l===r)return R+c;if(w&&(E+=R.length-E),ec(l)){if(e.slice(E).search(l)){var q,M=R;for(l.global||(l=ya(l.source,Ne(mr.exec(l))+"g")),l.lastIndex=0;q=l.exec(M);)var U=q.index;R=R.slice(0,U===r?E:U)}}else if(e.indexOf(dr(l),E)!=E){var F=R.lastIndexOf(l);F>-1&&(R=R.slice(0,F))}return R+c}function t0(e){return e=Ne(e),e&&ct.test(e)?e.replace(li,Cp):e}var r0=ls(function(e,i,n){return e+(n?" ":"")+i.toUpperCase()}),ic=Gu("toUpperCase");function Fh(e,i,n){return e=Ne(e),i=n?r:i,i===r?Pp(e)?$p(e):yp(e):e.match(i)||[]}var Vh=be(function(e,i){try{return Lt(e,r,i)}catch(n){return Xa(n)?n:new fe(n)}}),i0=ei(function(e,i){return br(i,function(n){n=Br(n),Zr(e,n,Ya(e[n],e))}),e});function s0(e){var i=e==null?0:e.length,n=ie();return e=i?Ze(e,function(c){if(typeof c[1]!="function")throw new _r(f);return[n(c[0]),c[1]]}):[],be(function(c){for(var l=-1;++l<i;){var d=e[l];if(Lt(d[0],this,c))return Lt(d[1],this,c)}})}function n0(e){return Cd(Ir(e,O))}function sc(e){return function(){return e}}function o0(e,i){return e==null||e!==e?i:e}var a0=Ju(),c0=Ju(!0);function nr(e){return e}function nc(e){return Pu(typeof e=="function"?e:Ir(e,O))}function u0(e){return Ru(Ir(e,O))}function h0(e,i){return Ou(e,Ir(i,O))}var l0=be(function(e,i){return function(n){return js(n,e,i)}}),f0=be(function(e,i){return function(n){return js(e,n,i)}});function oc(e,i,n){var c=jt(i),l=Jn(i,c);n==null&&!(st(i)&&(l.length||!c.length))&&(n=i,i=e,e=this,l=Jn(i,jt(i)));var d=!(st(n)&&"chain"in n)||!!n.chain,w=ri(e);return br(l,function(E){var R=i[E];e[E]=R,w&&(e.prototype[E]=function(){var q=this.__chain__;if(d||q){var M=e(this.__wrapped__),U=M.__actions__=rr(this.__actions__);return U.push({func:R,args:arguments,thisArg:e}),M.__chain__=q,M}return R.apply(e,di([this.value()],arguments))})}),e}function p0(){return Pe._===this&&(Pe._=zp),this}function ac(){}function d0(e){return e=ye(e),be(function(i){return Au(i,e)})}var g0=Ma(Ze),y0=Ma(Qc),v0=Ma(ua);function Gh(e){return Fa(e)?ha(Br(e)):Gd(e)}function m0(e){return function(i){return e==null?r:zi(e,i)}}var w0=Yu(),b0=Yu(!0);function cc(){return[]}function uc(){return!1}function _0(){return{}}function E0(){return""}function I0(){return!0}function x0(e,i){if(e=ye(e),e<1||e>k)return[];var n=B,c=Bt(e,B);i=ie(i),e-=B;for(var l=pa(c,i);++n<e;)i(n);return l}function P0(e){return ge(e)?Ze(e,Br):gr(e)?[e]:rr(ph(Ne(e)))}function S0(e){var i=++qp;return Ne(e)+i}var R0=to(function(e,i){return e+i},0),O0=za("ceil"),A0=to(function(e,i){return e/i},1),C0=za("floor");function T0(e){return e&&e.length?Wn(e,nr,xa):r}function N0(e,i){return e&&e.length?Wn(e,ie(i,2),xa):r}function $0(e){return Xc(e,nr)}function D0(e,i){return Xc(e,ie(i,2))}function L0(e){return e&&e.length?Wn(e,nr,Oa):r}function j0(e,i){return e&&e.length?Wn(e,ie(i,2),Oa):r}var q0=to(function(e,i){return e*i},1),M0=za("round"),z0=to(function(e,i){return e-i},0);function U0(e){return e&&e.length?fa(e,nr):0}function H0(e,i){return e&&e.length?fa(e,ie(i,2)):0}return p.after=uv,p.ary=xh,p.assign=Qv,p.assignIn=Mh,p.assignInWith=go,p.assignWith=Yv,p.at=Zv,p.before=Ph,p.bind=Ya,p.bindAll=i0,p.bindKey=Sh,p.castArray=_v,p.chain=_h,p.chunk=Cg,p.compact=Tg,p.concat=Ng,p.cond=s0,p.conforms=n0,p.constant=sc,p.countBy=Uy,p.create=Xv,p.curry=Rh,p.curryRight=Oh,p.debounce=Ah,p.defaults=em,p.defaultsDeep=tm,p.defer=hv,p.delay=lv,p.difference=$g,p.differenceBy=Dg,p.differenceWith=Lg,p.drop=jg,p.dropRight=qg,p.dropRightWhile=Mg,p.dropWhile=zg,p.fill=Ug,p.filter=ky,p.flatMap=Fy,p.flatMapDeep=Vy,p.flatMapDepth=Gy,p.flatten=vh,p.flattenDeep=Hg,p.flattenDepth=kg,p.flip=fv,p.flow=a0,p.flowRight=c0,p.fromPairs=Kg,p.functions=cm,p.functionsIn=um,p.groupBy=Wy,p.initial=Fg,p.intersection=Vg,p.intersectionBy=Gg,p.intersectionWith=Wg,p.invert=lm,p.invertBy=fm,p.invokeMap=Qy,p.iteratee=nc,p.keyBy=Yy,p.keys=jt,p.keysIn=sr,p.map=co,p.mapKeys=dm,p.mapValues=gm,p.matches=u0,p.matchesProperty=h0,p.memoize=ho,p.merge=ym,p.mergeWith=zh,p.method=l0,p.methodOf=f0,p.mixin=oc,p.negate=lo,p.nthArg=d0,p.omit=vm,p.omitBy=mm,p.once=pv,p.orderBy=Zy,p.over=g0,p.overArgs=dv,p.overEvery=y0,p.overSome=v0,p.partial=Za,p.partialRight=Ch,p.partition=Xy,p.pick=wm,p.pickBy=Uh,p.property=Gh,p.propertyOf=m0,p.pull=Zg,p.pullAll=wh,p.pullAllBy=Xg,p.pullAllWith=ey,p.pullAt=ty,p.range=w0,p.rangeRight=b0,p.rearg=gv,p.reject=rv,p.remove=ry,p.rest=yv,p.reverse=Ja,p.sampleSize=sv,p.set=_m,p.setWith=Em,p.shuffle=nv,p.slice=iy,p.sortBy=cv,p.sortedUniq=hy,p.sortedUniqBy=ly,p.split=Fm,p.spread=vv,p.tail=fy,p.take=py,p.takeRight=dy,p.takeRightWhile=gy,p.takeWhile=yy,p.tap=Ty,p.throttle=mv,p.thru=ao,p.toArray=Lh,p.toPairs=Hh,p.toPairsIn=kh,p.toPath=P0,p.toPlainObject=qh,p.transform=Im,p.unary=wv,p.union=vy,p.unionBy=my,p.unionWith=wy,p.uniq=by,p.uniqBy=_y,p.uniqWith=Ey,p.unset=xm,p.unzip=Qa,p.unzipWith=bh,p.update=Pm,p.updateWith=Sm,p.values=ds,p.valuesIn=Rm,p.without=Iy,p.words=Fh,p.wrap=bv,p.xor=xy,p.xorBy=Py,p.xorWith=Sy,p.zip=Ry,p.zipObject=Oy,p.zipObjectDeep=Ay,p.zipWith=Cy,p.entries=Hh,p.entriesIn=kh,p.extend=Mh,p.extendWith=go,oc(p,p),p.add=R0,p.attempt=Vh,p.camelCase=Tm,p.capitalize=Kh,p.ceil=O0,p.clamp=Om,p.clone=Ev,p.cloneDeep=xv,p.cloneDeepWith=Pv,p.cloneWith=Iv,p.conformsTo=Sv,p.deburr=Bh,p.defaultTo=o0,p.divide=A0,p.endsWith=Nm,p.eq=Dr,p.escape=$m,p.escapeRegExp=Dm,p.every=Hy,p.find=Ky,p.findIndex=gh,p.findKey=rm,p.findLast=By,p.findLastIndex=yh,p.findLastKey=im,p.floor=C0,p.forEach=Eh,p.forEachRight=Ih,p.forIn=sm,p.forInRight=nm,p.forOwn=om,p.forOwnRight=am,p.get=tc,p.gt=Rv,p.gte=Ov,p.has=hm,p.hasIn=rc,p.head=mh,p.identity=nr,p.includes=Jy,p.indexOf=Bg,p.inRange=Am,p.invoke=pm,p.isArguments=ki,p.isArray=ge,p.isArrayBuffer=Av,p.isArrayLike=ir,p.isArrayLikeObject=mt,p.isBoolean=Cv,p.isBuffer=_i,p.isDate=Tv,p.isElement=Nv,p.isEmpty=$v,p.isEqual=Dv,p.isEqualWith=Lv,p.isError=Xa,p.isFinite=jv,p.isFunction=ri,p.isInteger=Th,p.isLength=fo,p.isMap=Nh,p.isMatch=qv,p.isMatchWith=Mv,p.isNaN=zv,p.isNative=Uv,p.isNil=kv,p.isNull=Hv,p.isNumber=$h,p.isObject=st,p.isObjectLike=dt,p.isPlainObject=ks,p.isRegExp=ec,p.isSafeInteger=Kv,p.isSet=Dh,p.isString=po,p.isSymbol=gr,p.isTypedArray=ps,p.isUndefined=Bv,p.isWeakMap=Fv,p.isWeakSet=Vv,p.join=Jg,p.kebabCase=Lm,p.last=Pr,p.lastIndexOf=Qg,p.lowerCase=jm,p.lowerFirst=qm,p.lt=Gv,p.lte=Wv,p.max=T0,p.maxBy=N0,p.mean=$0,p.meanBy=D0,p.min=L0,p.minBy=j0,p.stubArray=cc,p.stubFalse=uc,p.stubObject=_0,p.stubString=E0,p.stubTrue=I0,p.multiply=q0,p.nth=Yg,p.noConflict=p0,p.noop=ac,p.now=uo,p.pad=Mm,p.padEnd=zm,p.padStart=Um,p.parseInt=Hm,p.random=Cm,p.reduce=ev,p.reduceRight=tv,p.repeat=km,p.replace=Km,p.result=bm,p.round=M0,p.runInContext=P,p.sample=iv,p.size=ov,p.snakeCase=Bm,p.some=av,p.sortedIndex=sy,p.sortedIndexBy=ny,p.sortedIndexOf=oy,p.sortedLastIndex=ay,p.sortedLastIndexBy=cy,p.sortedLastIndexOf=uy,p.startCase=Vm,p.startsWith=Gm,p.subtract=z0,p.sum=U0,p.sumBy=H0,p.template=Wm,p.times=x0,p.toFinite=ii,p.toInteger=ye,p.toLength=jh,p.toLower=Jm,p.toNumber=Sr,p.toSafeInteger=Jv,p.toString=Ne,p.toUpper=Qm,p.trim=Ym,p.trimEnd=Zm,p.trimStart=Xm,p.truncate=e0,p.unescape=t0,p.uniqueId=S0,p.upperCase=r0,p.upperFirst=ic,p.each=Eh,p.eachRight=Ih,p.first=mh,oc(p,function(){var e={};return kr(p,function(i,n){De.call(p.prototype,n)||(e[n]=i)}),e}(),{chain:!1}),p.VERSION=s,br(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){p[e].placeholder=p}),br(["drop","take"],function(e,i){xe.prototype[e]=function(n){n=n===r?1:$t(ye(n),0);var c=this.__filtered__&&!i?new xe(this):this.clone();return c.__filtered__?c.__takeCount__=Bt(n,c.__takeCount__):c.__views__.push({size:Bt(n,B),type:e+(c.__dir__<0?"Right":"")}),c},xe.prototype[e+"Right"]=function(n){return this.reverse()[e](n).reverse()}}),br(["filter","map","takeWhile"],function(e,i){var n=i+1,c=n==b||n==J;xe.prototype[e]=function(l){var d=this.clone();return d.__iteratees__.push({iteratee:ie(l,3),type:n}),d.__filtered__=d.__filtered__||c,d}}),br(["head","last"],function(e,i){var n="take"+(i?"Right":"");xe.prototype[e]=function(){return this[n](1).value()[0]}}),br(["initial","tail"],function(e,i){var n="drop"+(i?"":"Right");xe.prototype[e]=function(){return this.__filtered__?new xe(this):this[n](1)}}),xe.prototype.compact=function(){return this.filter(nr)},xe.prototype.find=function(e){return this.filter(e).head()},xe.prototype.findLast=function(e){return this.reverse().find(e)},xe.prototype.invokeMap=be(function(e,i){return typeof e=="function"?new xe(this):this.map(function(n){return js(n,e,i)})}),xe.prototype.reject=function(e){return this.filter(lo(ie(e)))},xe.prototype.slice=function(e,i){e=ye(e);var n=this;return n.__filtered__&&(e>0||i<0)?new xe(n):(e<0?n=n.takeRight(-e):e&&(n=n.drop(e)),i!==r&&(i=ye(i),n=i<0?n.dropRight(-i):n.take(i-e)),n)},xe.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},xe.prototype.toArray=function(){return this.take(B)},kr(xe.prototype,function(e,i){var n=/^(?:filter|find|map|reject)|While$/.test(i),c=/^(?:head|last)$/.test(i),l=p[c?"take"+(i=="last"?"Right":""):i],d=c||/^find/.test(i);l&&(p.prototype[i]=function(){var w=this.__wrapped__,E=c?[1]:arguments,R=w instanceof xe,q=E[0],M=R||ge(w),U=function(_e){var Se=l.apply(p,di([_e],E));return c&&F?Se[0]:Se};M&&n&&typeof q=="function"&&q.length!=1&&(R=M=!1);var F=this.__chain__,X=!!this.__actions__.length,se=d&&!F,we=R&&!X;if(!d&&M){w=we?w:new xe(this);var ne=e.apply(w,E);return ne.__actions__.push({func:ao,args:[U],thisArg:r}),new Er(ne,F)}return se&&we?e.apply(this,E):(ne=this.thru(U),se?c?ne.value()[0]:ne.value():ne)})}),br(["pop","push","shift","sort","splice","unshift"],function(e){var i=$n[e],n=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",c=/^(?:pop|shift)$/.test(e);p.prototype[e]=function(){var l=arguments;if(c&&!this.__chain__){var d=this.value();return i.apply(ge(d)?d:[],l)}return this[n](function(w){return i.apply(ge(w)?w:[],l)})}}),kr(xe.prototype,function(e,i){var n=p[i];if(n){var c=n.name+"";De.call(cs,c)||(cs[c]=[]),cs[c].push({name:i,func:n})}}),cs[eo(r,ce).name]=[{name:"wrapper",func:r}],xe.prototype.clone=td,xe.prototype.reverse=rd,xe.prototype.value=id,p.prototype.at=Ny,p.prototype.chain=$y,p.prototype.commit=Dy,p.prototype.next=Ly,p.prototype.plant=qy,p.prototype.reverse=My,p.prototype.toJSON=p.prototype.valueOf=p.prototype.value=zy,p.prototype.first=p.prototype.head,As&&(p.prototype[As]=jy),p},ns=Dp();vt?((vt.exports=ns)._=ns,He._=ns):Pe._=ns}).call(Js)})(Dc,Dc.exports);var VI=Object.defineProperty,GI=Object.defineProperties,WI=Object.getOwnPropertyDescriptors,tf=Object.getOwnPropertySymbols,JI=Object.prototype.hasOwnProperty,QI=Object.prototype.propertyIsEnumerable,rf=(a,t,r)=>t in a?VI(a,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[t]=r,_o=(a,t)=>{for(var r in t||(t={}))JI.call(t,r)&&rf(a,r,t[r]);if(tf)for(var r of tf(t))QI.call(t,r)&&rf(a,r,t[r]);return a},YI=(a,t)=>GI(a,WI(t));function Pi(a,t,r){var s;const o=Ow(a);return((s=t.rpcMap)==null?void 0:s[o.reference])||`${FI}?chainId=${o.namespace}:${o.reference}&projectId=${r}`}function Wi(a){return a.includes(":")?a.split(":")[1]:a}function up(a){return a.map(t=>`${t.split(":")[0]}:${t.split(":")[1]}`)}function ZI(a,t){const r=Object.keys(t.namespaces).filter(o=>o.includes(a));if(!r.length)return[];const s=[];return r.forEach(o=>{const h=t.namespaces[o].accounts;s.push(...h)}),s}function XI(a={},t={}){const r=sf(a),s=sf(t);return Dc.exports.merge(r,s)}function sf(a){var t,r,s,o;const h={};if(!xo(a))return h;for(const[f,y]of Object.entries(a)){const m=mf(f)?[f]:y.chains,g=y.methods||[],_=y.events||[],O=y.rpcMap||{},$=Qs(f);h[$]=YI(_o(_o({},h[$]),y),{chains:lc(m,(t=h[$])==null?void 0:t.chains),methods:lc(g,(r=h[$])==null?void 0:r.methods),events:lc(_,(s=h[$])==null?void 0:s.events),rpcMap:_o(_o({},O),(o=h[$])==null?void 0:o.rpcMap)})}return h}function ex(a){return a.includes(":")?a.split(":")[2]:a}function tx(a){const t={};for(const[r,s]of Object.entries(a)){const o=s.methods||[],h=s.events||[],f=s.accounts||[],y=mf(r)?[r]:s.chains?s.chains:up(s.accounts);t[r]={chains:y,methods:o,events:h,accounts:f}}return t}function Ec(a){return typeof a=="number"?a:a.includes("0x")?parseInt(a,16):a.includes(":")?Number(a.split(":")[1]):Number(a)}const hp={},Xe=a=>hp[a],Ic=(a,t)=>{hp[a]=t};class rx{constructor(t){this.name="polkadot",this.namespace=t.namespace,this.events=Xe("events"),this.client=Xe("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(hi.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getAccounts(){const t=this.namespace.accounts;return t?t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const o=Wi(r);t[o]=this.createHttpProvider(o,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Pi(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new Ri(new Si(s,Xe("disableProviderPing")))}}class ix{constructor(t){this.name="eip155",this.namespace=t.namespace,this.events=Xe("events"),this.client=Xe("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(t){switch(t.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(t);case"eth_chainId":return parseInt(this.getDefaultChain())}return this.namespace.methods.includes(t.request.method)?await this.client.request(t):this.getHttpProvider().request(t.request)}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(parseInt(t),r),this.chainId=parseInt(t),this.events.emit(hi.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}createHttpProvider(t,r){const s=r||Pi(`${this.name}:${t}`,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new Ri(new Si(s,Xe("disableProviderPing")))}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const o=parseInt(Wi(r));t[o]=this.createHttpProvider(o,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}getHttpProvider(){const t=this.chainId,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}async handleSwitchChain(t){var r,s;let o=t.request.params?(r=t.request.params[0])==null?void 0:r.chainId:"0x0";o=o.startsWith("0x")?o:`0x${o}`;const h=parseInt(o,16);if(this.isChainApproved(h))this.setDefaultChain(`${h}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:t.topic,request:{method:t.request.method,params:[{chainId:o}]},chainId:(s=this.namespace.chains)==null?void 0:s[0]}),this.setDefaultChain(`${h}`);else throw new Error(`Failed to switch to chain 'eip155:${h}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(t){return this.namespace.chains.includes(`${this.name}:${t}`)}}class sx{constructor(t){this.name="solana",this.namespace=t.namespace,this.events=Xe("events"),this.client=Xe("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(hi.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const o=Wi(r);t[o]=this.createHttpProvider(o,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Pi(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new Ri(new Si(s,Xe("disableProviderPing")))}}class nx{constructor(t){this.name="cosmos",this.namespace=t.namespace,this.events=Xe("events"),this.client=Xe("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(hi.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const o=Wi(r);t[o]=this.createHttpProvider(o,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Pi(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new Ri(new Si(s,Xe("disableProviderPing")))}}class ox{constructor(t){this.name="cip34",this.namespace=t.namespace,this.events=Xe("events"),this.client=Xe("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(hi.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{const s=this.getCardanoRPCUrl(r),o=Wi(r);t[o]=this.createHttpProvider(o,s)}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}getCardanoRPCUrl(t){const r=this.namespace.rpcMap;if(r)return r[t]}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||this.getCardanoRPCUrl(t);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new Ri(new Si(s,Xe("disableProviderPing")))}}class ax{constructor(t){this.name="elrond",this.namespace=t.namespace,this.events=Xe("events"),this.client=Xe("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(hi.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const o=Wi(r);t[o]=this.createHttpProvider(o,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Pi(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new Ri(new Si(s,Xe("disableProviderPing")))}}class cx{constructor(t){this.name="multiversx",this.namespace=t.namespace,this.events=Xe("events"),this.client=Xe("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(hi.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const o=Wi(r);t[o]=this.createHttpProvider(o,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Pi(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new Ri(new Si(s,Xe("disableProviderPing")))}}class ux{constructor(t){this.name="near",this.namespace=t.namespace,this.events=Xe("events"),this.client=Xe("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){if(this.chainId=t,!this.httpProviders[t]){const s=r||Pi(`${this.name}:${t}`,this.namespace);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);this.setHttpProvider(t,s)}this.events.emit(hi.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;t[r]=this.createHttpProvider(r,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Pi(t,this.namespace);return typeof s>"u"?void 0:new Ri(new Si(s,Xe("disableProviderPing")))}}var hx=Object.defineProperty,lx=Object.defineProperties,fx=Object.getOwnPropertyDescriptors,nf=Object.getOwnPropertySymbols,px=Object.prototype.hasOwnProperty,dx=Object.prototype.propertyIsEnumerable,of=(a,t,r)=>t in a?hx(a,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[t]=r,Eo=(a,t)=>{for(var r in t||(t={}))px.call(t,r)&&of(a,r,t[r]);if(nf)for(var r of nf(t))dx.call(t,r)&&of(a,r,t[r]);return a},xc=(a,t)=>lx(a,fx(t));class Wc{constructor(t){this.events=new zc,this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.disableProviderPing=!1,this.providerOpts=t,this.logger=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:Do(Lo({level:(t==null?void 0:t.logger)||Xl})),this.disableProviderPing=(t==null?void 0:t.disableProviderPing)||!1}static async init(t){const r=new Wc(t);return await r.initialize(),r}async request(t,r){const[s,o]=this.validateChain(r);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(s).request({request:Eo({},t),chainId:`${s}:${o}`,topic:this.session.topic})}sendAsync(t,r,s){const o=new Date().getTime();this.request(t,s).then(h=>r(null,jo(o,h))).catch(h=>r(h,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var t;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(t=this.session)==null?void 0:t.topic,reason:Vt("USER_DISCONNECTED")}),await this.cleanup()}async connect(t){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(t),await this.cleanupPendingPairings(),!t.skipPairing)return await this.pair(t.pairingTopic)}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}removeListener(t,r){this.events.removeListener(t,r)}off(t,r){this.events.off(t,r)}get isWalletConnect(){return!0}async pair(t){this.shouldAbortPairingAttempt=!1;let r=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(r>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:s,approval:o}=await this.client.connect({pairingTopic:t,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});s&&(this.uri=s,this.events.emit("display_uri",s)),await o().then(h=>{this.session=h,this.namespaces||(this.namespaces=tx(h.namespaces),this.persist("namespaces",this.namespaces))}).catch(h=>{if(h.message!==ap)throw h;r++})}while(!this.session);return this.onConnect(),this.session}setDefaultChain(t,r){try{if(!this.session)return;const[s,o]=this.validateChain(t);this.getProvider(s).setDefaultChain(o,r)}catch(s){if(!/Please call connect/.test(s.message))throw s}}async cleanupPendingPairings(t={}){this.logger.info("Cleaning up inactive pairings...");const r=this.client.pairing.getAll();if(Es(r)){for(const s of r)t.deletePairings?this.client.core.expirer.set(s.topic,0):await this.client.core.relayer.subscriber.unsubscribe(s.topic);this.logger.info(`Inactive pairings cleared: ${r.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const t=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[t]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await $I.init({logger:this.providerOpts.logger||Xl,relayUrl:this.providerOpts.relayUrl||kI,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const t=[...new Set(Object.keys(this.session.namespaces).map(r=>Qs(r)))];Ic("client",this.client),Ic("events",this.events),Ic("disableProviderPing",this.disableProviderPing),t.forEach(r=>{if(!this.session)return;const s=ZI(r,this.session),o=up(s),h=XI(this.namespaces,this.optionalNamespaces),f=xc(Eo({},h[r]),{accounts:s,chains:o});switch(r){case"eip155":this.rpcProviders[r]=new ix({namespace:f});break;case"solana":this.rpcProviders[r]=new sx({namespace:f});break;case"cosmos":this.rpcProviders[r]=new nx({namespace:f});break;case"polkadot":this.rpcProviders[r]=new rx({namespace:f});break;case"cip34":this.rpcProviders[r]=new ox({namespace:f});break;case"elrond":this.rpcProviders[r]=new ax({namespace:f});break;case"multiversx":this.rpcProviders[r]=new cx({namespace:f});break;case"near":this.rpcProviders[r]=new ux({namespace:f});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",t=>{this.events.emit("session_ping",t)}),this.client.on("session_event",t=>{const{params:r}=t,{event:s}=r;if(s.name==="accountsChanged"){const o=s.data;o&&Es(o)&&this.events.emit("accountsChanged",o.map(ex))}else if(s.name==="chainChanged"){const o=r.chainId,h=r.event.data,f=Qs(o),y=Ec(o)!==Ec(h)?`${f}:${Ec(h)}`:o;this.onChainChanged(y)}else this.events.emit(s.name,s.data);this.events.emit("session_event",t)}),this.client.on("session_update",({topic:t,params:r})=>{var s;const{namespaces:o}=r,h=(s=this.client)==null?void 0:s.session.get(t);this.session=xc(Eo({},h),{namespaces:o}),this.onSessionUpdate(),this.events.emit("session_update",{topic:t,params:r})}),this.client.on("session_delete",async t=>{await this.cleanup(),this.events.emit("session_delete",t),this.events.emit("disconnect",xc(Eo({},Vt("USER_DISCONNECTED")),{data:t.topic}))}),this.on(hi.DEFAULT_CHAIN_CHANGED,t=>{this.onChainChanged(t,!0)})}getProvider(t){if(!this.rpcProviders[t])throw new Error(`Provider not found: ${t}`);return this.rpcProviders[t]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(t=>{var r;this.getProvider(t).updateNamespace((r=this.session)==null?void 0:r.namespaces[t])})}setNamespaces(t){const{namespaces:r,optionalNamespaces:s,sessionProperties:o}=t;r&&Object.keys(r).length&&(this.namespaces=r),s&&Object.keys(s).length&&(this.optionalNamespaces=s),this.sessionProperties=o,this.persist("namespaces",r),this.persist("optionalNamespaces",s)}validateChain(t){const[r,s]=(t==null?void 0:t.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[r,s];if(r&&!Object.keys(this.namespaces||{}).map(f=>Qs(f)).includes(r))throw new Error(`Namespace '${r}' is not configured. Please call connect() first with namespace config.`);if(r&&s)return[r,s];const o=Qs(Object.keys(this.namespaces)[0]),h=this.rpcProviders[o].getDefaultChain();return[o,h]}async requestAccounts(){const[t]=this.validateChain();return await this.getProvider(t).requestAccounts()}onChainChanged(t,r=!1){var s;if(!this.namespaces)return;const[o,h]=this.validateChain(t);r||this.getProvider(o).setDefaultChain(h),((s=this.namespaces[o])!=null?s:this.namespaces[`${o}:${h}`]).defaultChain=h,this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",h)}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(t,r){this.client.core.storage.setItem(`${ef}/${t}`,r)}async getFromStore(t){return await this.client.core.storage.getItem(`${ef}/${t}`)}}const gx=Wc,yx="wc",vx="ethereum_provider",mx=`${yx}@2:${vx}:`,wx="https://rpc.walletconnect.com/v1/",Lc=["eth_sendTransaction","personal_sign"],bx=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"],jc=["chainChanged","accountsChanged"],_x=["chainChanged","accountsChanged","message","disconnect","connect"];var Ex=Object.defineProperty,Ix=Object.defineProperties,xx=Object.getOwnPropertyDescriptors,af=Object.getOwnPropertySymbols,Px=Object.prototype.hasOwnProperty,Sx=Object.prototype.propertyIsEnumerable,cf=(a,t,r)=>t in a?Ex(a,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[t]=r,Zs=(a,t)=>{for(var r in t||(t={}))Px.call(t,r)&&cf(a,r,t[r]);if(af)for(var r of af(t))Sx.call(t,r)&&cf(a,r,t[r]);return a},uf=(a,t)=>Ix(a,xx(t));function Co(a){return Number(a[0].split(":")[1])}function Pc(a){return`0x${a.toString(16)}`}function Rx(a){const{chains:t,optionalChains:r,methods:s,optionalMethods:o,events:h,optionalEvents:f,rpcMap:y}=a;if(!Es(t))throw new Error("Invalid chains");const m={chains:t,methods:s||Lc,events:h||jc,rpcMap:Zs({},t.length?{[Co(t)]:y[Co(t)]}:{})},g=h==null?void 0:h.filter(j=>!jc.includes(j)),_=s==null?void 0:s.filter(j=>!Lc.includes(j));if(!r&&!f&&!o&&!(g!=null&&g.length)&&!(_!=null&&_.length))return{required:t.length?m:void 0};const O=(g==null?void 0:g.length)&&(_==null?void 0:_.length)||!r,$={chains:[...new Set(O?m.chains.concat(r||[]):r)],methods:[...new Set(m.methods.concat(o!=null&&o.length?o:bx))],events:[...new Set(m.events.concat(f!=null&&f.length?f:_x))],rpcMap:y};return{required:t.length?m:void 0,optional:r.length?$:void 0}}class Jc{constructor(){this.events=new ur.EventEmitter,this.namespace="eip155",this.accounts=[],this.chainId=1,this.STORAGE_KEY=mx,this.on=(t,r)=>(this.events.on(t,r),this),this.once=(t,r)=>(this.events.once(t,r),this),this.removeListener=(t,r)=>(this.events.removeListener(t,r),this),this.off=(t,r)=>(this.events.off(t,r),this),this.parseAccount=t=>this.isCompatibleChainId(t)?this.parseAccountId(t).address:t,this.signer={},this.rpc={}}static async init(t){const r=new Jc;return await r.initialize(t),r}async request(t){return await this.signer.request(t,this.formatChainId(this.chainId))}sendAsync(t,r){this.signer.sendAsync(t,r,this.formatChainId(this.chainId))}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(t){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(t);const{required:r,optional:s}=Rx(this.rpc);try{const o=await new Promise(async(f,y)=>{var m;this.rpc.showQrModal&&((m=this.modal)==null||m.subscribeModal(g=>{!g.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),y(new Error("Connection request reset. Please try again.")))})),await this.signer.connect(uf(Zs({namespaces:Zs({},r&&{[this.namespace]:r})},s&&{optionalNamespaces:{[this.namespace]:s}}),{pairingTopic:t==null?void 0:t.pairingTopic})).then(g=>{f(g)}).catch(g=>{y(new Error(g.message))})});if(!o)return;const h=Aw(o.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:h),this.setAccounts(h),this.events.emit("connect",{chainId:Pc(this.chainId)})}catch(o){throw this.signer.logger.error(o),o}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",t=>{const{params:r}=t,{event:s}=r;s.name==="accountsChanged"?(this.accounts=this.parseAccounts(s.data),this.events.emit("accountsChanged",this.accounts)):s.name==="chainChanged"?this.setChainId(this.formatChainId(s.data)):this.events.emit(s.name,s.data),this.events.emit("session_event",t)}),this.signer.on("chainChanged",t=>{const r=parseInt(t);this.chainId=r,this.events.emit("chainChanged",Pc(this.chainId)),this.persist()}),this.signer.on("session_update",t=>{this.events.emit("session_update",t)}),this.signer.on("session_delete",t=>{this.reset(),this.events.emit("session_delete",t),this.events.emit("disconnect",uf(Zs({},Vt("USER_DISCONNECTED")),{data:t.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",t=>{var r,s;this.rpc.showQrModal&&((r=this.modal)==null||r.closeModal(),(s=this.modal)==null||s.openModal({uri:t})),this.events.emit("display_uri",t)})}switchEthereumChain(t){this.request({method:"wallet_switchEthereumChain",params:[{chainId:t.toString(16)}]})}isCompatibleChainId(t){return typeof t=="string"?t.startsWith(`${this.namespace}:`):!1}formatChainId(t){return`${this.namespace}:${t}`}parseChainId(t){return Number(t.split(":")[1])}setChainIds(t){const r=t.filter(s=>this.isCompatibleChainId(s)).map(s=>this.parseChainId(s));r.length&&(this.chainId=r[0],this.events.emit("chainChanged",Pc(this.chainId)),this.persist())}setChainId(t){if(this.isCompatibleChainId(t)){const r=this.parseChainId(t);this.chainId=r,this.switchEthereumChain(r)}}parseAccountId(t){const[r,s,o]=t.split(":");return{chainId:`${r}:${s}`,address:o}}setAccounts(t){this.accounts=t.filter(r=>this.parseChainId(this.parseAccountId(r).chainId)===this.chainId).map(r=>this.parseAccountId(r).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(t){var r,s;const o=(r=t==null?void 0:t.chains)!=null?r:[],h=(s=t==null?void 0:t.optionalChains)!=null?s:[],f=o.concat(h);if(!f.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const y=o.length?(t==null?void 0:t.methods)||Lc:[],m=o.length?(t==null?void 0:t.events)||jc:[],g=(t==null?void 0:t.optionalMethods)||[],_=(t==null?void 0:t.optionalEvents)||[],O=(t==null?void 0:t.rpcMap)||this.buildRpcMap(f,t.projectId),$=(t==null?void 0:t.qrModalOptions)||void 0;return{chains:o==null?void 0:o.map(j=>this.formatChainId(j)),optionalChains:h.map(j=>this.formatChainId(j)),methods:y,events:m,optionalMethods:g,optionalEvents:_,rpcMap:O,showQrModal:!!(t!=null&&t.showQrModal),qrModalOptions:$,projectId:t.projectId,metadata:t.metadata}}buildRpcMap(t,r){const s={};return t.forEach(o=>{s[o]=this.getRpcUrl(o,r)}),s}async initialize(t){if(this.rpc=this.getRpcConfig(t),this.chainId=this.rpc.chains.length?Co(this.rpc.chains):Co(this.rpc.optionalChains),this.signer=await gx.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:t.disableProviderPing,relayUrl:t.relayUrl,storageOptions:t.storageOptions}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let r;try{const{WalletConnectModal:s}=await k0(()=>import("./index-CvuUVRbN.js").then(o=>o.i),__vite__mapDeps([0,1,2]));r=s}catch{throw new Error("To use QR modal, please install @walletconnect/modal package")}if(r)try{this.modal=new r(Zs({projectId:this.rpc.projectId},this.rpc.qrModalOptions))}catch(s){throw this.signer.logger.error(s),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(t){if(!t)return;const{chains:r,optionalChains:s,rpcMap:o}=t;r&&Es(r)&&(this.rpc.chains=r.map(h=>this.formatChainId(h)),r.forEach(h=>{this.rpc.rpcMap[h]=(o==null?void 0:o[h])||this.getRpcUrl(h)})),s&&Es(s)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=s==null?void 0:s.map(h=>this.formatChainId(h)),s.forEach(h=>{this.rpc.rpcMap[h]=(o==null?void 0:o[h])||this.getRpcUrl(h)}))}getRpcUrl(t,r){var s;return((s=this.rpc.rpcMap)==null?void 0:s[t])||`${wx}?chainId=eip155:${t}&projectId=${r||this.rpc.projectId}`}async loadPersistedSession(){if(!this.session)return;const t=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),r=this.session.namespaces[`${this.namespace}:${t}`]?this.session.namespaces[`${this.namespace}:${t}`]:this.session.namespaces[this.namespace];this.setChainIds(t?[this.formatChainId(t)]:r==null?void 0:r.accounts),this.setAccounts(r==null?void 0:r.accounts)}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(t){return typeof t=="string"||t instanceof String?[this.parseAccount(t)]:t.map(r=>this.parseAccount(r))}}const Wx=Jc;export{Wx as EthereumProvider,_x as OPTIONAL_EVENTS,bx as OPTIONAL_METHODS,jc as REQUIRED_EVENTS,Lc as REQUIRED_METHODS,Jc as default};
//# sourceMappingURL=index.es-BNXYKRbW.js.map
